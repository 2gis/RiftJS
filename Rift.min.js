!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("superagent")):"function"==typeof define&&define.amd?define(["superagent"],t):"object"==typeof exports?exports.Rift=t(require("superagent")):e.Rift=t(e.superagent)}(this,function(e){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){var n=i(1);t.nextTick=n.nextTick,t.EventEmitter=n.EventEmitter,t.ObservableMap=n.ObservableMap,t.map=n.map,t.ObservableList=n.ObservableList,t.list=n.list,t.Cell=n.Cell,t.cellx=t.cell=n,t.env=i(2),t.uid=i(3),t.object=i(4),t.regex=i(5);var r=t.Class=i(6);n.EventEmitter.extend=r.extend,t.proxy=i(7),t.Disposable=i(9),t.BaseModel=i(10),t.domBinding=i(11);var s=i(12);t.viewClasses=s.viewClasses,t.registerViewClass=s.registerViewClass,t.BaseView=s,t.templateRuntime=i(13),t.ViewList=i(14),t.ViewSwitch=i(15),t.Router=i(16),t.BaseApp=i(17);var a=t.d=i(18);a.observable=n.d.observable,a.computed=n.d.computed,t.rt=t},function(e,t,i){!function(t){"use strict";function i(e,t){function n(e){return s(n,r,t,this,e,h.call(arguments,1),arguments.length)}t||(t={});var r=e;return n.constructor=i,n}function n(e,t){for(var i=Object.getOwnPropertyNames(t),n=i.length;n;)Object.defineProperty(e,i[--n],Object.getOwnPropertyDescriptor(t,i[n]));return e}function r(e){var t;e.Extends?(t=e.Extends,delete e.Extends):t=Object;var i;a.call(e,"constructor")?(i=e.constructor,delete e.constructor):i=function(){},e.Static&&(n(i,e.Static),delete e.Static);var r=i.prototype=Object.create(t.prototype);return e.Implements&&(e.Implements.forEach(function(e){n(r,e.prototype)}),delete e.Implements),n(r,e),r.constructor=i,i}var s,a=Object.prototype.hasOwnProperty,o=Object.prototype.toString,l=Array.prototype.push,h=Array.prototype.slice,c=Array.prototype.splice,u=Function("return this;")();i.cellx=i;var f="__cellx_uid__",d="__cellx_cells__";u.Symbol&&"symbol"==typeof Symbol.iterator&&(f=Symbol(f),d=Symbol(d)),i.KEY_UID=f,i.KEY_CELLS=d;var p,v=0,_=Object.is||function(e,t){return 0===e&&0===t?1/e==1/t:e===t||e!=e&&t!=t},g=Array.isArray||function(e){return"[object Array]"==o.call(e)};p=u.console?console.error?function(e){console.error(e===Object(e)&&e.stack||e)}:function(e){console.log("Error: "+(e===Object(e)&&e.stack||e))}:function(){},i.logError=p,function(){var e=u.Map;if(!e){var n={value:t};e=r({constructor:function(e){if(this._entries=Object.create(null),this._objectStamps={},this._first=null,this._last=null,this.size=0,e)for(var t=0,i=e.length;i>t;t++)this.set(e[t][0],e[t][1])},has:function(e){return!!this._entries[this._getValueStamp(e)]},get:function(e){return(this._entries[this._getValueStamp(e)]||n).value},set:function(e,t){var i=this._entries,n=this._getValueStamp(e);if(i[n])i[n].value=t;else{var r=i[n]={key:e,keyStamp:n,value:t,prev:this._last,next:null};this.size++?this._last.next=r:this._first=r,this._last=r}return this},"delete":function(e){var t=this._getValueStamp(e),i=this._entries[t];if(!i)return!1;if(--this.size){var n=i.prev,r=i.next;n?n.next=r:this._first=r,r?r.prev=n:this._last=n}else this._first=null,this._last=null;return delete this._entries[t],delete this._objectStamps[t],!0},clear:function(){var e=this._entries;for(var t in e)delete e[t];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(e){switch(typeof e){case"undefined":return"undefined";case"object":if(null===e)return"null";break;case"boolean":return"?"+e;case"number":return"+"+e;case"string":return","+e}return this._getObjectStamp(e)},_getObjectStamp:function(e){if(!a.call(e,f)){if(!Object.isExtensible(e)){var t,i=this._objectStamps;for(t in i)if(i[t]==e)return t;return t=String(++v),i[t]=e,t}Object.defineProperty(e,f,{value:String(++v)})}return e[f]},forEach:function(e,t){null==t&&(t=u);for(var i=this._first;i;){e.call(t,i.value,i.key,this);do i=i.next;while(i&&!this._entries[i.keyStamp])}},toString:function(){return"[object Map]"}}),[["keys",function(e){return e.key}],["values",function(e){return e.value}],["entries",function(e){return[e.key,e.value]}]].forEach(function(i){var n=i[1];e.prototype[i[0]]=function(){var e,i=this._entries,r=!1,s=this;return{next:function(){if(!r){if(e){do e=e.next;while(e&&!i[e.keyStamp])}else e=s._first;if(e)return{value:n(e),done:!1};r=!0}return{value:t,done:!0}}}}})}i.Map=e}(),function(){var e;if(u.process&&"[object process]"==process.toString()&&process.nextTick)e=process.nextTick;else if(u.setImmediate)e=function(e){setImmediate(e)};else if(u.Promise&&-1!=Promise.toString().indexOf("[native code]")){var t=Promise.resolve();e=function(e){t.then(function(){e()})}}else if(u.postMessage&&!u.ActiveXObject){var n;u.addEventListener("message",function(){if(n){var e=n;n=null;for(var t=0,r=e.length;r>t;t++)try{e[t]()}catch(s){i.logError(s)}}},!1),e=function(e){n?n.push(e):(n=[e],u.postMessage("__tic__","*"))}}else e=function(e){setTimeout(e,1)};i.nextTick=e}(),function(){var e="__cellx_EventEmitter_inner__";u.Symbol&&"symbol"==typeof Symbol.iterator&&(e=Symbol(e));var t=r({Static:{KEY_INNER:e},constructor:function(e){this.parent=e||null,this._events=Object.create(null)},on:function(e,t,i){if("object"==typeof e){i=t;var n=e;for(e in n)this._on(e,n[e],i)}else this._on(e,t,i);return this},off:function(e,t,i){if(e)if("object"==typeof e){i=t;var n=e;for(e in n)this._off(e,n[e],i)}else this._off(e,t,i);else this._events&&(this._events=Object.create(null));return this},_on:function(e,t,i){var n=e.indexOf(":");if(-1!=n)this["_"+e.slice(n+1)]("on",e.slice(0,n),t,i);else{var r=(this._events||(this._events=Object.create(null)))[e];r||(r=this._events[e]=[]),r.push({listener:t,context:i||this})}},_off:function(t,i,n){var r=t.indexOf(":");if(-1!=r)this["_"+t.slice(r+1)]("off",t.slice(0,r),i,n);else{var s=this._events&&this._events[t];if(!s)return;n||(n=this);for(var a=s.length;a;){var o=s[--a];if(o.context==n&&(o.listener==i||o.listener[e]===i)){s.splice(a,1);break}}s.length||delete this._events[t]}},once:function(t,i,n){function r(){return this._off(t,r,n),i.apply(this,arguments)}return r[e]=i,this._on(t,r,n),this},emit:function(e){return"string"==typeof e?e={target:this,type:e}:e.target||(e.target=this),this._handleEvent(e),e},_handleEvent:function(e){var t=this._events&&this._events[e.type];if(t){t=t.slice();for(var i=0,n=t.length;n>i;i++)try{t[i].listener.call(t[i].context,e)===!1&&(e.isPropagationStopped=!0)}catch(r){this._logError(r)}}this.parent&&e.bubbles!==!1&&!e.isPropagationStopped&&this.parent._handleEvent(e)},_logError:function(e){i.logError(e)}});i.EventEmitter=t}();var m;!function(){var e=i.Map,t=i.EventEmitter;m=r({Extends:t,constructor:function(){this._valueCounts=new e},_onItemChange:function(e){this._handleEvent(e)},_registerValue:function(e){var i=this._valueCounts,n=i.get(e);n?i.set(e,n+1):(i.set(e,1),this.adoptsItemChanges&&e instanceof t&&e.on("change",this._onItemChange,this))},_unregisterValue:function(e){var i=this._valueCounts,n=i.get(e);n>1?i.set(e,n-1):(i["delete"](e),this.adoptsItemChanges&&e instanceof t&&e.off("change",this._onItemChange,this))},dispose:function(){this.adoptsItemChanges&&this._valueCounts.forEach(function(e){e instanceof t&&e.off("change",this._onItemChange,this)},this)}})}(),function(){function e(e,t){return new a(e,"boolean"==typeof t?{adoptsItemChanges:t}:t)}var n=i.Map,s=i.EventEmitter,a=r({Extends:s,Implements:[m],constructor:function(e,t){if(s.call(this),m.call(this),this._entries=new n,this.size=0,this.adoptsItemChanges=!t||t.adoptsItemChanges!==!1,e){var i=this._entries;if(e instanceof a)e._entries.forEach(function(e,t){i.set(t,e),this._registerValue(e)},this);else if(g(e))for(var r=0,o=e.length;o>r;r++){var l=e[r];i.set(l[0],l[1]),this._registerValue(l[1])}else for(var h in e)i.set(h,e[h]),this._registerValue(e[h]);this.size=i.size}},has:function(e){return this._entries.has(e)},contains:function(e){return this._valueCounts.has(e)},get:function(e){return this._entries.get(e)},set:function(e,t){var i,n=this._entries,r=n.has(e);if(r){if(i=n.get(e),_(i,t))return this;this._unregisterValue(i)}return n.set(e,t),this._registerValue(t),r||this.size++,this.emit({type:"change",subtype:r?"update":"add",key:e,oldValue:i,value:t}),this},"delete":function(e){var i=this._entries;if(!i.has(e))return!1;var n=i.get(e);return i["delete"](e),this._unregisterValue(n),this.size--,this.emit({type:"change",subtype:"delete",key:e,oldValue:n,value:t}),!0},clear:function(){return this.size?(this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit({type:"change",subtype:"clear"}),this):this},forEach:function(e,t){null==t&&(t=u),this._entries.forEach(function(i,n){e.call(t,i,n,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges})}});i.ObservableMap=a,i.map=e}(),function(){function e(e,t){return t>e?-1:e>t?1:0}function n(e,t){var i=e._items;if(e.sorted)for(var n=e.comparator,r=0,s=t.length;s>r;r++){for(var a=t[r],o=0,h=i.length;o!=h;){var c=o+h>>1;n(a,i[c])<0?h=c:o=c+1}i.splice(o,0,a),e._registerValue(a)}else{l.apply(i,t);for(var u=t.length;u;)e._registerValue(t[--u])}e.length=i.length}function s(e,t){return new o(e,"boolean"==typeof t?{adoptsItemChanges:t}:t)}var a=i.EventEmitter,o=r({Extends:a,Implements:[m],constructor:function(t,i){a.call(this),m.call(this),i||(i={}),this._items=[],this.length=0,this.adoptsItemChanges=i.adoptsItemChanges!==!1,this.comparator=null,this.sorted=!1,(i.sorted||i.comparator&&i.sorted!==!1)&&(this.comparator=i.comparator||e,this.sorted=!0),t&&n(this,t instanceof o?t._items:t)},_validateIndex:function(e,i){if(e===t)return e;if(0>e){if(e+=this.length,0>e)throw new RangeError("Index out of range")}else if(e>=this.length+(i?1:0))throw new RangeError("Index out of range");return e},contains:function(e){return this._valueCounts.has(e)},indexOf:function(e,t){return this._items.indexOf(e,this._validateIndex(t))},lastIndexOf:function(e,t){return this._items.lastIndexOf(e,this._validateIndex(t))},get:function(e){return this._items[this._validateIndex(e)]},getRange:function(e,i){e=this._validateIndex(e||0,!0);var n=this._items;if(i===t)return n.slice(e);if(e+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');return n.slice(e,e+i)},set:function(e,t){if(this.sorted)throw new TypeError("Can't set to sorted list");e=this._validateIndex(e);var i=this._items;return _(i[e],t)?this:(this._unregisterValue(i[e]),i[e]=t,this._registerValue(t),this.emit("change"),this)},setRange:function(e,t){if(this.sorted)throw new TypeError("Can't set to sorted list");e=this._validateIndex(e);var i=t.length;if(!i)return this;if(e+i>this.length)throw new RangeError('"index" and length of "items" do not denote a valid range');for(var n=this._items,r=!1,s=e+i;s>e;){var a=t[--s];_(n[s],a)||(this._unregisterValue(n[s]),n[s]=a,this._registerValue(a),r=!0)}return r&&this.emit("change"),this},add:function(e){return this.addRange([e]),this},addRange:function(e){return e.length?(n(this,e),this.emit("change"),this):this},insert:function(e,t){return this.insertRange(e,[t]),this},insertRange:function(e,t){if(this.sorted)throw new TypeError("Can't insert to sorted list");e=this._validateIndex(e,!0);var i=t.length;if(!i)return this;c.apply(this._items,[].concat(e,0,t));for(var n=i;n;)this._registerValue(t[--n]);return this.length+=i,this.emit("change"),this},remove:function(e,t){var i=this._items.indexOf(e,this._validateIndex(t));return-1==i?this:(this._items.splice(i,1),this._unregisterValue(e),this.length--,this.emit("change"),this)},removeAll:function(e,t){for(var i=this._items,n=this._validateIndex(t),r=!1;-1!=(n=i.indexOf(e,n));)i.splice(n,1),this._unregisterValue(e),r=!0;return r&&(this.length=i.length,this.emit("change")),this},removeAt:function(e){return this._unregisterValue(this._items.splice(this._validateIndex(e),1)[0]),this.length--,this.emit("change"),this},removeRange:function(e,i){e=this._validateIndex(e||0,!0);var n=this._items;if(i===t)i=n.length-e;else if(e+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');if(!i)return this;for(var r=e+i;r>e;)this._unregisterValue(n[--r]);return n.splice(e,i),this.length-=i,this.emit("change"),this},clear:function(){return this.length&&(this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit("change")),this},join:function(e){return this._items.join(e)},forEach:null,map:null,filter:null,every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice()},toString:function(){return this._items.join()}});["forEach","map","filter","every","some","reduce","reduceRight"].forEach(function(e){o.prototype[e]=function(){return Array.prototype[e].apply(this._items,arguments)}}),i.ObservableList=o,i.list=s}(),function(){function e(){if(!(c>u)){l=!0;do{var e=h[c];if(e){var t=e.shift();if(c){var i=c;t._recalc(),h[i].length||(h[i]=null,c&&c++)}else{var n=t._changeEvent;t._fixedValue=t._value,t._changeEvent=null,t._changed=!0,t._events.change&&t._handleEvent(n);for(var r=t._slaves,s=r.length;s;){var a=r[--s];a._fixed&&((h[1]||(h[1]=[])).push(a),u||(u=1),a._fixed=!1)}h[0].length||c++}}else c++}while(u>=c);u=-1,d++,l=!1}}var n=i.nextTick,s=i.EventEmitter,a=s.KEY_INNER,o={original:null},l=!1,h=[[]],c=0,u=-1,f=null,d=1,p=r({Extends:s,constructor:function(e,i){s.call(this),i||(i={}),this.owner=i.owner||null,this.computed="function"==typeof e&&(i.computed!==t?i.computed:e.constructor==Function),this._value=t,this._fixedValue=t,this.initialValue=t,this._formula=null,this._get=i.get||null,this._set=i.set||null,this._validate=i.validate||null,this._masters=null,this._slaves=[],this._level=0,this._active=!this.computed,this._changeEvent=null,this._isChangeCancellable=!0,this._lastErrorEvent=null,this._fixed=!0,this._version=0,this._changed=!1,this._circularityCounter=0,this.computed?this._formula=e:(this._validate&&this._validate.call(this.owner||this,e),this._value=this._fixedValue=this.initialValue=e,e instanceof s&&e.on("change",this._onValueChange,this)),i.onchange&&this.on("change",i.onchange),i.onerror&&this.on("error",i.onerror)},get changed(){return l||e(),this._changed},on:function(t,i,n){return l||e(),!this.computed||this._events.change||this._slaves.length||this._activate(),s.prototype.on.call(this,t,i,n),this},off:function(t,i,n){return l||e(),s.prototype.off.call(this,t,i,n),!this.computed||this._events.change||this._slaves.length||this._deactivate(),this},_on:function(e,t,i){s.prototype._on.call(this,e,t,i||this.owner)},_off:function(e,t,i){s.prototype._off.call(this,e,t,i||this.owner)},subscribe:function(e){function t(t){return e.call(this,t.error||null,t)}return t[a]=e,this.on("change",t).on("error",t),this},unsubscribe:function(e){return this.off("change",e).off("error",e),this},_registerSlave:function(e){!this.computed||this._events.change||this._slaves.length||this._activate(),this._slaves.push(e)},_unregisterSlave:function(e){this._slaves.splice(this._slaves.indexOf(e),1),!this.computed||this._events.change||this._slaves.length||this._deactivate()},_activate:function(){if(this._version!=d){this._masters=null,this._level=0;var e=this._tryFormula();e===o?this._handleError(o.original):_(this._value,e)||(this._value=e,this._changed=!0),this._version=d}for(var t=this._masters||[],i=t.length;i;)t[--i]._registerSlave(this);this._active=!0},_deactivate:function(){for(var e=this._masters||[],t=e.length;t;)e[--t]._unregisterSlave(this);this._active=!1},_onValueChange:function(t){this._changeEvent?(t.prev=this._changeEvent,this._changeEvent=t,this._value===this._fixedValue&&(this._isChangeCancellable=!1)):(h[0].push(this),c=0,-1==u&&(u=0),t.prev=null,this._changeEvent=t,this._isChangeCancellable=!1,l||n(e))},get:function(){if(l||e(),this.computed&&!this._active&&this._version!=d){this._masters=null,this._level=0;var t=this._tryFormula();t===o?this._handleError(o.original):_(this._value,t)||(this._value=t,this._changed=!0),this._version=d}return f&&(f._masters?-1==f._masters.indexOf(this)&&(f._masters.push(this),f._level<=this._level&&(f._level=this._level+1)):(f._masters=[this],f._level=this._level+1)),this._get?this._get.call(this.owner||this,this._value):this._value},set:function(t){if(this.computed&&!this._set)throw new TypeError("Cannot write to read-only cell");var i=this._value;return _(i,t)?!1:(this._validate&&this._validate.call(this.owner||this,t),this.computed?this._set.call(this.owner||this,t):(this._value=t,i instanceof s&&i.off("change",this._onValueChange,this),t instanceof s&&t.on("change",this._onValueChange,this),this._changeEvent?_(t,this._fixedValue)&&this._isChangeCancellable?(1==h[0].length?(h[0].pop(),u||(u=-1)):h[0].splice(h[0].indexOf(this),1),this._changeEvent=null):this._changeEvent={target:this,type:"change",oldValue:i,value:t,prev:this._changeEvent}:(h[0].push(this),c=0,-1==u&&(u=0),this._changeEvent={target:this,type:"change",oldValue:i,value:t,prev:null},this._isChangeCancellable=!0,l||n(e))),!0)},recalc:function(){return this._recalc(!0)},_recalc:function(t){if(!t)if(this._version==d+1){if(10==++this._circularityCounter)return this._fixed=!0,this._version=d+1,this._handleError(new RangeError("Circular dependency detected")),!1}else this._circularityCounter=1;var i=this._masters;this._masters=null;var r=this._level;this._level=0;for(var a=this._tryFormula(),l=this._masters||[],c=!1,f=i.length;f;){var p=i[--f];-1==l.indexOf(p)&&(p._unregisterSlave(this),c=!0)}if(c||i.length<l.length){for(var v=l.length;v;){var g=l[--v];-1==i.indexOf(g)&&g._registerSlave(this)}var m=this._level;if(m>r)return(h[m]||(h[m]=[])).push(this),m>u&&(u=m),void(t&&n(e))}if(this._fixed=!0,this._version=d+1,a===o)this._handleError(o.original);else{var b=this._value;if(!_(b,a)||a instanceof s){this._value=a,this._changed=!0,this._events.change&&this.emit({type:"change",oldValue:b,value:a,prev:null});for(var y=this._slaves,w=y.length;w;){var E=y[--w];if(E._fixed){var C=E._level;(h[C]||(h[C]=[])).push(E),C>u&&(u=C),E._fixed=!1}}return!0}}return!1},_tryFormula:function(){var e=f;f=this;try{var t=this._formula.call(this.owner||this);return this._validate&&this._validate.call(this.owner||this,t),t}catch(i){return o.original=i,o}finally{f=e}},_handleError:function(e){this._logError(e),this._handleErrorEvent({type:"error",error:e})},_handleErrorEvent:function(e){if(this._lastErrorEvent!==e){this._lastErrorEvent=e,this._handleEvent(e);for(var t=this._slaves,i=t.length;i&&!e.isPropagationStopped;)t[--i]._handleErrorEvent(e)}},dispose:function(){return l||e(),this._dispose(),this},_dispose:function(){if(this.off(),this._active)for(var e=this._slaves,t=e.length;t;)e[--t]._dispose()}});i.Cell=p}(),function(){var e=i.Map,t=i.Cell,r=t.prototype;s=function(s,l,h,c,f,p,v){c&&c!=u||(c=s),a.call(c,d)||Object.defineProperty(c,d,{value:new e});var _=c[d].get(s);if(!_){if(null!=l&&"object"==typeof l)if("function"==typeof l.clone)l=l.clone();else if(g(l))l=l.slice();else if(l.constructor===Object)l=n({},l);else switch(o.call(l)){case"[object Date]":l=new Date(l);break;case"[object RegExp]":l=new RegExp(l)}h=Object.create(h),h.owner=c,_=new t(l,h),c[d].set(s,_)}switch(v){case 0:return _.get();case 1:return _.set(f);default:switch(f){case"bind":return s=s.bind(c),s.constructor=i,s;case"unwrap":return _;default:return r[f].apply(_,p)}}}}(),function(){function e(t,n,r,s){if(1==arguments.length)return s=t,function(t,i,n){return e(t,i,n,s)};s||(s={}),s.computed=!1;var a="_"+n;return t[a]=i(r.initializer(),s),{configurable:r.configurable,enumerable:r.enumerable,get:function(){return this[a]()},set:function(e){this[a](e)}}}function t(e,n,r,s){if(1==arguments.length)return s=e,function(e,i,n){return t(e,i,n,s)};var a=r.initializer();if("function"!=typeof a)throw new TypeError("Property value must be a function");s||(s={}),s.computed=!0;var o="_"+n;e[o]=i(a,s);var r={configurable:r.configurable,enumerable:r.enumerable,get:function(){return this[o]()}};return s.set&&(r.set=function(e){this[o](e)}),r}i.d={observable:e,computed:t}}(),e.exports=i}()},function(e,t){var i="undefined"==typeof window&&"undefined"==typeof navigator;t.isServer=i,t.isClient=!i},function(e,t){(function(e){function i(e){return(e||"")+ ++r}var n="__rt_uid__";e.Symbol&&"symbol"==typeof Symbol.iterator&&(n=Symbol(n)),t.KEY=n;var r=0;t.next=i}).call(t,function(){return this}())},function(e,t,i){function n(e,t){for(var i=Object.getOwnPropertyNames(t),n=i.length;n;)Object.defineProperty(e,i[--n],Object.getOwnPropertyDescriptor(t,i[n]));return e}var r,s=i(3),a=s.KEY,o=s.next;if("symbol"==typeof a)r=function(e,t){return e[a]||(e[a]=o(t))};else{var l=Object.prototype.hasOwnProperty;r=function(e,t){return l.call(e,a)||Object.defineProperty(e,a,{value:o(t)}),e[a]}}t.getUID=r;var h=Object.assign||function(e,t){for(var i=Object.keys(t),n=i.length;n;)e[i[--n]]=t[i[n]];return e};t.assign=h,t.mixin=n},function(e,t){function i(e){return e.replace(n,"\\$1")}var n=/([?+|$(){}[^.\-\]\/\\*])/g;t.escape=i},function(e,t,i){function n(e){var i,r=this==t?Object:this;a.call(e,"constructor")?(i=e.constructor,delete e.constructor):i=r==Object?function(){}:function(){return r.apply(this,arguments)};var o=Object.create(r.prototype);return i.prototype=o,Object.defineProperty(o,"constructor",{configurable:!0,writable:!0,value:i}),Object.keys(r).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))}),e["static"]&&(s(i,e["static"]),delete e["static"]),i.extend||(i.extend=n),s(o,e),i}var r=i(4),s=r.mixin,a=Object.prototype.hasOwnProperty;t.extend=n},function(e,t,i){function n(){return JSON.stringify(o)}function r(e){o=JSON.parse(e)}function s(){o={}}var a=i(8),o={};t.serializeCache=n,t.deserializeCache=r,t.clearCache=s,["get","head","del","patch","post","put"].forEach(function(e){t[e]=function(t,i){i||(i={});var n=[].slice.call(arguments),r=JSON.stringify(n);if(i.noCache!==!0&&o.hasOwnProperty(r)){var s=JSON.parse(o[r]);return s.error?Promise.reject(s):Promise.resolve(s)}return new Promise(function(n,s){var l=a[e](t),h=i.headers;return h&&Object.keys(h).forEach(function(e){l.set(e,h[e])}),i.withCredentials&&l.withCredentials(),"get"==e?i.query&&l.query(i.query):i.data&&l.send("object"==typeof i.data?JSON.stringify(i.data):i.data),l.end(function(e,t){t||(t={}),t={headers:t.headers||null,status:t.status,error:e?{name:e.name,message:e.message}:null,body:t.body||null},o[r]=JSON.stringify(t),t.error?s(t):n(t)})})}})},function(t,i){t.exports=e},function(e,t,i){var n=i(1),r=i(3),s=n.EventEmitter,a=r.next,o=s.extend({_disposables:null,disposed:!1,constructor:function(){s.call(this),this._disposables=Object.create(null)},listenTo:function(e,t,i,n){function r(){for(var e=o.length;e;)o[--e].stop();delete d._disposables[f]}var s,o;if(Array.isArray(e)||e.addClass&&e.append){o=[];for(var l=e.length;l;)o.push(this.listenTo(e[--l],t,i,n))}else if("object"==typeof t){n=i,s=t,o=[];for(t in s)o.push(this.listenTo(e,t,s[t],n))}else if(Array.isArray(i)){s=i,o=[];for(var h=0,c=s.length;c>h;h++)o.push(this.listenTo(e,t,s[h],n))}else{if("object"!=typeof i)return this._listenTo(e,t,i,n);s=i,o=[];for(var u in s)o.push(this.listenTo(e[u]("unwrap",0),t,s[u],n))}var f=a(),d=this,p=this._disposables[f]={stop:r,dispose:r};return p},_listenTo:function(e,t,i,n){function r(){o in l._disposables&&(e instanceof s?e.off(t,i,n):e.removeEventListener(t,i,!1),delete l._disposables[o])}n||(n=this);var o=a(),l=this;if(e instanceof s)e.on(t,i,n);else{if("function"!=typeof e.addEventListener)throw new TypeError("Unable to add a listener");e!=n&&(i=i.bind(n)),e.addEventListener(t,i,!1)}var h=this._disposables[o]={stop:r,dispose:r};return h},registerCallback:function(e){function t(){return n in r._disposables?(delete r._disposables[n],e.apply(r,arguments)):void 0}function i(){delete r._disposables[n]}var n=a(),r=this;return t.cancel=i,t.dispose=i,this._disposables[n]=t,t},setTimeout:function(e,t){function i(){n in r._disposables&&(i(s),delete r._disposables[n])}var n=a(),r=this,s=setTimeout(function(){delete r._disposables[n],e.call(r)},t),o=this._disposables[n]={clear:i,dispose:i};return o},dispose:function(){if(!this.disposed){var e=this._disposables;for(var t in e)e[t].dispose();this.disposed=!0}}});e.exports=o},function(e,t,i){var n=i(9),r=n.extend({setData:function(e,t){t||(t={});for(var i in e){var n=t[i]||i;if(n in this){var r=e[i];"function"==typeof this[n]?this[n](r):this[n]=r}}return this}});e.exports=r},function(e,t,i){(function(e){function n(e,t,i){if(!e.hasOwnProperty(h)||!e[h]){var n=!i||i.applyValues!==!1,r=e.getAttribute("rt-bind"),s=e[h]=[];f.lastIndex=0;for(var a;a=f.exec(r);)!function(i,r,a){var o=new l(Function("var _ = this; return "+a+";").bind(t),{onchange:function(){c[i](e,this.get(),r)}});s.push(o),n&&c[i](e,o.get(),r)}(a[1],a[2],a[3]);e.removeAttribute("rt-bind"),e.setAttribute("rt-binding",r)}}function r(e){if(e.hasOwnProperty(h)){var t=e[h];if(t){for(var i=t.length;i;)t[--i].dispose();e[h]=null,e.setAttribute("rt-bind",e.getAttribute("rt-binding")),e.removeAttribute("rt-binding")}}}function s(e,t,i){i||(i={});var r=i.applyValues;i.bindRootElement!==!1&&e.hasAttribute("rt-bind")&&n(e,t,{applyValues:r});for(var s=e.querySelectorAll("[rt-bind]"),a=s.length;a;)n(s[--a],t,{applyValues:r});return e}function a(e,t){t&&t.bindRootElement===!1||!e.hasAttribute("rt-binding")||r(e);for(var i=e.querySelectorAll("[rt-binding]"),n=i.length;n;)r(i[--n]);return e}var o=i(1),l=o.Cell,h="__rt_dataCells__";e.Symbol&&"symbol"==typeof Symbol.iterator&&(h=Symbol(h)),t.KEY_DATA_CELLS=h;var c={prop:function(e,t,i){e[i]!==t&&(e[i]=t)},attr:function(e,t,i){null!=t&&t!==!1?(t=t===!0?i:t.toString(),e.getAttribute(i)!==t&&e.setAttribute(i,t)):e.hasAttribute(i)&&e.removeAttribute(i)},value:function(e,t){t=String(t),e.value!=t&&(e.value=t)},checked:function(e,t){t=!!t,e.checked!=t&&(e.checked=t)},disabled:function(e,t){e.disabled!=!!t&&(e.disabled=!!t)},"class":function(e,t,i){$(e).toggleClass(i,!!t)},mod:function(e,t,i){var n={};n[i]=!!t,$(e).mods(n)},show:function(e,t){t=t?"":"none",e.style.display!=t&&(e.style.display=t)},html:function(e,t){e.innerHTML=t},text:function(e,t,i){t=String(t);var n;switch(i){case"first":if(n=e.firstChild,!n||3!=n.nodeType)return void e.insertBefore(document.createTextNode(t),n);break;case"last":if(n=e.lastChild,!n||3!=n.nodeType)return void e.appendChild(document.createTextNode(t));break;case"prev":if(n=e.previousSibling,!n||3!=n.nodeType)return void e.parentNode.insertBefore(document.createTextNode(t),e);break;case"next":if(n=e.nextSibling,!n||3!=n.nodeType)return void e.parentNode.insertBefore(document.createTextNode(t),n);break;default:if(1!=e.childNodes.length||3!=e.firstChild.nodeType){for(;e.lastChild;)e.removeChild(e.lastChild);return void e.appendChild(document.createTextNode(t))}n=e.firstChild}n.nodeValue!=t&&(n.nodeValue=t)}};t.directiveHandlers=c;var u=Object.keys(c).join("|"),f=RegExp("\\s*("+u+")(?:\\(([^)]*)\\))?:\\s*(\\S[\\s\\S]*?)(?=\\s*(?:,\\s*(?:"+u+")(?:\\([^)]*\\))?:\\s*\\S|$))","g");t.bind=s,t.unbind=a}).call(t,function(){return this}())},function(e,t,i){(function(t){function n(){}function r(e){if(!(e in V))throw new TypeError('ViewClass "'+e+'" is not defined');return V[e]}function s(e,t){if(e in V)throw new TypeError('ViewClass "'+e+'" is already registered');return Object.defineProperty(t,"$viewClass",{value:e}),V[e]=t,t}function a(e){return e.replace(/[^$0-9a-zA-Z]([$0-9a-zA-Z])/g,function(e,t){return t.toUpperCase()})}function o(e,t){for(var i in t){var n=t[i];null!=n&&n!==!1&&e.push("_"+i+(n===!0?"":"_"+n))}return e}function l(e,t){for(var i in t)e.setAttribute(i,t[i])}function h(e,t,i){for(var n=e.children,r=!1,s=n.length;s;){var a=n[--s];a.blockName==t?(a.$(i),r=!0):h(a,t,i)&&(r=!0)}return r}function c(e,t){if(t[k]&&t[j]==e){t.parentNode&&t.parentNode.removeChild(t),C(t);var i=e.elements[t[k]];i.splice(i.indexOf(t),1),t[j]=null,t[k]=void 0}}function u(e){if(e._afterDataReceiving!=n)try{e._afterDataReceiving()}catch(t){e._logError(t)}}function f(e,t){if(e._receiveData==n)t.call(e);else{if(e._beforeDataReceiving!=n)try{e._beforeDataReceiving()}catch(i){e._logError(i)}try{e._receiveData.length?e._receiveData(function(i){e.disposed||(null!=i&&(e.dataReceivingError=i,e._logError(i)),u(e),t.call(e))}):e._receiveData()["catch"](function(t){e.disposed||(e.dataReceivingError=t,e._logError(t))}).then(function(){e.disposed||(u(e),t.call(e))})}catch(i){e.dataReceivingError=i,e._logError(i),u(e),t.call(e)}}}function d(e,t){var i=S.call(t.querySelectorAll("[rt-id]"),function(e,t){return e[t.getAttribute("rt-id")]=t,e},{});!function n(e){for(var t=e.children,r=t.length;r;){var s=t[--r],a=i[s._id];a[j]=s,s.block=$(a),n(s)}e.isDOMReady=!0,e.emit({type:"domready",bubbles:!1})}(e)}var p=i(2),v=i(4),_=i(6),g=i(9),m=i(11),b=p.isServer,y=v.assign,w=_.extend,E=m.bind,C=m.unbind,x=Object.prototype.hasOwnProperty,O=Array.prototype.slice,S=Array.prototype.reduce,j="__rt_BaseView_view__",k="__rt_BaseView_viewElementName__";t.Symbol&&"symbol"==typeof Symbol.iterator&&(j=Symbol(j),k=Symbol(k));var N={area:1,base:1,basefont:1,br:1,col:1,command:1,embed:1,frame:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1,circle:1,ellipse:1,line:1,path:1,polygone:1,polyline:1,rect:1,stop:1,use:1},V=Object.create(null),P=g.extend({"static":{KEY_VIEW:j,KEY_VIEW_ELEMENT_NAME:k,viewClasses:V,getViewClass:r,registerViewClass:s,extend:function(e,t){return s(e,w.call(this,t))}},tagName:"div",blockName:void 0,mods:null,attrs:null,_idCounter:0,_id:void 0,name:void 0,owner:null,app:null,model:null,_parent:null,get parent(){return this._parent},set parent(e){e?e.registerChild(this):this._parent&&this._parent.unregisterChild(this)},children:null,block:null,elements:null,isDOMReady:!1,_receiveData:n,_beforeDataReceiving:n,_afterDataReceiving:n,dataReceivingError:null,_currentlyRendering:!1,_childRenderings:null,_beforeRendering:n,template:function(){return""},isClientInited:!1,_initClient:n,constructor:function(e){if(g.call(this),e||(e={}),e.tagName&&(this.tagName=e.tagName),e.blockName)this.blockName=e.blockName;else if(!this.blockName){for(var t=Object.getPrototypeOf(this);Object.getPrototypeOf(t).constructor!=P;)t=Object.getPrototypeOf(t);t.blockName=a(t.constructor.$viewClass)}this.mods=Object.create(this.mods),e.mods&&y(this.mods,e.mods),this.attrs=Object.create(this.attrs),e.attrs&&y(this.attrs,e.attrs),e.name&&(this.name=e.name),e.owner&&(this.owner=e.owner);var i=e.parent;e.app?this.app=e.app:i&&i.app&&(this.app=i.app),e.model?this.model=e.model:i&&i.model?this.model=i.model:this.app&&(this.model=this.app.model),i&&(this.parent=i),this._id=this._nextID(),this.children=[];var n=b?null:e.block;if(null!==n){if(n){if(n.addClass&&n.append&&(n=n[0]),n[j])throw new TypeError("Element is already used as "+(n[k]?"an element":"a block")+" of view")}else n=document.createElement(this.tagName);n[j]=this,this.block=$(n)}this.elements={}},_nextID:function(){return this._parent?this._parent._nextID():String(++this._idCounter)},render:function(e){if(this._currentlyRendering)throw new TypeError("Can't run rendering when it is in process");if(this._beforeRendering!=n)try{this._beforeRendering()}catch(t){this._logError(t)}this._currentlyRendering=!0,f(this,function(){N.hasOwnProperty(this.tagName)?(this._currentlyRendering=!1,e.call(this,this._renderOpenTag())):this._renderInner(function(t){this._currentlyRendering=!1,e.call(this,this._renderOpenTag()+t+"</"+this.tagName+">",t)})})},_renderOpenTag:function(){var e=this.attrs,t=['class="'+(o([this.blockName],this.mods).join(" ")+" "+(e["class"]||"")).trim()+'"'];for(var i in e)"class"!=i&&t.push(i+'="'+e[i]+'"');return"<"+this.tagName+" "+t.join(" ")+' rt-id="'+this._id+'">';
},_renderInner:function(e){var t,i=this._childRenderings={count:0,readyCount:0,childTraces:[],results:[],onallready:null};try{t=this.template.call(this.owner||this)}catch(n){return this._childRenderings=null,this._logError(n),void e.call(this,"")}var r=this;i.onallready=function(){r._childRenderings=null;for(var n=i.childTraces,s=i.results,a=n.length;a;)t=t.replace(n[--a],function(){return s[a]});e.call(r,t)},i.count==i.readyCount&&i.onallready()},initClient:function(e){function t(){if(!this.isClientInited){this.isClientInited=!0;for(var t=this.children.slice(),r=0,s=t.length;s>r;r++)t[r].initClient();try{this._initClient!=n&&this._initClient(),E(i,this.owner||this)}catch(a){this._logError(a)}}e&&e.call(this)}var i=this.block[0];if(this.isDOMReady)t.call(this);else{var r=i.hasAttribute("rt-id");r||(l(i,this.attrs),i.className=(o([this.blockName],this.mods).join(" ")+" "+i.className).trim()),this.render(function(e,n){r||(i.innerHTML=n),d(this,i),t.call(this)})}return this},registerChild:function(e){if(e._parent){if(e._parent==this)return this;throw new TypeError("View is already used as a child of view")}e._parent=this;var t=this.children,i=e.name;return t.push(e),i&&(x.call(t,i)?t[i]:t[i]=[]).push(e),this},unregisterChild:function(e){if(e._parent!==this)return this;e._parent=null;var t=this.children,i=e.name;if(t.splice(t.indexOf(e),1),i){var n=t[i];n.splice(n.indexOf(e),1)}return this},broadcast:function(e,t){var i,n;/^<([^>]+)>(.+)$/.test(e)?(i=RegExp.$1,n=RegExp.$2):(i=e,n="*"),i=r(i);var s=[];!function o(e){for(var t=0,r=e.length;r>t;t++){var a=e[t];!("*"===i||a instanceof i)||"*"!=n&&a.name!==n||s.push(a),o(a.children)}}(this.children);var a=O.call(arguments,2);return s.map(function(e){return e.disposed||"function"!=typeof e[t]?void 0:e[t].apply(e,a)})},$:function(e){var t;if(x.call(this.elements,e))t=this.elements[e];else{t=this.block.find("."+this.blockName+"_"+e),h(this,this.blockName,e)&&(t=t.filter(function(){return!this[j]}));var i=this;t.each(function(){this[j]=i,this[k]=e}),this.elements[e]=t}var n=arguments.length;if(n>1){var r=1;do{var s=arguments[r],a="string"==typeof s;if(a||s instanceof HTMLElement){if(a){var c=document.createElement("div");c.innerHTML=s,s=1==c.childNodes.length&&1==c.firstChild.nodeType?c.firstChild:c}else if(s[j]){if(!s[k])throw new TypeError("Element is already used as a block of view");if(s[j]!=this||s[k]!=e)throw new TypeError("Element is already used as an element of view");continue}s.className=(this.blockName+"_"+e+" "+s.className).trim()}else{var u=s;s=document.createElement(u.tagName||"div"),u.attrs&&l(s,u.attrs);var f=[this.blockName+"_"+e];u.mods&&o(f,u.mods),s.className=(f.join(" ")+" "+s.className).trim(),u.html&&(s.innerHTML=u.html)}s[j]=this,s[k]=e,t.push(s),E(s,this.owner||this)}while(++r<n)}return t},$rm:function(){for(var e=arguments.length;e;){var t=arguments[--e];if("string"==typeof t){if(!x.call(this.elements,t))continue;t=this.elements[t]}if(t.addClass&&t.append){var i=this;t.each(function(){c(i,this)})}else c(this,t)}return this},_listenTo:function(e,t,i,n){var s;if(e instanceof P&&/^<([^>]+)>(.+)$/.test(t)){s=RegExp.$2;var a=r(RegExp.$1),o=i;i=function(e){return e.target instanceof a?o.call(this,e):void 0}}else s=t;return g.prototype._listenTo.call(this,e,s,i,n)},dispose:function(){var e=this.block&&this.block[0];e&&(e.parentNode&&e.parentNode.removeChild(e),C(e));for(var t=this.children,i=t.length;i;)t[--i].dispose();this.parent=null,e&&(e[j]=null),g.prototype.dispose.call(this)}});e.exports=P}).call(t,function(){return this}())},function(e,t,i){function n(e,t){"string"==typeof e&&(e=u(e)),t?(t.parent=this,t.block=null):t={parent:this,block:null};var i=this._childRenderings,n=i.count++,r=i.childTraces[n]="{{"+c()+"}}";return new e(t).render(function(e){i.results[n]=e,i.count==++i.readyCount&&i.onallready&&i.onallready()}),r}function r(e,t,i){if(e)if(e instanceof l?e=e.toObject():e instanceof h&&(e=e.toArray()),Array.isArray(e))for(var n=0,r=e.length;r>n;n++)n in e&&t.call(i,e[n],n);else for(var s in e)f.call(e,s)&&t.call(i,e[s],s)}var s=i(1),a=i(3),o=i(12),l=s.ObservableMap,h=s.ObservableList,c=a.next,u=o.getViewClass,f=Object.prototype.hasOwnProperty;t.defaults={include:n,helpers:{},each:r}},function(e,t,i){var n=i(12),r=i(13),s=n.getViewClass,a=r.defaults.include;n.extend("ViewList",{tagName:"ul",model:null,itemViewClass:null,getItemParams:null,constructor:function(e){n.call(this,e),this.itemViewClass=s(e.itemViewClass),e.getItemParams&&(this.getItemParams=e.getItemParams)},template:function(){var e=this.model;if("function"==typeof e&&(e=e(),!e))return"";var t=this.itemViewClass,i=this.getItemParams;return e.map(function(n,r){var s=i?i(n,r,e):{};return s.name="item",s.model=n,s.$index=r,'<li class="ViewList_item">'+a.call(this,t,s)+"</li>"},this).join("")},_initClient:function(){"function"==typeof this.model?this.listenTo(this,"change",{model:this._onModelChange}):this.listenTo(this.model,"change",this._onModelChange)},_onModelChange:function(){var e=this.model;"function"==typeof e&&(e=e(),e||(e=[]));var t=this.itemViewClass,i=this.getItemParams,n=this.children.item||(this.children.item=[]),r=this.block[0],s=n.map(function(e){return e.model}),a=Array.isArray(e)?e.slice():e.toArray();a.forEach(function(a,o){if(a!==s[o]){var l=s.indexOf(a,o+1);if(-1==l){var h=i?i(a,o,e):{};h.name="item",h.model=a,h.parent=this,h.$index=o,new t(h);var c=n.pop(),u=document.createElement("li");u.className="ViewList_item",u.appendChild(c.block[0]),o<n.length?r.insertBefore(u,n[o].block[0].parentNode):r.appendChild(u),n.splice(o,0,c),s.splice(o,0,c.model),c.initClient()}else r.insertBefore(n[l].block[0].parentNode,n[o].block[0].parentNode),n.splice(o,0,n.splice(l,1)[0]),s.splice(o,0,s.splice(l,1)[0])}},this),n.slice(a.length).forEach(function(e){var t=e.block[0].parentNode;t.parentNode.removeChild(t),e.dispose()})}})},function(e,t,i){var n=i(12),r=i(13),s=n.getViewClass,a=r.defaults.include;n.extend("ViewSwitch",{states:null,stateSource:null,initialState:void 0,_currentState:void 0,constructor:function(e){n.call(this,e),this.states=e.states,e.stateSource&&(this.stateSource=e.stateSource);var t;e.initialState&&(t=this.initialState=e.initialState);var i=t||(this.stateSource?this.stateSource():void 0);i&&this.states[i]||!this.states["default"]||(i="default"),i&&this.states[i]&&(this._currentState=i)},get currentState(){return this._currentState},set currentState(e){if(e&&this.states[e]||!this.states["default"]||(e="default"),this._currentState!==e)if(this._currentState&&this.children[0].dispose(),e&&this.states[e]){var t=this.states[e],i=Object.create(t.viewParams||null);i.parent=this;var n=new(s(t.viewClass))(i);n.block.appendTo(this.block),n.initClient(),this._currentState=e}else this._currentState=void 0},template:function(){var e=this._currentState;if(e&&this.states[e]){var t=this.states[e];return a.call(this,t.viewClass,t.viewParams||null)}return""},_initClient:function(){this.stateSource&&this.listenTo(this,"change",{stateSource:this._onStateSourceChange})},_onStateSourceChange:function(){this.currentState=this.stateSource()}})},function(e,t,i){function n(e){if(""!=e){if("NaN"==e)return NaN;var t=Number(e);if(t==t)return t}return e}function r(e){e=e.split("/");for(var t=e.length;t;)e[--t]=encodeURIComponent(decodeURIComponent(e[t]));return e.join("/")}function s(e){return"/"!=e[0]&&(e="/"+e),"/"!=e[e.length-1]&&(e+="/"),e}function a(e,t){var i=[];return e.pathModel.forEach(function(e){for(var n,r=e.requiredProperties,s=r.length;s--&&(n=t[r[s]],"function"==typeof n&&(n=n.call(t)),null!=n&&n!==!1&&""!==n););-1==s&&(void 0!==e.value?i.push(e.value):(n=t[e.property],"function"==typeof n&&(n=n.call(t)),i.push(n)))}),s(i.join(""))}function o(e,t,i){for(var n,r=null,s=t.values();!(n=s.next()).done;){for(var o=n.value,l=o.requiredProperties,h=l.length;h--;){var c=e[l[h]];if("function"==typeof c&&(c=c.call(e)),null==c||c===!1||""===c)break}if(-1==h)if(r)if(r.requiredProperties.length){if(l.length&&o===i){r=o;break}}else if(l.length){if(r=o,o===i)break}else o===i&&(r=o);else r=o}return r&&{node:r,path:a(r,e)}}function l(e,t){for(var i,r=t.values();!(i=r.next()).done;){var s=i.value,a=e.match(s.rePath);if(a)return{node:s,state:s.properties.reduce(function(e,t,i){return e[t.name]=1==t.type?!!a[i+1]:a[i+1]&&n(decodeURIComponent(a[i+1])),e},{})}}return null}var h=i(1),c=i(2),u=i(5),f=i(9),d=h.Map,p=c.isServer,v=c.isClient,_=u.escape,g=f.extend({app:null,viewBlock:null,nodes:null,started:!1,currentNode:null,currentNodeName:h(""),currentPath:void 0,constructor:function(e,t){f.call(this),this.app=e,this.nodes=new d,t&&t.forEach(function(e){this.addNode(e)},this),this.currentNodeName=this.currentNodeName.bind(this),this.currentNodeName.constructor=h},addNode:function(e){if(this.started)throw new TypeError("Can't add node to started router");var t=e.name;if(this.nodes.has(t))throw new TypeError('Node "'+t+'" is already exist');var i,n,s,a=e.path,o=e.callback,l=/\{([^}]+)\}/g,h=[],c=[],u=[],f=[];a=a.split(/\((?:\?([^\s)]+)\s+)?([^)]+)\)/g);for(var d=0,p=a.length;p>d;)if(d%3){f.push("("+(a[d]?"":"?:"));var v=[];a[d]&&(u.push({type:1,name:a[d]}),v.push(a[d])),i=a[d+1].split(l);for(var g=0,m=i.length;m>g;g++)g%2?(s=i[g],h.push({requiredProperties:v,value:void 0,property:s}),u.push({type:2,name:s}),f.push("([^\\/]+)"),v.push(s)):i[g]&&(n=r(i[g]),h.push({requiredProperties:v,value:n.split("*").join(""),property:void 0}),f.push(_(n).split("\\*").join(".*?")));f.push(")?"),d+=2}else{if(a[d]){i=a[d].split(l);for(var b=0,y=i.length;y>b;b++)b%2?(s=i[b],h.push({requiredProperties:[s],value:void 0,property:s}),c.push(s),u.push({type:0,name:s}),f.push("([^\\/]+)")):i[b]&&(n=r(i[b]),h.push({requiredProperties:[],value:n.split("*").join(""),property:void 0}),f.push(_(n).split("\\*").join(".*?")))}d++}return this.nodes.set(t,{name:t,pathModel:h,requiredProperties:c,properties:u,rePath:RegExp("^\\/?"+f.join("")+"\\/?$"),callback:o}),this},start:function(){if(this.started)return this;if(this.started=!0,v&&(this.viewBlock=this.app.view.block[0]),this._bindEvents(),p){var e=o(this.app.model,this.nodes,"/"==this.currentPath?null:this.currentNode);if(e){var t=e.node;this.currentNode=t,this.currentNodeName(t.name),this.currentPath=e.path,t.callback&&t.callback.call(this.app,e.path)}}return this},_bindEvents:function(){v&&(this.listenTo(window,"popstate",this._onWindowPopState),this.listenTo(this.viewBlock,"click",this._onViewBlockClick))},_onWindowPopState:function(){this.route(location.pathname,!1)},_onViewBlockClick:function(e){for(var t=this.viewBlock,i=e.target;"A"!=i.tagName;){if(i==t)return;if(i=i.parentNode,!i)return}var n=i.getAttribute("href");!/^(?:\w+:)?\/\//.test(n)&&-1==n.indexOf("#")&&this.route(n)&&e.preventDefault()},route:function(e,t){if(e=r(e.replace(/[\/\\]+/g,"/")),"/"!=e[0]){var i=location.pathname;e=i+("/"==i[i.length-1]?"":"/")+e}if("/"!=e[e.length-1]&&(e+="/"),e===this.currentPath)return!0;var n=l(e,this.nodes);if(!n)return!1;var s=this.app.model,a=n.state;for(var o in a)"function"==typeof s[o]?s[o](a[o]):s[o]=a[o];return this._route(n.node,e,t),!0},redirect:function(e,t){if(e=this.nodes.get(e),!e)return!1;for(var i=this.app.model,n=e.requiredProperties,r=n.length;r--;){var s=i[n[r]];if("function"==typeof s&&(s=s.call(i)),null==s||s===!1||""===s)break}if(-1!=r)return!1;var o=a(e,i);return o!==this.currentPath&&this._route(e,o,t),!0},_route:function(e,t,i){this.currentNode=e,this.currentNodeName(e.name),this.currentPath=t,v&&(i!==!1?history.pushState({},null,t):history.replaceState(history.state,null,t)),e.callback&&e.callback.call(this.app,t)}});e.exports=g},function(e,t,i){var n=i(2),r=i(6),s=i(16),a=n.isClient,o=r.extend({model:null,view:null,router:null,request:null,_init:function(e){this.model=new e.modelClass;var t=this.router=new s(this,e.nodes);t.route(e.path,!1);var i=this.view=new e.viewClass({app:this,block:e.viewBlock||null});t.start(),e.request&&(this.request=e.request),a&&i.initClient()},dispose:function(){this.router.dispose(),this.view.dispose(),this.model.dispose()}});e.exports=o},function(e,t){function i(e,t,i){var n=i.initializer?i.initializer():i.value;return{configurable:!1,enumerable:i.enumerable,get:function(){var e=i.value=n.bind(this);for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);return e.constructor!=n.constructor&&Object.defineProperty(e,"constructor",{configurable:!0,writable:!0,value:n.constructor}),Object.defineProperty(this,t,i),this[t]}}}t.autobind=i}])});