!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("superagent")):"function"==typeof define&&define.amd?define(["superagent"],e):"object"==typeof exports?exports.Rift=e(require("superagent")):t.Rift=e(t.superagent)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var n=i(1);e.nextTick=n.nextTick,e.EventEmitter=n.EventEmitter,e.ActiveMap=n.ActiveMap,e.map=n.map,e.ActiveList=n.ActiveList,e.list=n.list,e.Cell=n.Cell,e.cellx=e.cell=n,e.env=i(2),e.uid=i(3),e.object=i(4),e.regex=i(5);var r=e.Class=i(6);n.EventEmitter.extend=r.extend,e.bindCells=i(7),e.Disposable=i(8),e.proxy=i(9),e.BaseModel=i(11),e.domBinding=i(12);var s=i(13);e.viewClasses=s.viewClasses,e.registerViewClass=s.registerViewClass,e.BaseView=s,e.templateRuntime=i(14),e.ViewList=i(15),e.ViewSwitch=i(16),e.Router=i(17),e.BaseApp=i(18)},function(t,e,i){!function(e){"use strict";function i(t,e){function n(t){return s(n,r,e,this,t,h.call(arguments,1),arguments.length)}e||(e={});var r=t;return n.constructor=i,n}function n(t){return-1!=t.toString().indexOf("[native code]")}function r(t,e){function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t}var s,a=Object.prototype.hasOwnProperty,o=Object.prototype.toString,l=Array.prototype.push,h=Array.prototype.slice,c=Array.prototype.splice,u=Function("return this;")();t.exports=i;var f="__cellx_uid__",d="__cellx_inner__",p="__cellx_cells__";u.Symbol&&"symbol"==typeof Symbol.iterator&&(f=Symbol(f),d=Symbol(d),p=Symbol(p)),i.KEY_UID=f,i.KEY_INNER=d,i.KEY_CELLS=p;var v,_=0;v=u.console?console.error?function(t){console.error(t===Object(t)&&t.stack||t)}:function(t){console.log("!!! "+(t===Object(t)&&t.stack||t))}:function(){},i.logError=v;var g=Object.create||function(t){function e(){}return e.prototype=t,new e},m=Object.assign||function(t,e){for(var i in e)a.call(e,i)&&(t[i]=e[i]);return t},y=Object.is||function(t,e){return t===e||t!=t&&e!=e},b=Array.isArray||function(t){return"[object Array]"==o.call(t)};!function(){var t,e=Object.create;t=e&&n(e)?function(){return e(null)}:function(){var e=document.createElement("iframe"),i=document.body||document.documentElement;e.style.display="none",i.appendChild(e),e.src="javascript:";var n=e.contentWindow.Object.prototype;return i.removeChild(e),e=null,delete n.constructor,delete n.isPrototypeOf,delete n.hasOwnProperty,delete n.propertyIsEnumerable,delete n.valueOf,delete n.toString,delete n.toLocaleString,t=function(){},t.prototype=n,new t},i.Dictionary=t}(),function(){var t=u.Map;if(!t){var r=i.Dictionary,s={value:e};t=function(t){if(this._entries=new r,this._objectStamps={},this._first=null,this._last=null,this.size=0,t)for(var e=0,i=t.length;i>e;e++)this.set(t[e][0],t[e][1])},m(t.prototype,{has:function(t){return!!this._entries[this._getValueStamp(t)]},get:function(t){return(this._entries[this._getValueStamp(t)]||s).value},set:function(t,e){var i=this._entries,n=this._getValueStamp(t);if(i[n])i[n].value=e;else{var r=i[n]={key:t,keyStamp:n,value:e,prev:this._last,next:null};this.size++?this._last.next=r:this._first=r,this._last=r}return this},"delete":function(t){var e=this._getValueStamp(t),i=this._entries[e];if(!i)return!1;if(--this.size){var n=i.prev,r=i.next;n?n.next=r:this._first=r,r?r.prev=n:this._last=n}else this._first=null,this._last=null;return delete this._entries[e],delete this._objectStamps[e],!0},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return this._getObjectStamp(t)},_getObjectStamp:function(){function t(t){var e,i=this._objectStamps;for(e in i)if(i[e]==t)return e;return e=String(++_),i[e]=t,e}return Object.defineProperty&&n(Object.defineProperty)&&Object.isExtensible&&n(Object.isExtensible)?function(e){if(!a.call(e,f)){if(!Object.isExtensible(e))return t.call(this,e);Object.defineProperty(e,f,{value:String(++_)})}return e[f]}:t}(),forEach:function(t,e){null==e&&(e=u);for(var i=this._first;i;){t.call(e,i.value,i.key,this);do i=i.next;while(i&&!this._entries[i.keyStamp])}},toString:function(){return"[object Map]"}});for(var o=[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]],l=0,h=o.length;h>l;l++)t.prototype[o[l][0]]=function(t){return function(){var i,n=this._entries,r=!1,s=this;return{next:function(){if(!r){if(i){do i=i.next;while(i&&!n[i.keyStamp])}else i=s._first;if(i)return{value:t(i),done:!1};r=!0}return{value:e,done:!0}}}}}(o[l][1])}i.Map=t}(),function(){var t;if(u.process&&"[object process]"==process.toString()&&process.nextTick)t=process.nextTick;else if(u.setImmediate)t=function(t){setImmediate(t)};else if(u.Promise&&n(Promise)){var e=Promise.resolve();t=function(t){e.then(function(){t()})}}else if(u.postMessage&&!u.ActiveXObject){var r;u.addEventListener("message",function(){if(r){var t=r;r=null;for(var e=0,n=t.length;n>e;e++)try{t[e]()}catch(s){i.logError(s)}}},!1),t=function(t){r?r.push(t):(r=[t],u.postMessage("__tic__","*"))}}else t=function(t){setTimeout(t,1)};i.nextTick=t}(),function(){function t(){this.parent=null,this._events=new n}var n=i.Dictionary;m(t.prototype,{on:function(t,e,i){if("object"==typeof t){i=e;var n=t;for(t in n)this._on(t,n[t],i)}else this._on(t,e,i);return this},off:function(t,e,i){if(t)if("object"==typeof t){i=e;var r=t;for(t in r)this._off(t,r[t],i)}else this._off(t,e,i);else this._events&&(this._events=new n);return this},_on:function(t,e,i){var r=(this._events||(this._events=new n))[t];r||(r=this._events[t]=[]),r.push({listener:e,context:i||this})},_off:function(t,e,i){var n=this._events&&this._events[t];if(n){i||(i=this);for(var r=n.length;r;)if(n[--r].context==i){var s=n[r].listener;if(s==e||s.hasOwnProperty(d)&&s[d]==e){n.splice(r,1);break}}n.length||delete this._events[t]}},once:function(t,e,i){function n(){return this._off(t,n,i),e.apply(this,arguments)}return n[d]=e,this._on(t,n,i),this},emit:function(t){return"string"==typeof t?t={target:this,type:t}:t.target===e&&(t.target=this),this._handleEvent(t),t},_handleEvent:function(t){var e=this._events&&this._events[t.type];if(e){e=e.slice();for(var i=0,n=e.length;n>i;i++)try{e[i].listener.call(e[i].context,t)===!1&&(t.isPropagationStopped=!0)}catch(r){this._logError(r)}}this.parent&&t.bubbles!==!1&&!t.isPropagationStopped&&this.parent._handleEvent(t)},_logError:function(t){i.logError(t)}}),i.EventEmitter=t}();var w;!function(){var t=i.EventEmitter;w={_onItemChange:function(t){this._handleEvent(t)},_registerValue:function(e){var i=this._valueCounts,n=i.get(e);n?i.set(e,n+1):(i.set(e,1),this.adoptsItemChanges&&e instanceof t&&e.on("change",this._onItemChange,this))},_unregisterValue:function(e){var i=this._valueCounts,n=i.get(e);n>1?i.set(e,n-1):(i["delete"](e),this.adoptsItemChanges&&e instanceof t&&e.off("change",this._onItemChange,this))},dispose:function(){if(this.adoptsItemChanges){var e=this._onItemChange;this._valueCounts.forEach(function(i){i instanceof t&&i.off("change",e,this)},this)}}}}(),function(){function t(e,i){if(this._entries=new s,this._valueCounts=new s,this.size=0,this.adoptsItemChanges=!i||i.adoptsItemChanges!==!1,e){var n=this._entries;if(e instanceof t)e._entries.forEach(function(t,e){n.set(e,t),this._registerValue(t)},this);else if(b(e))for(var r=0,a=e.length;a>r;r++){var o=e[r];n.set(o[0],o[1]),this._registerValue(o[1])}else for(var l in e)n.set(l,e[l]),this._registerValue(e[l]);this.size=n.size}}function n(e,i){return new t(e,"boolean"==typeof i?{adoptsItemChanges:i}:i)}var s=i.Map;r(t,i.EventEmitter),m(t.prototype,w),m(t.prototype,{has:function(t){return this._entries.has(t)},contains:function(t){return this._valueCounts.has(t)},get:function(t){return this._entries.get(t)},set:function(t,e){var i,n=this._entries,r=n.has(t);if(r){if(i=n.get(t),y(i,e))return this;this._unregisterValue(i)}return n.set(t,e),this._registerValue(e),r||this.size++,this.emit({type:"change",subtype:r?"update":"add",key:t,oldValue:i,value:e}),this},"delete":function(t){var i=this._entries;if(!i.has(t))return!1;var n=i.get(t);return i["delete"](t),this._unregisterValue(n),this.size--,this.emit({type:"change",subtype:"delete",key:t,oldValue:n,value:e}),!0},clear:function(){return this.size?(this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit({type:"change",subtype:"clear"}),this):this},forEach:function(t,e){null==e&&(e=u),this._entries.forEach(function(i,n){t.call(e,i,n,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges})}}),i.ActiveMap=t,i.map=n}(),function(){function t(t,e){return e>t?-1:t>e?1:0}function n(t,e){var i=t._items;if(t.sorted)for(var n=t.comparator,r=0,s=e.length;s>r;r++){for(var a=e[r],o=0,h=i.length;o!=h;){var c=o+h>>1;n(a,i[c])<0?h=c:o=c+1}i.splice(o,0,a),t._registerValue(a)}else{l.apply(i,e);for(var u=e.length;u;)t._registerValue(e[--u])}t.length=i.length}function s(e,i){i||(i={}),this._items=[],this._valueCounts=new o,this.length=0,this.adoptsItemChanges=i.adoptsItemChanges!==!1,this.comparator=null,this.sorted=!1,(i.sorted||i.comparator&&i.sorted!==!1)&&(this.comparator=i.comparator||t,this.sorted=!0),e&&n(this,e instanceof s?e._items:e)}function a(t,e){return new s(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var o=i.Map,h=Array.prototype;r(s,i.EventEmitter),m(s.prototype,w),m(s.prototype,{_validateIndex:function(t,i){if(t===e)return t;if(0>t){if(t+=this.length,0>t)throw new RangeError("Index out of range")}else if(t>=this.length+(i?1:0))throw new RangeError("Index out of range");return t},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._items.indexOf(t,this._validateIndex(e))},lastIndexOf:function(t,e){return this._items.lastIndexOf(t,this._validateIndex(e))},get:function(t){return this._items[this._validateIndex(t)]},getRange:function(t,i){t=this._validateIndex(t||0,!0);var n=this._items;if(i===e)return n.slice(t);if(t+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');return n.slice(t,t+i)},set:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=this._items;return y(i[t],e)?this:(this._unregisterValue(i[t]),i[t]=e,this._registerValue(e),this.emit("change"),this)},setRange:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=e.length;if(!i)return this;if(t+i>this.length)throw new RangeError('"index" and length of "items" do not denote a valid range');for(var n=this._items,r=!1,s=t+i;s>t;){var a=e[--s];y(n[s],a)||(this._unregisterValue(n[s]),n[s]=a,this._registerValue(a),r=!0)}return r&&this.emit("change"),this},add:function(t){return this.addRange([t]),this},addRange:function(t){return t.length?(n(this,t),this.emit("change"),this):this},insert:function(t,e){return this.insertRange(t,[e]),this},insertRange:function(t,e){if(this.sorted)throw new TypeError("Can't insert to sorted list");t=this._validateIndex(t,!0);var i=e.length;if(!i)return this;c.apply(this._items,[].concat(t,0,e));for(var n=i;n;)this._registerValue(e[--n]);return this.length+=i,this.emit("change"),this},remove:function(t,e){var i=this._items.indexOf(t,this._validateIndex(e));return-1==i?this:(this._items.splice(i,1),this._unregisterValue(t),this.length--,this.emit("change"),this)},removeAll:function(t,e){for(var i=this._items,n=this._validateIndex(e),r=!1;-1!=(n=i.indexOf(t,n));)i.splice(n,1),this._unregisterValue(t),r=!0;return r&&(this.length=i.length,this.emit("change")),this},removeAt:function(t){return this._unregisterValue(this._items.splice(this._validateIndex(t),1)[0]),this.length--,this.emit("change"),this},removeRange:function(t,i){t=this._validateIndex(t||0,!0);var n=this._items;if(i===e)i=n.length-t;else if(t+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');if(!i)return this;for(var r=t+i;r>t;)this._unregisterValue(n[--r]);return n.splice(t,i),this.length-=i,this.emit("change"),this},clear:function(){return this.length&&(this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit("change")),this},join:function(t){return this._items.join(t)},forEach:null,map:null,filter:null,every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice()},toString:function(){return this._items.join()}});for(var u=["forEach","map","filter","every","some","reduce","reduceRight"],f=u.length;f;)!function(t){s.prototype[t]=function(){return h[t].apply(this._items,arguments)}}(u[--f]);i.ActiveList=s,i.list=a}(),function(){function t(){if(!(c>u)){l=!0;do{var t=h[c];if(t){var e=t.shift();if(c){var i=c;e._recalc(),h[i].length||(h[i]=null,c&&c++)}else{var n=e._changeEvent;e._fixedValue=e._value,e._changeEvent=null,e._changed=!0,e._events.change&&e._handleEvent(n);for(var r=e._slaves,s=r.length;s;){var a=r[--s];a._fixed&&((h[1]||(h[1]=[])).push(a),u||(u=1),a._fixed=!1)}h[0].length||c++}}else c++}while(u>=c);u=-1,p++,l=!1}}function n(t,i){a.call(this),i||(i={}),this.owner=i.owner||null,this.computed="function"==typeof t&&(i.computed!==e?i.computed:t.constructor==Function),this._value=e,this._fixedValue=e,this.initialValue=e,this._formula=null,this._read=i.read||null,this._write=i.write||null,this._validate=i.validate||null,this._masters=null,this._slaves=[],this._level=0,this._active=!this.computed,this._changeEvent=null,this._isChangeCancellable=!0,this._lastErrorEvent=null,this._fixed=!0,this._version=0,this._changed=!1,this._circularityCounter=0,this.computed?this._formula=t:(this._validate&&this._validate.call(this.owner||this,t),this._value=this._fixedValue=this.initialValue=t,t instanceof a&&t.on("change",this._onValueChange,this)),i.onchange&&this.on("change",i.onchange),i.onerror&&this.on("error",i.onerror)}var s=i.nextTick,a=i.EventEmitter,o={original:null},l=!1,h=[[]],c=0,u=-1,f=null,p=1;r(n,a),m(n.prototype,{changed:function(){return l||t(),this._changed},on:function(e,i,n){return l||t(),!this.computed||this._events.change||this._slaves.length||this._activate(),a.prototype.on.call(this,e,i,n),this},off:function(e,i,n){return l||t(),a.prototype.off.call(this,e,i,n),!this.computed||this._events.change||this._slaves.length||this._deactivate(),this},_on:function(t,e,i){a.prototype._on.call(this,t,e,i||this.owner)},_off:function(t,e,i){a.prototype._off.call(this,t,e,i||this.owner)},subscribe:function(t){function e(e){return t.call(this,e.error||null,e)}return e[d]=t,this.on("change",e).on("error",e),this},unsubscribe:function(t){return this.off("change",t).off("error",t),this},_registerSlave:function(t){!this.computed||this._events.change||this._slaves.length||this._activate(),this._slaves.push(t)},_unregisterSlave:function(t){this._slaves.splice(this._slaves.indexOf(t),1),!this.computed||this._events.change||this._slaves.length||this._deactivate()},_activate:function(){if(this._version!=p){this._masters=null,this._level=0;var t=this._tryFormula();t===o?this._handleError(o.original):y(this._value,t)||(this._value=t,this._changed=!0),this._version=p}for(var e=this._masters||[],i=e.length;i;)e[--i]._registerSlave(this);this._active=!0},_deactivate:function(){for(var t=this._masters||[],e=t.length;e;)t[--e]._unregisterSlave(this);this._active=!1},_onValueChange:function(e){this._changeEvent?(e.prev=this._changeEvent,this._changeEvent=e,this._value===this._fixedValue&&(this._isChangeCancellable=!1)):(h[0].push(this),c=0,-1==u&&(u=0),e.prev=null,this._changeEvent=e,this._isChangeCancellable=!1,l||s(t))},read:function(){if(f&&(f._masters?-1==f._masters.indexOf(this)&&(f._masters.push(this),f._level<=this._level&&(f._level=this._level+1)):(f._masters=[this],f._level=this._level+1)),l||t(),this.computed&&!this._active&&this._version!=p){this._masters=null,this._level=0;var e=this._tryFormula();if(e===o)this._handleError(o.original);else{var i=this._value;y(i,e)||(this._value=e,this._changed=!0)}this._version=p}return this._read?this._read.call(this.owner||this,this._value):this._value},write:function(e){if(this.computed&&!this._write)throw new TypeError("Cannot write to read-only cell");var i=this._value;return y(i,e)?!1:(this._validate&&this._validate.call(this.owner||this,e),this.computed?this._write.call(this.owner||this,e):(this._value=e,i instanceof a&&i.off("change",this._onValueChange,this),e instanceof a&&e.on("change",this._onValueChange,this),this._changeEvent?y(e,this._fixedValue)&&this._isChangeCancellable?(1==h[0].length?(h[0].pop(),u||(u=-1)):h[0].splice(h[0].indexOf(this),1),this._changeEvent=null):this._changeEvent={target:this,type:"change",oldValue:i,value:e,prev:this._changeEvent}:(h[0].push(this),c=0,-1==u&&(u=0),this._changeEvent={target:this,type:"change",oldValue:i,value:e,prev:null},this._isChangeCancellable=!0,l||s(t))),!0)},_recalc:function(){if(this._version==p+1){if(10==++this._circularityCounter)return this._fixed=!0,this._version=p+1,void this._handleError(new RangeError("Circular dependency detected"))}else this._circularityCounter=1;var t=this._masters;this._masters=null;var e=this._level;this._level=0;for(var i=this._tryFormula(),n=this._masters||[],r=!1,s=t.length;s;){var l=t[--s];-1==n.indexOf(l)&&(l._unregisterSlave(this),r=!0)}if(r||t.length<n.length){for(var c=n.length;c;){var f=n[--c];-1==t.indexOf(f)&&f._registerSlave(this)}var d=this._level;if(d>e)return(h[d]||(h[d]=[])).push(this),void(d>u&&(u=d))}if(this._fixed=!0,this._version=p+1,i===o)this._handleError(o.original);else{var v=this._value;if(!y(v,i)||i instanceof a){this._value=i,this._changed=!0,this._events.change&&this.emit({type:"change",oldValue:v,value:i,prev:null});for(var _=this._slaves,g=_.length;g;){var m=_[--g];if(m._fixed){var b=m._level;(h[b]||(h[b]=[])).push(m),b>u&&(u=b),m._fixed=!1}}}}},_tryFormula:function(){var t=f;f=this;try{var e=this._formula.call(this.owner||this);return this._validate&&this._validate.call(this.owner||this,e),e}catch(i){return o.original=i,o}finally{f=t}},_handleError:function(t){this._logError(t),this._handleErrorEvent({type:"error",error:t})},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,this._handleEvent(t);for(var e=this._slaves,i=e.length;i&&!t.isPropagationStopped;)e[--i]._handleErrorEvent(t)}},dispose:function(){return l||t(),this._dispose(),this},_dispose:function(){if(this.off(),this._active)for(var t=this._slaves,e=t.length;e;)t[--e]._dispose()}}),i.Cell=n}(),function(){var t=i.Map,e=i.Cell,n=e.prototype;s=function(r,s,l,h,c,f,d){h&&h!=u||(h=r),a.call(h,p)||Object.defineProperty(h,p,{value:new t});var v=h[p].get(r);if(!v){if(null!=s&&"object"==typeof s)if("function"==typeof s.clone)s=s.clone();else if(b(s))s=s.slice();else if(s.constructor===Object)s=m({},s);else switch(o.call(s)){case"[object Date]":s=new Date(s);break;case"[object RegExp]":s=new RegExp(s)}l=g(l),l.owner=h,v=new e(s,l),h[p].set(r,v)}switch(d){case 0:return v.read();case 1:return v.write(c);default:return"bind"===c?(r=r.bind(h),r.constructor=i,r):"unwrap"===c?v:n[c].apply(v,f)}}}()}()},function(t,e){var i="undefined"==typeof window&&"undefined"==typeof navigator;e.isServer=i,e.isClient=!i},function(t,e){(function(t){function i(t){return(t||"")+ ++r}var n="__rt_uid__";t.Symbol&&"symbol"==typeof Symbol.iterator&&(n=Symbol(n)),e.KEY=n;var r=0;e.next=i}).call(e,function(){return this}())},function(t,e,i){function n(t,e){for(var i=Object.getOwnPropertyNames(e),n=i.length;n;)Object.defineProperty(t,i[--n],Object.getOwnPropertyDescriptor(e,i[n]));return t}var r,s=i(3),a=s.KEY,o=s.next;if("symbol"==typeof a)r=function(t,e){return t[a]||(t[a]=o(e))};else{var l=Object.prototype.hasOwnProperty;r=function(t,e){return l.call(t,a)||Object.defineProperty(t,a,{value:o(e)}),t[a]}}e.getUID=r;var h=Object.assign||function(t,e){for(var i=Object.keys(e),n=i.length;n;)t[i[--n]]=e[i[n]];return t};e.assign=h,e.mixin=n},function(t,e){function i(t){return t.replace(n,"\\$1")}var n=/([?+|$(){}[^.\-\]\/\\*])/g;e.escape=i},function(t,e,i){function n(t,i){"object"==typeof t&&(i=t,t=void 0);var r,o=this==e?Object:this;a.call(i,"constructor")?(r=i.constructor,delete i.constructor):r=o==Object?function(){}:function(){return o.apply(this,arguments)};var l=Object.create(o.prototype);return r.prototype=l,Object.defineProperty(l,"constructor",{configurable:!0,writable:!0,value:r}),Object.keys(o).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(o,t))}),a.call(i,"static")&&(s(r,i["static"]),delete i["static"]),r.extend||(r.extend=n),s(l,i),r}var r=i(4),s=r.mixin,a=Object.prototype.hasOwnProperty;e.extend=n},function(t,e,i){function n(t){return Object.keys(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e),n=i.value;"function"==typeof n&&n.constructor==r&&(t[e]=n.bind(t),t[e].constructor=r)}),t}var r=i(1);t.exports=n},function(t,e,i){var n=i(1),r=i(3),s=n.EventEmitter,a=r.next,o=s.extend({_disposables:null,disposed:!1,constructor:function(){s.call(this),this._disposables=Object.create(null)},listenTo:function(t,e,i,n){function r(){for(var t=o.length;t;)o[--t].stop();delete d._disposables[f]}var s,o;if(Array.isArray(t)||"function"==typeof $&&t instanceof $){o=[];for(var l=t.length;l;)o.push(this.listenTo(t[--l],e,i,n))}else if("object"==typeof e){n=i,s=e,o=[];for(e in s)o.push(this.listenTo(t,e,s[e],n))}else if(Array.isArray(i)){s=i,o=[];for(var h=0,c=s.length;c>h;h++)o.push(this.listenTo(t,e,s[h],n))}else{if("object"!=typeof i)return this._listenTo(t,e,i,n);s=i,o=[];for(var u in s)o.push(this.listenTo(t[u]("unwrap",0),e,s[u],n))}var f=a(),d=this,p=this._disposables[f]={stop:r,dispose:r};return p},_listenTo:function(t,e,i,n){function r(){o in l._disposables&&(t instanceof s?t.off(e,i,n):t.removeEventListener(e,i,!1),delete l._disposables[o])}n||(n=this);var o=a(),l=this;if(t instanceof s)t.on(e,i,n);else{if("function"!=typeof t.addEventListener)throw new TypeError("Unable to add a listener");t!=n&&(i=i.bind(n)),t.addEventListener(e,i,!1)}var h=this._disposables[o]={stop:r,dispose:r};return h},registerCallback:function(t){function e(){return n in r._disposables?(delete r._disposables[n],t.apply(r,arguments)):void 0}function i(){delete r._disposables[n]}var n=a(),r=this;return e.cancel=i,e.dispose=i,this._disposables[n]=e,e},setTimeout:function(t,e){function i(){n in r._disposables&&(i(s),delete r._disposables[n])}var n=a(),r=this,s=setTimeout(function(){delete r._disposables[n],t.call(r)},e),o=this._disposables[n]={clear:i,dispose:i};return o},dispose:function(){if(!this.disposed){var t=this._disposables;for(var e in t)t[e].dispose();this.disposed=!0}}});t.exports=o},function(t,e,i){function n(){return JSON.stringify(o)}function r(t){o=JSON.parse(t)}function s(){o={}}var a=i(10),o={};e.serializeCache=n,e.deserializeCache=r,e.clearCache=s,["get","head","del","patch","post","put"].forEach(function(t){e[t]=function(e,i){i||(i={});var n=[].slice.call(arguments),r=JSON.stringify(n);if(i.noCache!==!0&&o.hasOwnProperty(r)){var s=JSON.parse(o[r]);return s.error?Promise.reject(s):Promise.resolve(s)}return new Promise(function(n,s){var l=a[t](e),h=i.headers;return h&&Object.keys(h).forEach(function(t){l.set(t,h[t])}),i.withCredentials&&l.withCredentials(),"get"==t?i.query&&l.query(i.query):i.data&&l.send("object"==typeof i.data?JSON.stringify(i.data):i.data),l.end(function(t,e){e={status:e.status,headers:e.headers,error:t?{name:t.name,message:t.message}:null,body:e.body},o[r]=JSON.stringify(e),e.error?s(e):n(e)})})}})},function(e,i){e.exports=t},function(t,e,i){var n=i(1),r=i(7),s=i(8),a=s.extend({constructor:function(t){s.call(this),this._initAssets&&(this._initAssets(t||{}),r(this))},collectDumpObject:function(t){for(var e=Object.keys(this),i=0,r=e.length;r>i;i++){var s=Object.getOwnPropertyDescriptor(this,e[i]).value;if("function"==typeof s&&s.constructor==n){var a=s("unwrap",0);if(!a.computed){var o=a.read();(o===Object(o)?a.changed():a.initialValue!==o)&&(t[e[i]]=o)}}}},expandFromDumpObject:function(t){for(var e in t)this[e](t[e])}});t.exports=a},function(t,e,i){(function(t){function n(t,e,i){if(!t.hasOwnProperty(h)||!t[h]){var n=!i||i.applyValues!==!1,r=t.getAttribute("rt-bind"),s=t[h]=[];f.lastIndex=0;for(var a;a=f.exec(r);)!function(i,r,a){var o=new l(Function("var _ = this; return "+a+";").bind(e),{onchange:function(){c[i](t,this.read(),r)}});s.push(o),n&&c[i](t,o.read(),r)}(a[1],a[2],a[3]);t.removeAttribute("rt-bind"),t.setAttribute("rt-binding",r)}}function r(t){if(t.hasOwnProperty(h)){var e=t[h];if(e){for(var i=e.length;i;)e[--i].dispose();t[h]=null,t.setAttribute("rt-bind",t.getAttribute("rt-binding")),t.removeAttribute("rt-binding")}}}function s(t,e,i){i||(i={});var r=i.applyValues;i.bindRootElement!==!1&&t.hasAttribute("rt-bind")&&n(t,e,{applyValues:r});for(var s=t.querySelectorAll("[rt-bind]"),a=s.length;a;)n(s[--a],e,{applyValues:r});return t}function a(t,e){e&&e.bindRootElement===!1||!t.hasAttribute("rt-binding")||r(t);for(var i=t.querySelectorAll("[rt-binding]"),n=i.length;n;)r(i[--n]);return t}var o=i(1),l=o.Cell,h="__rt_dataCells__";t.Symbol&&"symbol"==typeof Symbol.iterator&&(h=Symbol(h)),e.KEY_DATA_CELLS=h;var c={prop:function(t,e,i){t[i]!==e&&(t[i]=e)},attr:function(t,e,i){null!=e&&e!==!1?(e=e===!0?i:e.toString(),t.getAttribute(i)!==e&&t.setAttribute(i,e)):t.hasAttribute(i)&&t.removeAttribute(i)},value:function(t,e){e=String(e),t.value!=e&&(t.value=e)},checked:function(t,e){e=!!e,t.checked!=e&&(t.checked=e)},disabled:function(t,e){t.disabled!=!!e&&(t.disabled=!!e)},"class":function(t,e,i){$(t).toggleClass(i,!!e)},mod:function(t,e,i){var n={};n[i]=!!e,$(t).mods(n)},show:function(t,e){e=e?"":"none",t.style.display!=e&&(t.style.display=e)},html:function(t,e){t.innerHTML=e},text:function(t,e,i){e=String(e);var n;switch(i){case"first":if(n=t.firstChild,!n||3!=n.nodeType)return void t.insertBefore(document.createTextNode(e),n);break;case"last":if(n=t.lastChild,!n||3!=n.nodeType)return void t.appendChild(document.createTextNode(e));break;case"prev":if(n=t.previousSibling,!n||3!=n.nodeType)return void t.parentNode.insertBefore(document.createTextNode(e),t);break;case"next":if(n=t.nextSibling,!n||3!=n.nodeType)return void t.parentNode.insertBefore(document.createTextNode(e),n);break;default:if(1!=t.childNodes.length||3!=t.firstChild.nodeType){for(;t.lastChild;)t.removeChild(t.lastChild);return void t.appendChild(document.createTextNode(e))}n=t.firstChild}n.nodeValue!=e&&(n.nodeValue=e)}};e.directiveHandlers=c;var u=Object.keys(c).join("|"),f=RegExp("\\s*("+u+")(?:\\(([^)]*)\\))?:\\s*(\\S[\\s\\S]*?)(?=\\s*(?:,\\s*(?:"+u+")(?:\\([^)]*\\))?:\\s*\\S|$))","g");e.bind=s,e.unbind=a}).call(e,function(){return this}())},function(t,e,i){(function(e){function n(){}function r(t){if(!(t in P))throw new TypeError('ViewClass "'+t+'" is not defined');return P[t]}function s(t,e){if(t in P)throw new TypeError('ViewClass "'+t+'" is already registered');return Object.defineProperty(e,"$viewClass",{value:t}),P[t]=e,e}function a(t){return t.replace(/[^$0-9a-zA-Z]([$0-9a-zA-Z])/g,function(t,e){return e.toUpperCase()})}function o(t,e){for(var i in e){var n=e[i];null!=n&&n!==!1&&t.push("_"+i+(n===!0?"":"_"+n))}return t}function l(t,e){for(var i in e)t.setAttribute(i,e[i])}function h(t,e,i){for(var n=t.children,r=!1,s=n.length;s;){var a=n[--s];a.blockName==e?(a.$(i),r=!0):h(a,e,i)&&(r=!0)}return r}function c(t,e){if(e.hasOwnProperty(N)&&e[N]&&e[k]==t){e.parentNode&&e.parentNode.removeChild(e),x(e);var i=t.elements[e[N]];i.splice(i.indexOf(e),1),e[k]=null,e[N]=void 0}}function u(t){if(t._afterDataReceiving!=n)try{t._afterDataReceiving()}catch(e){t._logError(e)}}function f(t,e){if(t._receiveData==n)e.call(t);else{if(t._beforeDataReceiving!=n)try{t._beforeDataReceiving()}catch(i){t._logError(i)}try{t._receiveData.length?t._receiveData(function(i){t.disposed||(null!=i&&(t.dataReceivingError=i,t._logError(i)),u(t),e.call(t))}):t._receiveData()["catch"](function(e){t.disposed||(t.dataReceivingError=e,t._logError(e))}).then(function(){t.disposed||(u(t),e.call(t))})}catch(i){t.dataReceivingError=i,t._logError(i),u(t),e.call(t)}}}function d(t,e){var i=S.call(e.querySelectorAll("[rt-id]"),function(t,e){return t[e.getAttribute("rt-id")]=e,t},{});!function n(t){for(var e=t.children,r=e.length;r;){var s=e[--r],a=i[s._id];a[k]=s,s.block=$(a),n(s)}t.isDOMReady=!0,t.emit({type:"domready",bubbles:!1})}(t)}var p=i(2),v=i(4),_=i(6),g=i(7),m=i(8),y=i(12),b=p.isServer,w=v.assign,E=_.extend,C=y.bind,x=y.unbind,O=Object.prototype.hasOwnProperty,j=Array.prototype.slice,S=Array.prototype.reduce,k="__rt_view__",N="__rt_viewElementName__";e.Symbol&&"symbol"==typeof Symbol.iterator&&(k=Symbol(k),N=Symbol(N));var V=w(Object.create(null),{area:1,base:1,basefont:1,br:1,col:1,command:1,embed:1,frame:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1,circle:1,ellipse:1,line:1,path:1,polygone:1,polyline:1,rect:1,stop:1,use:1}),P=Object.create(null),A=m.extend({"static":{KEY_VIEW:k,KEY_VIEW_ELEMENT_NAME:N,viewClasses:P,getViewClass:r,registerViewClass:s,extend:function(t,e){return s(t,E.call(this,void 0,e))}},tagName:"div",blockName:void 0,mods:null,attrs:null,_idCounter:0,_id:void 0,name:void 0,owner:null,app:null,model:null,_parent:null,get parent(){return this._parent},set parent(t){t?t.registerChild(this):this._parent&&this._parent.unregisterChild(this)},children:null,block:null,elements:null,isDOMReady:!1,_receiveData:n,_beforeDataReceiving:n,_afterDataReceiving:n,dataReceivingError:null,_currentlyRendering:!1,_childRenderings:null,_beforeRendering:n,template:function(){return""},isClientInited:!1,_initClient:n,constructor:function(t){m.call(this),t||(t={});var e=t.parent;if(t.app?this.app=t.app:e&&e.app&&(this.app=e.app),t.model?this.model=t.model:e&&e.model?this.model=e.model:this.app&&(this.model=this.app.model),this._initAssets&&(this._initAssets(t),g(this)),t.tagName&&(this.tagName=t.tagName),t.blockName)this.blockName=t.blockName;else if(!this.blockName){for(var i=Object.getPrototypeOf(this);Object.getPrototypeOf(i).constructor!=A;)i=Object.getPrototypeOf(i);i.blockName=a(i.constructor.$viewClass)}this.mods=Object.create(this.mods),t.mods&&w(this.mods,t.mods),this.attrs=Object.create(this.attrs),t.attrs&&w(this.attrs,t.attrs),t.name&&(this.name=t.name),t.owner&&(this.owner=t.owner),e&&(this.parent=e),this._id=this._nextID(),this.children=[];var n=b?null:t.block;if(null!==n){if(n){if(n instanceof $&&(n=n[0]),n.hasOwnProperty(k)&&n[k])throw new TypeError("Element is already used as "+(n.hasOwnProperty(N)&&n[N]?"an element":"a block")+" of view")}else n=document.createElement(this.tagName);n[k]=this,this.block=$(n)}this.elements={},n&&(n.hasAttribute("rt-id")?this.render(function(){d(this,n)}):(l(n,this.attrs),n.className=(o([this.blockName],this.mods).join(" ")+" "+n.className).trim(),this._currentlyRendering=!0,f(this,function(){this._renderInner(function(t){this._currentlyRendering=!1,n.innerHTML=t,d(this,n)})})))},_nextID:function(){return this._parent?this._parent._nextID():String(++this._idCounter)},render:function(t){if(this._currentlyRendering)throw new TypeError("Can't run rendering when it is in process");if(this._beforeRendering!=n)try{this._beforeRendering()}catch(e){this._logError(e)}this._currentlyRendering=!0,f(this,function(){this.tagName in V?(this._currentlyRendering=!1,t.call(this,this._renderOpenTag())):this._renderInner(function(e){this._currentlyRendering=!1,t.call(this,this._renderOpenTag()+e+"</"+this.tagName+">");

})})},_renderOpenTag:function(){var t=this.attrs,e=['class="'+(o([this.blockName],this.mods).join(" ")+" "+(t["class"]||"")).trim()+'"'];for(var i in t)"class"!=i&&e.push(i+'="'+t[i]+'"');return"<"+this.tagName+" "+e.join(" ")+' rt-id="'+this._id+'">'},_renderInner:function(t){var e,i=this._childRenderings={count:0,readyCount:0,childTraces:[],results:[],onallready:null};try{e=this.template.call(this.owner||this)}catch(n){return this._childRenderings=null,this._logError(n),void t.call(this,"")}var r=this;i.onallready=function(){r._childRenderings=null;for(var n=i.childTraces,s=i.results,a=n.length;a;)e=e.replace(n[--a],function(){return s[a]});t.call(r,e)},i.count==i.readyCount&&i.onallready()},initClient:function(t){function e(){if(!this.isClientInited){this.isClientInited=!0;for(var e=this.children.slice(),i=0,r=e.length;r>i;i++)e[i].initClient();try{this._initClient!=n&&this._initClient(),C(this.block[0],this.owner||this)}catch(s){this._logError(s)}}t&&t.call(this)}return this.isDOMReady?e.call(this):this.once("domready",e),this},registerChild:function(t){if(t._parent){if(t._parent==this)return this;throw new TypeError("View is already used as a child of view")}t._parent=this;var e=this.children,i=t.name;return e.push(t),i&&(O.call(e,i)?e[i]:e[i]=[]).push(t),this},unregisterChild:function(t){if(t._parent!==this)return this;t._parent=null;var e=this.children,i=t.name;if(e.splice(e.indexOf(t),1),i){var n=e[i];n.splice(n.indexOf(t),1)}return this},broadcast:function(t,e){var i,n;/^(.+?):(.+)$/.test(t)?(i=RegExp.$1,n=RegExp.$2):(i=t,n="*"),i=r(i);var s=[];!function o(t){for(var e=0,r=t.length;r>e;e++){var a=t[e];!("*"===i||a instanceof i)||"*"!=n&&a.name!==n||s.push(a),o(a.children)}}(this.children);var a=j.call(arguments,2);return s.map(function(t){return t.disposed||"function"!=typeof t[e]?void 0:t[e].apply(t,a)})},$:function(t){var e;if(O.call(this.elements,t))e=this.elements[t];else{e=this.block.find("."+this.blockName+"_"+t),h(this,this.blockName,t)&&(e=e.filter(function(){return!this.hasOwnProperty(k)||!this[k]}));var i=this;e.each(function(){this[k]=i,this[N]=t}),this.elements[t]=e}var n=arguments.length;if(n>1){var r=1;do{var s=arguments[r],a="string"==typeof s;if(a||s instanceof HTMLElement){if(a){var c=document.createElement("div");c.innerHTML=s,s=1==c.childNodes.length&&1==c.firstChild.nodeType?c.firstChild:c}else if(s.hasOwnProperty(k)&&s[k]){if(!s.hasOwnProperty(N)||!s[N])throw new TypeError("Element is already used as a block of view");if(s[k]!=this||s[N]!=t)throw new TypeError("Element is already used as an element of view");continue}s.className=(this.blockName+"_"+t+" "+s.className).trim()}else{var u=s;s=document.createElement(u.tagName||"div"),u.attrs&&l(s,u.attrs);var f=[this.blockName+"_"+t];u.mods&&o(f,u.mods),s.className=(f.join(" ")+" "+s.className).trim(),u.html&&(s.innerHTML=u.html)}s[k]=this,s[N]=t,e.push(s),C(s,this.owner||this)}while(++r<n)}return e},$rm:function(){for(var t=arguments.length;t;){var e=arguments[--t];if("string"==typeof e){if(!O.call(this.elements,e))continue;e=this.elements[e]}if(e instanceof $){var i=this;e.each(function(){c(i,this)})}else c(this,e)}return this},_listenTo:function(t,e,i,n){var s;if(t instanceof A){var a;if(/^(.+?):(.+)$/.test(e)){var o=RegExp.$1;s=RegExp.$2,"*"!=o&&(o=r(o),a=i,i=function(t){return t.target instanceof o?a.call(this,t):void 0})}else{s=e,a=i;var l=this;i=function(t){return t.target==l?a.call(this,t):void 0}}}else s=e;return m.prototype._listenTo.call(this,t,s,i,n)},dispose:function(){var t=this.block&&this.block[0];t&&(t.parentNode&&t.parentNode.removeChild(t),x(t));for(var e=this.children,i=e.length;i;)e[--i].dispose();this.parent=null,t&&(t[k]=null),m.prototype.dispose.call(this)}});t.exports=A}).call(e,function(){return this}())},function(t,e,i){function n(t,e){"string"==typeof t&&(t=u(t)),e?(e.parent=this,e.block=null):e={parent:this,block:null};var i=this._childRenderings,n=i.count++,r=i.childTraces[n]="{{"+c()+"}}";return new t(e).render(function(t){i.results[n]=t,i.count==++i.readyCount&&i.onallready&&i.onallready()}),r}function r(t,e,i){if(t)if(t instanceof l?t=t.toObject():t instanceof h&&(t=t.toArray()),Array.isArray(t))for(var n=0,r=t.length;r>n;n++)n in t&&e.call(i,t[n],n);else for(var s in t)f.call(t,s)&&e.call(i,t[s],s)}var s=i(1),a=i(3),o=i(13),l=s.ActiveMap,h=s.ActiveList,c=a.next,u=o.getViewClass,f=Object.prototype.hasOwnProperty;e.defaults={include:n,helpers:{},each:r}},function(t,e,i){var n=i(13),r=i(14),s=n.getViewClass,a=r.defaults.include;n.extend("ViewList",{tagName:"ul",model:null,itemViewClass:null,getItemParams:null,_initAssets:function(t){this.itemViewClass=s(t.itemViewClass),t.getItemParams&&(this.getItemParams=t.getItemParams)},template:function(){var t=this.model;if("function"==typeof t&&(t=t(),!t))return"";var e=this.itemViewClass,i=this.getItemParams;return t.map(function(n,r){var s=i?i(n,r,t):{};return s.name="item",s.model=n,s.$index=r,'<li class="ViewList_item">'+a.call(this,e,s)+"</li>"},this).join("")},_initClient:function(){"function"==typeof this.model?this.listenTo(this,"change",{model:this._onModelChange}):this.listenTo(this.model,"change",this._onModelChange)},_onModelChange:function(){var t=this.model;"function"==typeof t&&(t=t(),t||(t=[]));var e=this.itemViewClass,i=this.getItemParams,n=this.children.item||(this.children.item=[]),r=this.block[0],s=n.map(function(t){return t.model}),a=Array.isArray(t)?t.slice():t.toArray();a.forEach(function(a,o){if(a!==s[o]){var l=s.indexOf(a,o+1);if(-1==l){var h=i?i(a,o,t):{};h.name="item",h.model=a,h.parent=this,h.$index=o,new e(h);var c=n.pop(),u=document.createElement("li");u.className="ViewList_item",u.appendChild(c.block[0]),o<n.length?r.insertBefore(u,n[o].block[0].parentNode):r.appendChild(u),n.splice(o,0,c),s.splice(o,0,c.model),c.initClient()}else r.insertBefore(n[l].block[0].parentNode,n[o].block[0].parentNode),n.splice(o,0,n.splice(l,1)[0]),s.splice(o,0,s.splice(l,1)[0])}},this),n.slice(a.length).forEach(function(t){var e=t.block[0].parentNode;e.parentNode.removeChild(e),t.dispose()})}})},function(t,e,i){var n=i(13),r=i(14),s=n.getViewClass,a=r.defaults.include;n.extend("ViewSwitch",{states:null,stateSource:null,initialState:void 0,_currentState:void 0,_initAssets:function(t){this.states=t.states,t.stateSource&&(this.stateSource=t.stateSource);var e;t.initialState&&(e=this.initialState=t.initialState);var i=e||(this.stateSource?this.stateSource():void 0);i&&this.states[i]||!this.states["default"]||(i="default"),i&&this.states[i]&&(this._currentState=i)},get currentState(){return this._currentState},set currentState(t){if(t&&this.states[t]||!this.states["default"]||(t="default"),this._currentState!==t)if(this._currentState&&this.children[0].dispose(),t&&this.states[t]){var e=this.states[t],i=Object.create(e.viewParams||null);i.parent=this;var n=new(s(e.viewClass))(i);n.block.appendTo(this.block),n.initClient(),this._currentState=t}else this._currentState=void 0},template:function(){var t=this._currentState;if(t&&this.states[t]){var e=this.states[t];return a.call(this,e.viewClass,e.viewParams||null)}return""},_initClient:function(){this.stateSource&&this.listenTo(this,"change",{stateSource:this._onStateSourceChange})},_onStateSourceChange:function(){this.currentState=this.stateSource()}})},function(t,e,i){function n(t){if(""!=t){if("NaN"==t)return 0/0;var e=Number(t);if(e==e)return e}return t}function r(t){t=t.split("/");for(var e=t.length;e;)t[--e]=encodeURIComponent(decodeURIComponent(t[e]));return t.join("/")}function s(t){return"/"!=t[0]&&(t="/"+t),"/"!=t[t.length-1]&&(t+="/"),t}function a(t,e){var i=[];return t.pathModel.forEach(function(t){for(var n=t.requiredProperties,r=n.length;r--;){var s=e[n[r]]();if(null==s||s===!1||""===s)break}-1==r&&i.push(void 0!==t.value?t.value:e[t.property]())}),s(i.join(""))}function o(t,e,i){for(var n,r=null,s=e.values();!(n=s.next()).done;){for(var o=n.value,l=o.requiredProperties,h=l.length;h--;){var c=t[l[h]]();if(null==c||c===!1||""===c)break}if(-1==h)if(r)if(r.requiredProperties.length){if(l.length&&o===i){r=o;break}}else if(l.length){if(r=o,o===i)break}else o===i&&(r=o);else r=o}return r&&{node:r,path:a(r,t)}}function l(t,e){for(var i,r=e.values();!(i=r.next()).done;){var s=i.value,a=t.match(s.rePath);if(a)return{node:s,state:s.properties.reduce(function(t,e,i){return t[e.name]=1==e.type?!!a[i+1]:a[i+1]&&n(decodeURIComponent(a[i+1])),t},{})}}return null}var h=i(1),c=i(2),u=i(5),f=i(8),d=h.Map,p=c.isServer,v=c.isClient,_=u.escape,g=f.extend({app:null,viewBlock:null,nodes:null,started:!1,currentNode:null,currentNodeName:h(""),currentPath:void 0,constructor:function(t,e){f.call(this),this.app=t,this.nodes=new d,e&&e.forEach(function(t){this.addNode(t)},this),this.currentNodeName=this.currentNodeName.bind(this),this.currentNodeName.constructor=h},addNode:function(t){if(this.started)throw new TypeError("Can't add node to started router");var e=t.name;if(this.nodes.has(e))throw new TypeError('Node "'+e+'" is already exist');var i,n,s,a=t.path,o=t.callback,l=/\{([^}]+)\}/g,h=[],c=[],u=[],f=[];a=a.split(/\((?:\?([^\s)]+)\s+)?([^)]+)\)/g);for(var d=0,p=a.length;p>d;)if(d%3){f.push("("+(a[d]?"":"?:"));var v=[];a[d]&&(u.push({type:1,name:a[d]}),v.push(a[d])),i=a[d+1].split(l);for(var g=0,m=i.length;m>g;g++)g%2?(s=i[g],h.push({requiredProperties:v,value:void 0,property:s}),u.push({type:2,name:s}),f.push("([^\\/]+)"),v.push(s)):i[g]&&(n=r(i[g]),h.push({requiredProperties:v,value:n.split("*").join(""),property:void 0}),f.push(_(n).split("\\*").join(".*?")));f.push(")?"),d+=2}else{if(a[d]){i=a[d].split(l);for(var y=0,b=i.length;b>y;y++)y%2?(s=i[y],h.push({requiredProperties:[s],value:void 0,property:s}),c.push(s),u.push({type:0,name:s}),f.push("([^\\/]+)")):i[y]&&(n=r(i[y]),h.push({requiredProperties:[],value:n.split("*").join(""),property:void 0}),f.push(_(n).split("\\*").join(".*?")))}d++}return this.nodes.set(e,{name:e,pathModel:h,requiredProperties:c,properties:u,rePath:RegExp("^\\/?"+f.join("")+"\\/?$"),callback:o}),this},start:function(){if(this.started)return this;if(this.started=!0,v&&(this.viewBlock=this.app.view.block[0]),this._bindEvents(),p){var t=o(this.app.model,this.nodes,"/"==this.currentPath?null:this.currentNode);if(t){var e=t.node;this.currentNode=e,this.currentNodeName(e.name),this.currentPath=t.path,e.callback&&e.callback.call(this.app,t.path)}}return this},_bindEvents:function(){v&&(this.listenTo(window,"popstate",this._onWindowPopState),this.listenTo(this.viewBlock,"click",this._onViewBlockClick))},_onWindowPopState:function(){this.route(location.pathname,!1)},_onViewBlockClick:function(t){for(var e=this.viewBlock,i=t.target;"A"!=i.tagName;){if(i==e)return;if(i=i.parentNode,!i)return}var n=i.getAttribute("href");!/^(?:\w+:)?\/\//.test(n)&&-1==n.indexOf("#")&&this.route(n)&&t.preventDefault()},route:function(t,e){var i,n=this.app.model;if(this.nodes.has(t)){if(i=o(n,this.nodes,this.nodes.get(t)),!i)return!1;if(t=i.path,t===this.currentPath)return!0}else{if(t=r(t.replace(/[\/\\]+/g,"/")),"/"!=t[0]){var s=location.pathname;t=s+("/"==s[s.length-1]?"":"/")+t}if("/"!=t[t.length-1]&&(t+="/"),t===this.currentPath)return!0;if(i=l(t,this.nodes),!i)return!1;var a=i.state;for(var h in a)n[h](a[h])}var c=i.node;return this.currentNode=c,this.currentNodeName(c.name),this.currentPath=t,v&&(e!==!1?history.pushState({},null,t):history.replaceState(history.state,null,t)),c.callback&&c.callback.call(this.app,t),!0}});t.exports=g},function(t,e,i){var n=i(2),r=i(6),s=i(17),a=n.isClient,o=r.extend({model:null,view:null,router:null,_init:function(t){this.model=new t.modelClass;var e=this.router=new s(this,t.nodes);e.route(t.path,!1);var i=this.view=new t.viewClass({app:this,block:a?t.viewBlock:null});e.start(),a&&i.initClient()},dispose:function(){this.router.dispose(),this.view.dispose(),this.model.dispose()}});t.exports=o}])});