!function(t){"use strict";function e(t){console.error(t===Object(t)&&t.stack||t)}function n(t,e){return t===e||t!=t&&e!=e}function i(t){for(var e in t)return!1;return!0}var r,a=Function("return this;")();r="undefined"!=typeof exports?exports:a.Rift=a.rt={},r.global=a;var s=r.KEY_INNER="_rt-inner",o=r.KEY_USED="_rt-used",l="_rt-dataCells",u="_rt-view",c="_rt-viewElementName",h=r.isServer="undefined"==typeof window&&"undefined"==typeof navigator,f=r.isClient=!h,p=r.$=f?a.jQuery||a.Zepto||a.ender||a.$:t,d=Object.prototype.hasOwnProperty,v=Array.prototype.slice;r.logError=e,Object.getOwnPropertySymbols||(Object.getOwnPropertySymbols=function(t){return[]}),Object.assign||Object.defineProperty(Object,"assign",{configurable:!0,writable:!0,value:function(t,e){if(null==t)throw new TypeError("Can't convert "+t+" to an object");t=Object(t);for(var n=1,i=arguments.length;i>n;n++){var r=arguments[n];if(null==r)throw new TypeError("Can't convert "+r+" to an object");r=Object(r);for(var a=Object.keys(r),s=0,o=a.length;o>s;s++)t[a[s]]=r[a[s]];for(var l=Object.getOwnPropertySymbols(r),s=0,o=l.length;o>s;s++)t[l[s]]=r[l[s]]}return t}}),function(){function t(t){return 2176782335==e&&(e=0),(t||"")+(++e).toString(36)}var e=0;r.uid={next:t}}(),function(){function t(t,e){for(var n=Object.getOwnPropertyNames(e),i=n.length;i;)Object.defineProperty(t,n[--i],Object.getOwnPropertyDescriptor(e,n[i]));return t}function e(e){return t(Object.create(Object.getPrototypeOf(e)),e)}var n,i=r.uid.next;if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){var a=Symbol("uid");n=function(t,e){return t[a]||(t[a]=i(e))}}else{var a="_rt-uid";n=function(t,e){return d.call(t,a)||Object.defineProperty(t,a,{value:i(e)}),t[a]}}r.object={getUID:n,mixin:t,clone:e}}(),function(){function t(t,e){"string"==typeof t&&(t=t.split("."));for(var n=e||a,i=0,r=t.length;r>i;i++){var s=n[t[i]];if(s!==Object(s)){do n=n[t[i]]={};while(++i<r);break}n=s}return n}function e(t,e){return Function("return this."+t+";").call(e||a)}r.namespace={create:t,exec:e}}(),function(){function t(t){return t.replace(n,"\\$1")}function e(t,e,n){if(t.global){t.lastIndex=0;for(var i;(i=t.exec(e))&&n.apply(a,i)!==!1;);}else{var i=t.exec(e);i&&n.apply(a,i)}}var n=/([?+|$(){}[^.\-\]\/\\*])/g;r.regex={escape:t,forEach:e}}(),function(){function e(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return"#"+a(t)}function n(t){return t.replace(s,function(t){return o[t]||"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})}function i(e){if(e===t)return"void 0";if(null===e)return"null";var r=typeof e;if("object"==r){var a=[];if(Array.isArray(e)){for(var s=e.length;s;)a[--s]=s in e?i(e[s]):"";a="["+a.join(",")+(""==a[a.length-1]?",]":"]")}else{for(var o in e)d.call(e,o)&&a.push((l.test(o)?o:"'"+n(o)+"'")+":"+i(e[o]));a="{"+a+"}"}return a.replace(c,"</'+'$1>")}return"string"==r?"'"+n(e).replace(c,"</'+'$1>")+"'":"number"==r&&e&&e%1e3==0?String(e).replace(u,function(t){return"e"+t.length}):String(e)}var a=r.object.getUID,s=RegExp("[\\\\'\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]","g"),o=Object.assign(Object.create(null),{"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"}),l=/^[$_a-zA-Z][$\w]*$/,u=/0+$/,c=/<\/(script\b[^>]*)>/gi;r.value={getStamp:e,stringify:i}}(),function(){var t;if(a.process&&process.nextTick)t=process.nextTick;else if(a.setImmediate)t=function(t){setImmediate(t)};else if(a.Promise){var e=Promise.resolve();t=function(t){e.then(function(){t()})}}else if(a.postMessage&&!a.ActiveXObject){var n;a.addEventListener("message",function(){if(n){var t=n;n=null;for(var e=0,i=t.length;i>e;e++)try{t[e]()}catch(a){r.logError(a)}}},!1),t=function(t){n?n.push(t):(n=[t],a.postMessage("__tic__","*"))}}else t=function(t){setTimeout(t,1)};r.process={nextTick:t}}(),function(){function e(t){if(!(t in o))throw new TypeError('Class "'+t+'" is not defined');return o[t]}function n(t,e){if(t in o)throw new TypeError('Class "'+t+'" is already registered');return Object.defineProperty(e,"__class",{value:t}),o[t]=e,e}function i(e,r){"object"==typeof e&&(r=e,e=t);var o,l=this==a?Object:this;d.call(r,"constructor")?(o=r.constructor,delete r.constructor):o=l==Object?function(){}:function(){return l.apply(this,arguments)};var u=Object.create(l.prototype);return o.prototype=u,Object.defineProperty(o,"$super",{writable:!0,value:l.prototype}),Object.defineProperty(u,"constructor",{configurable:!0,writable:!0,value:o}),Object.keys(l).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(l,t))}),d.call(r,"static")&&(s(o,r["static"]),delete r["static"]),o.extend===t&&(o.extend=i),s(u,r),e&&n(e,o),o}var a,s=r.object.mixin,o=Object.create(null);a={classes:o,getOrError:e,register:n,extend:i},r.Class=a}(),function(){function e(n,r){var a=s(n);if(r.hasOwnProperty(a))return a;var o={},l={};if(n.constructor.hasOwnProperty("__class")?(n.collectDumpObject?n.collectDumpObject(o,l):Object.assign(o,n),r[a]={c:n.constructor.__class}):(Object.assign(o,n),r[a]={}),!i(o)){for(var u in o){var c=o[u];o[u]=c===Object(c)?e(c,r):c===t?{}:{v:c}}r[a].d=o}return i(l)||(r[a].o=l),a}function n(t){var n={};return o({s:n,r:e(t,n)})}function a(e){"string"==typeof e&&(e=Function("return "+e+";")());var n=e.s;for(var i in n){var r=n[i];if(r.hasOwnProperty("c")){var a=l[r.c];r.instance=r.hasOwnProperty("o")?new a(t,r.o):new a}else r.instance={}}for(var i in n){var r=n[i];if(r.hasOwnProperty("d")){var s=r.d;for(var o in s){var u=s[o];s[o]="object"==typeof u?u.hasOwnProperty("v")?u.v:t:n[u].instance}r.hasOwnProperty("c")&&r.instance.expandFromDumpObject?r.instance.expandFromDumpObject(s):Object.assign(r.instance,s)}}return n[e.r].instance}var s=r.object.getUID,o=r.value.stringify,l=r.Class.classes,u=r.Class.register;u("Array",Array),u("Date",Date),Object.defineProperties(Date.prototype,{collectDumpObject:{configurable:!0,writable:!0,value:function(t){t.utc=this.toString()}},expandFromDumpObject:{configurable:!0,writable:!0,value:function(t){this.setTime(new Date(t.utc))}}}),r.dump={serialize:n,deserialize:a}}(),a.Map||!function(){function e(t){if(this._entries=Object.create(null),t)for(var e=0,n=t.length;n>e;e++)this.set(t[e][0],t[e][1])}var n=r.value.getStamp,i={value:t};r.object.mixin(e.prototype,{_entries:null,_first:null,_last:null,size:0,has:function(t){return n(t)in this._entries},get:function(t){return(this._entries[n(t)]||i).value},set:function(t,e){var i=this._entries,r=n(t);if(r in i)i[r].value=e;else{var a=i[r]={key:t,keyStamp:r,value:e,prev:this._last,next:null};this.size++?this._last.next=a:this._first=a,this._last=a}return this},"delete":function(t){var e=this._entries,i=n(t);if(!(i in e))return!1;if(--this.size){var r=e[i].prev,a=e[i].next;r?r.next=a:this._first=a,a?a.prev=r:this._last=r}else this._first=null,this._last=null;return delete e[i],!0},forEach:function(t,e){null==e&&(e=a);for(var n=this._entries,i=this._first;i;){t.call(e,i.value,i.key,this);do i=i.next;while(i&&!(i.keyStamp in n))}},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._first=null,this._last=null,this.size=0}}),[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]].forEach(function(n){e.prototype[n[0]]=function(e){return function(){var n,i=this._entries,r=!1,a=this;return{next:function(){if(!r){if(n){do n=n.next;while(n&&!(n.keyStamp in i))}else n=a._first;if(n)return{value:e(n),done:!1};r=!0}return{value:t,done:!0}}}}}(n[1])}),a.Map=e}(),a.Set||!function(){function t(t){if(this._entries=new Map,t)for(var e=0,n=t.length;n>e;e++)this.add(t[e])}r.object.mixin(t.prototype,{_entries:null,get size(){return this._entries.size},has:function(t){return this._entries.has(t)},add:function(t){return this._entries.set(t,t),this},"delete":function(t){return this._entries["delete"](t)},forEach:function(t,e){null==e&&(e=a),this._entries.forEach(function(n){t.call(e,n,n,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clear:function(){this._entries.clear()}}),a.Set=t}(),function(){var e=r.Class.extend({target:null,type:t,timestamp:t,detail:null,bubbles:!0,isPropagationStopped:!1,isImmediatePropagationStopped:!1,constructor:function(t,e){this.type=t,e===!1&&(this.bubbles=!1)},stopPropagation:function(){this.isPropagationStopped=!0},stopImmediatePropagation:function(){this.isPropagationStopped=!0,this.isImmediatePropagationStopped=!0}});r.Event=e}(),function(){var e=r.Event,n=r.Class.extend({_events:null,parent:null,silent:!1,on:function(t,e,n){if("object"==typeof t){n=e;var i=t;for(t in i)this._on(t,i[t],n)}else this._on(t,e,n);return this},_on:function(t,e,n){var i=(this._events||(this._events=new Map)).get(t);i||(i=[],this._events.set(t,i)),i.push({listener:e,context:n||this})},off:function(e,n,i){if(e===t)this._events=null;else if("object"==typeof e){i=n;var r=e;for(e in r)this._off(e,r[e],i)}else this._off(e,n,i);return this},_off:function(t,e,n){var i=this._events||(this._events=new Map).get(t);if(i){n||(n=this);for(var r=i.length;r;)if(i[--r].context==n){var a=i[r].listener;if(a==e||a.hasOwnProperty(s)&&a[s]==e){i.splice(r,1);break}}i.length||this._events["delete"](t)}},once:function(t,e,n){function i(){this._off(t,i,n),e.apply(this,arguments)}return i[s]=e,this._on(t,i,n)},emit:function(t,n){if("string"==typeof t)t=new e(t);else if(t.hasOwnProperty(o))throw new TypeError("Attempt to use an object that is no longer usable");return t[o]=!0,t.target=this,t.timestamp=Date.now(),n&&(t.detail=n),this._handleEvent(t),t},_handleEvent:function(t){if(!this.silent||t.target!=this){var e=t.type,n=(this._events&&this._events.get(e)||[]).slice(0);"function"==typeof this["on"+e]&&n.push({listener:this["on"+e],context:this});for(var i=0,r=n.length;r>i&&!t.isImmediatePropagationStopped;i++)try{n[i].listener.call(n[i].context,t)===!1&&t.stopPropagation()}catch(a){this._logError(a)}}this.parent&&t.bubbles&&!t.isPropagationStopped&&this.parent._handleEvent(t)},_logError:function(t){r.logError(t)}});r.EventEmitter=n}(),function(){var e=r.EventEmitter,i=e.extend("Rift.ActiveDictionary",{_data:null,_valueCounts:null,_adoptItemChanges:!1,constructor:function(t,n){e.call(this);var r=new Map,a=new Map,s="boolean"==typeof n?n:!!n&&n.adoptItemChanges;if(t){t instanceof i&&(t=t._data);for(var o in t){var l=t[o];r.set(o,l),a.has(l)?a.set(l,a.get(l)+1):(a.set(l,1),s&&l instanceof e&&l.on("change",this._onItemChange,this))}}this._data=r,this._valueCounts=a,s&&(this._adoptItemChanges=!0)},_onItemChange:function(t){this._handleEvent(t)},has:function(t){return this._data.has(t)},get:function(t){return this._data.get(t)},set:function(t,i){var r;"string"==typeof t?(r={},r[t]=i):r=t;var a=this._data,s=this._valueCounts,o=this._adoptItemChanges,l=!1,u=new Set,c=[],h=[],f={$removedValues:c,$addedValues:h};for(t in r){var p=a.has(t),d=a.get(t),v=r[t];if(!p||!n(d,v)){if(l=!0,p){var g=s.get(d)-1;g?s.set(d,g):(s["delete"](d),o&&d instanceof e&&d.off("change",this._onItemChange),u.add(d))}s.has(v)?s.set(v,s.get(v)+1):(s.set(v,1),o&&v instanceof e&&v.on("change",this._onItemChange,this),u["delete"](v)||h.push(v)),f[t]={type:p?"update":"add",oldValue:d,value:v},a.set(t,v)}}return l&&(u.forEach(function(t){c.push(t)}),this.emit("change",{diff:f})),this},"delete":function(){for(var n=this._data,i=this._valueCounts,r=this._adoptItemChanges,a=!1,s=[],o={$removedValues:s,$addedValues:[]},l=0,u=arguments.length;u>l;l++){var c=arguments[l];if(n.has(c)){a=!0;var h=n.get(c),f=i.get(h)-1;f?i.set(h,f):(i["delete"](h),r&&h instanceof e&&h.off("change",this._onItemChange),s.push(h)),o[c]={type:"delete",oldValue:h,value:t},n["delete"](c)}}return a&&this.emit("change",{diff:o}),this},contains:function(t){return this._valueCounts.has(t)},clone:function(){return new this.constructor(this,{adoptItemChanges:this._adoptItemChanges})},toObject:function(){var t={};return this._data.forEach(function(e,n){t[n]=e}),t},collectDumpObject:function(t,e){this._data.forEach(function(e,n){t[n]=e}),this._adoptItemChanges&&(e.adoptItemChanges=!0)},expandFromDumpObject:function(t){this.set(t)},dispose:function(){if(this._adoptItemChanges){var t=this._onItemChange;this._valueCounts.forEach(function(n){n instanceof e&&n.off("change",t)})}}});r.ActiveDictionary=i}(),function(){function t(t,e){for(var n=t._valueCounts,r=t._adoptItemChanges,a=[],s=0,o=e.length;o>s;s++){var l=e[s];n.has(l)?n.set(l,n.get(l)+1):(n.set(l,1),r&&l instanceof i&&l.on("change",t._onItemChange,t),a.push(l))}return a}function e(t,e){var n=t._valueCounts.get(e)-1;return n?(t._valueCounts.set(e,n),[]):(t._valueCounts["delete"](e),t._adoptItemChanges&&e instanceof i&&e.off("change",t._onItemChange),[e])}var i=r.EventEmitter,a=Array.prototype,s=a.push,o=a.unshift,l=a.concat,u=a.slice,c=a.splice,h=a.map,f=i.extend("Rift.ActiveArray",{_data:null,_valueCounts:null,_adoptItemChanges:!1,constructor:function(t,e){i.call(this);var n,r=new Map,a="boolean"==typeof e?e:!!e&&e.adoptItemChanges;if(t){n=(t instanceof f?t._data:t).slice(0);for(var s=n.length;s;)if(--s in n){var o=n[s];r.has(o)?r.set(o,r.get(o)+1):(r.set(o,1),a&&o instanceof i&&o.on("change",this._onItemChange,this))}}else n=[];this._data=n,this._valueCounts=r,a&&(this._adoptItemChanges=a)},_onItemChange:function(t){this._handleEvent(t)},get:function(t){return this._data[t]},set:function(t,e){var r=this._data,a=t in r,s=r[t];if(!a||!n(s,e)){var o,l,u=this._valueCounts;if(a){var c=u.get(s)-1;c?u.set(s,c):(u["delete"](s),this._adoptItemChanges&&s instanceof i&&s.off("change",this._onItemChange),o=[s])}u.has(e)?u.set(e,u.get(e)+1):(u.set(e,1),this._adoptItemChanges&&e instanceof i&&e.on("change",this._onItemChange,this),l=[e]),r[t]=e,this.emit("change",{diff:{$removedValues:o||[],$addedValues:l||[]}})}return this},"delete":function(){for(var t=this._data,e=this._valueCounts,n=this._adoptItemChanges,r=!1,a=[],s=0,o=arguments.length;o>s;s++){var l=arguments[s];if(l in t){r=!0;var u=t[l],c=e.get(u)-1;c?e.set(u,c):(e["delete"](u),n&&u instanceof i&&u.off("change",this._onItemChange),a.push(u)),delete t[l]}}return r&&this.emit("change",{diff:{$removedValues:a,$addedValues:[]}}),this},get length(){return this._data.length},set length(t){var e=this._data,n=e.length;if(n!=t){var r=!1,a=[];if(n>t){var s=this._valueCounts,o=this._adoptItemChanges,l=t;do if(l in e){r=!0;var u=e[l],c=s.get(u)-1;c?s.set(u,c):(s["delete"](u),o&&u instanceof i&&u.off("change",this._onItemChange),a.push(u))}while(++l<n)}e.length=t,r&&this.emit("change",{diff:{$removedValues:a,$addedValues:[]}})}},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._data.indexOf(t,e)},lastIndexOf:function(t,e){return this._data.lastIndexOf(t,e)},push:function(){return arguments.length?(s.apply(this._data,arguments),this.emit("change",{diff:{$removedValues:[],$addedValues:t(this,arguments)}}),this._data.length):this._data.length},shift:function(){var t=this._data;if(t.length){if(!this._valueCounts.size)return void t.length--;var n,i="0"in t;return i?n=t.shift():t.shift(),this.emit("change",{diff:{$removedValues:i?e(this,n):[],$addedValues:[]}}),n}},unshift:function(){return arguments.length?(o.apply(this._data,arguments),this.emit("change",{diff:{$removedValues:[],$addedValues:t(this,arguments)}}),this._data.length):this._data.length},pop:function(){var t=this._data;if(t.length){if(!(t.length-1 in t))return void t.length--;var n=t.pop();return this.emit("change",{diff:{$removedValues:e(this,n),$addedValues:[]}}),n}},join:function(t){return this._data.join(t)},concat:function(){return new this.constructor(l.apply(this._data,h.call(arguments,function(t){return t instanceof f?t._data:t})))},slice:function(t,e){return this._data.slice(t,e)},splice:function(t,e){var r=this._data,a=c.apply(r,arguments),s=u.call(arguments,2),o=a.length,l=s.length;if(!o&&!l)return a;for(var h=this._valueCounts,f=this._adoptItemChanges,p=!1,d=new Set,v=[],g=0,_=Math.max(o,l);_>g;g++){var m=g in a,b=g in s;if(m||b){var y=a[g],w=s[g];if(!m||!b||!n(y,w)){if(p=!0,m){var C=h.get(y)-1;C?h.set(y,C):(h["delete"](y),f&&y instanceof i&&y.off("change",this._onItemChange),d.add(y))}b&&(h.has(w)?h.set(w,h.get(w)+1):(h.set(w,1),f&&w instanceof i&&w.on("change",this._onItemChange,this),d["delete"](w)||v.push(w)))}}}if(!p&&o>l)for(var g=t+l,_=r.length;_>g;g++)if(g in r){p=!0;break}if(p){var x=[];d.forEach(function(t){x.push(t)}),this.emit("change",{diff:{$removedValues:x,$addedValues:v}})}return a},forEach:null,map:null,filter:null,every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptItemChanges:this._adoptItemChanges})},toArray:function(){return this._data.slice(0)},toString:function(){return this._data.toString()},collectDumpObject:function(t,e){this._data.forEach(function(e,n){t[n]=e}),this._adoptItemChanges&&(e.adoptItemChanges=!0)},expandFromDumpObject:function(t){for(var e in t)this.set(e,t[e])},dispose:function(){if(this._adoptItemChanges){var t=this._onItemChange;this._valueCounts.forEach(function(e){e instanceof i&&e.off("change",t)})}}});["forEach","map","filter","every","some","reduce","reduceRight"].forEach(function(t){this[t]=function(){return a[t].apply(this._data,arguments)}},f.prototype),r.ActiveArray=f}(),function(){function e(t){var e=m.last,n=t._maxParentDepth;if(e)for(;;){if(n==e.maxParentDepth)return e.dataCells.has(t)?!1:(e.dataCells.add(t),e.count++,!0);if(n>e.maxParentDepth){var i=e.next;return e.next=(i||m)[i?"prev":"last"]=m[n]={maxParentDepth:n,dataCells:new Set([t]),count:1,prev:e,next:i},!0}if(!e.prev)return e.prev=m.first=m[n]={maxParentDepth:n,dataCells:new Set([t]),count:1,prev:null,next:e},!0;e=e.prev}return m.first=m.last=m[n]={maxParentDepth:n,dataCells:new Set([t]),count:1,prev:null,next:null},!0}function a(t){var e=m[t._maxParentDepth];if(e&&e.dataCells.has(t)){if(--e.count)delete e.dataCells["delete"](t);else{var n=e.prev,i=e.next;n?n.next=i:m.first=i,i?i.prev=n:m.last=n,delete m[t._maxParentDepth]}return!0}return!1}function s(){v=p;do for(var t,n=g.values();!(t=n.next()).done;){for(var i,r=t.value,a=r.dataCell,s=a._children.values();!(i=s.next()).done;)e(i.value);if(g["delete"](a),_--,a._fixedValue=a._value,a._changed=!0,a._handleEvent(r.event),v!=p)return}while(_)}function o(){if(v==f){if(!_)return;if(s(),v!=p)return}else if(v==p){if(_&&(s(),v!=p))return}else if(s(),v!=p)return;v=d;for(var t;t=m.first;)for(var e,n=t.dataCells,i=n.values();!(e=i.next()).done;){var r=e.value;if(r._recalc(),v!=d)return;if(--t.count)delete n["delete"](r);else{var a=t.prev,o=t.next;a?a.next=o:m.first=o,o?o.prev=a:m.last=a,delete m[r._maxParentDepth]}if(_){if(s(),v!=p)return;v=d;break}}v=f,b.clear()}function l(t,e,n,i){if(n||(n=new c("change"),n.target=t,n.timestamp=Date.now(),e&&(n.detail={diff:e})),_){if(g.has(t)){var r=g.get(t);return(n.detail||(n.detail={})).prevEvent=r.event,r.event=n,void(i===!1&&(r.cancellable=!1))}}else v==f&&u(o);g.set(t,{dataCell:t,event:n,cancellable:i!==!1}),_++}var u=r.process.nextTick,c=r.Event,h=r.EventEmitter,f=0,p=1,d=2,v=f,g=new Map,_=0,m=Object.assign(Object.create(null),{first:null,last:null}),b=new Map,y=[],w=h.extend({initialValue:t,_value:t,_fixedValue:t,_formula:null,_get:null,_set:null,owner:null,_parents:null,_children:null,_maxParentDepth:0,_lastErrorEvent:null,computable:!1,_changed:!1,get changed(){return _&&o(),this._changed},disposed:!1,_onChange:null,get onchange(){return this._onChange},set onchange(t){_&&o(),this._onChange=t},_onError:null,get onerror(){return this._onError},set onerror(t){_&&o(),this._onError=t},constructor:function(e,n){if(h.call(this),n||(n={}),n.get&&(this._get=n.get),n.set&&(this._set=n.set),n.owner&&(this.owner=n.owner),n.onchange&&(this._onChange=this.owner?n.onchange.bind(this.owner):n.onchange),n.onerror&&(this._onError=this.owner?n.onerror.bind(this.owner):n.onerror),this._children=new Set,"function"==typeof e&&(n.computable!==t?n.computable:e.constructor==Function)&&(this.computable=!0),this.computable){this._formula=e,y.unshift(new Set);try{this._value=this._fixedValue=this._formula.call(this.owner||this)}catch(i){this._handleError(i)}this._parents=y.shift();for(var r,a=1,s=this._parents.values();!(r=s.next()).done;){var o=r.value;o._children.add(this),a<=o._maxParentDepth&&(a=o._maxParentDepth+1)}this._maxParentDepth=a}else this.initialValue=this._value=this._fixedValue=e,e instanceof h&&e.on("change",this._onValueChange,this)},get value(){return y.length&&y[0].add(this),(_||v==p)&&o(),this._get?this.computable?this._get.call(this.owner||this,this._value):this._get(this._value):this._value},set value(e){if(this.computable){if(!this._set)throw new TypeError("Cannot write to read-only dataÐ¡ell");this._set.call(this.owner||this,e)}else{var r=this._value;if(this._set){var a={};r instanceof h&&r.off("change",this._onValueChange,this),this._set(e,a),e=this._value,e instanceof h&&e.on("change",this._onValueChange,this),n(r,e)?i(a)||l(this,{value:a},t,e!==this._fixedValue):(a.type="update",a.oldValue=r,a.value=e,l(this,{value:a}))}else if(!n(r,e)){if(this._value=e,n(e,this._fixedValue)&&g.get(this).cancellable)return g["delete"](this),void _--;r instanceof h&&r.off("change",this._onValueChange,this),e instanceof h&&e.on("change",this._onValueChange,this),l(this,{value:{type:"update",oldValue:r,value:e}})}}},_onValueChange:function(e){l(this,t,e,this._value!==this._fixedValue)},_recalc:function(){if(b.has(this)){if(10==b.get(this))return void this._handleError(new RangeError("Circular dependency detected"));b.set(this,b.get(this)+1)}else b.set(this,1);var t,i=this._value,r=this._parents;y.unshift(new Set);try{var a=this._formula.call(this.owner||this)}catch(s){t=s}if(v!=d)return void y.shift();for(var o,u=this._parents=y.shift(),c=1,h=r.values();!(o=h.next()).done;)u.has(o.value)||o.value._children["delete"](this);for(var o,h=u.values();!(o=h.next()).done;){var f=o.value;r.has(f)||f._children.add(this),c<=f._maxParentDepth&&(c=f._maxParentDepth+1)}if(this._maxParentDepth!=c){if(this._maxParentDepth<c)return this._maxParentDepth=c,void e(this);this._maxParentDepth=c}t?this._handleError(t):n(i,a)||(this._value=a,l(this,{value:{type:"update",oldValue:i,value:a}}))},_handleError:function(t){this._logError(t);var e=this.emit("error",{error:t});this._handleErrorEvent(e)},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,t.target!=this&&this._handleEvent(t);for(var e,n=this._children.values();!(e=n.next()).done&&!t.isPropagationStopped;)e.value._handleErrorEvent(t)}},on:function(){_&&o(),w.$super.on.apply(this,arguments)},off:function(){_&&o(),w.$super.off.apply(this,arguments)},dispose:function(){if(!this.disposed){if(g.has(this)&&(g["delete"](this),_--),a(this),this.computable)for(var t,e=this._parents.values();!(t=e.next()).done;)t.value._children["delete"](this);else this._value instanceof h&&this._value.off("change",this._onValueChange,this);for(var t,e=this._children.values();!(t=e.next()).done;)t.value.dispose();this.disposed=!0}}});r.DataCell=w}(),function(){function t(t){return Object.keys(t).forEach(function(e){var n=Object.getOwnPropertyDescriptor(t,e),r=n.value;"function"==typeof r&&r.constructor==i&&Object.defineProperty(t,e,{configurable:!0,enumerable:n.enumerable,get:function(){return n.value=Object.defineProperty(r.bind(this),"constructor",{configurable:!0,writable:!0,value:i}),Object.defineProperty(this,e,n),this[e]}})}),t}function e(t){if(t._dataCells){for(var e,n=t._dataCells.values();!(e=n.next()).done;)e.value.dispose();t._dataCells=null}return t}function n(t,e,n,r){var o=(this._dataCells||(this._dataCells=new Map)).get(t);if(!o){if(null!==e&&"object"==typeof e)if("function"==typeof e.clone)e=e.clone();else if(Array.isArray(e))e=e.slice(0);else{var l=new e.constructor(e);e=l!=e?l:a(e)}n=Object.create(n),n.owner=this,o=new s(e,n),this._dataCells.set(t,o)}switch(r.length){case 0:return o.value;case 1:o.value=r[0];break;default:var u=r[0];return r[0]=o,i.prototype[u].apply(this,r)}return this}function i(t,e){function r(){return n.call(this,r,t,e,arguments)}return e||(e={}),Object.defineProperty(r,"constructor",{configurable:!0,writable:!0,value:i}),r}var a=r.object.clone,s=r.DataCell;i.autoBind=t,i.disposeDataCells=e,Object.assign(i.prototype,{dataCell:function(t){return t},subscribe:function(t,e,n){return t.on("change",e,n||this),this},unsubscribe:function(t,e,n){return t.off("change",e,n||this),this}}),r.ActiveProperty=i,r.observable=function(t,e){return"function"==typeof t&&t.constructor==Function&&(e||(e={}),e.computable=!1),new i(t,e)},r.computable=function(t,e){return t.constructor!=Function&&(e||(e={}),e.computable=!0),new i(t,e)}}(),function(){function e(t){return function e(n,i,r,a,s){if(Array.isArray(n)||f&&n instanceof p)for(var o=n.length;o;)e.call(this,n[--o],i,r,a,s);else if("function"==typeof n&&n.constructor==l&&(n=n("dataCell",0)),"object"==typeof i){s=a,a=r;var u=i;for(i in u)e.call(this,n,i,u[i],a,s)}else if(Array.isArray(r))for(var c=r,o=0,h=c.length;h>o;o++)e.call(this,n,i,c[o],a,s);else if("object"==typeof r){var d=r;for(var v in d)e.call(this,n[v]("dataCell",0),i,d[v],a,s)}else t.call(this,n,i,r,a,s);return this}}function n(t){t.target instanceof o?t.target.off(t.type,t.listener,t.context):t.target.removeEventListener(t.type,t.listener,!1)}var i=r.object.getUID,a=r.value.getStamp,o=r.EventEmitter,l=r.ActiveProperty,u=r.ActiveProperty.autoBind,c=r.ActiveProperty.disposeDataCells,h=o.extend({_listening:null,_callbacks:null,_timeouts:null,_dataCells:null,constructor:function(){if(o.call(this),!this.constructor._isActivePropertiesBound){var t=this.constructor;do u(t.prototype),t._isActivePropertiesBound=!0,t=t.$super.constructor;while(t!=h&&!t._isActivePropertiesBound)}},listen:e(function(t,e,n,i,r){this._listen(t,e,n,i,r)}),_listen:function(e,n,r,l,u){l||(l=this);var c=this._listening||(this._listening=new Map),h=i(e)+"-"+n+"-"+i(r.hasOwnProperty(s)?r[s]:r)+"-"+i(l)+"-"+(u!==t?a(u):"");if(!c.has(h)){if(e instanceof o)e.on(n,r,l);else{if("function"!=typeof e.addEventListener)throw new TypeError("Unable to add a listener");e!=l&&(r=r.bind(l)),e.addEventListener(n,r,!1)}c.set(h,{target:e,type:n,listener:r,context:l,meta:u})}},stopListening:e(function(t,e,n,i,r){this._stopListening(t,e,n,i,r)}),_stopListening:function(e,r,o,l,u){var c=this._listening;if(c){l||(l=this);var h=i(e)+"-"+r+"-"+i(o.hasOwnProperty(s)?o[s]:o)+"-"+i(l)+"-"+(u!==t?a(u):"");c.has(h)&&(n(c.get(h)),c["delete"](h))}},stopAllListening:function(){var t=this._listening;if(t){for(var e in t)n(t[e]);this._listening=null}return this},registerCallback:function(t){function e(){e.hasOwnProperty("canceled")&&e.canceled||(n["delete"](t),t.apply(i,arguments))}var n=this._callbacks||(this._callbacks=new Map);n.has(t)&&(n.get(t).canceled=!0);var i=this;return n.set(t,e),e},unregisterCallback:function(t){var e=this._callbacks;return e&&e.has(t)&&(e.get(t).canceled=!0,e["delete"](t)),this},unregisterAllCallbacks:function(){var t=this._callbacks;return t&&(t.forEach(function(t){t.canceled=!0}),this._callbacks=null),this},setTimeout:function(t,e){var n=this._timeouts||(this._timeouts=new Map);n.has(t)&&clearTimeout(n.get(t));var i=this;return n.set(t,setTimeout(function(){n["delete"](t),t.call(i)},e)),this},clearTimeout:function(t){var e=this._timeouts;return e&&e.has(t)&&(clearTimeout(e.get(t)),e["delete"](t)),this},clearAllTimeouts:function(){var t=this._timeouts;return t&&(t.forEach(function(t,e){clearTimeout(e)}),this._timeouts=null),this},collectDumpObject:function(t){Object.keys(this).forEach(function(e){var n=Object.getOwnPropertyDescriptor(this,e).value;if("function"==typeof n&&n.constructor==l){var i=n("dataCell",0);if(!i.computable){var r=i.value;(r===Object(r)?i.changed:i.initialValue!==r)&&(t[e]=r)}}},this)},expandFromDumpObject:function(t){for(var e in t)this[e](t[e])},dispose:function(){this.stopAllListening().unregisterAllCallbacks().clearAllTimeouts(),c(this)}});r.Disposable=h}(),function(){var t=r.ActiveProperty,e=r.Disposable,n=e.extend({_options:null,constructor:function(t,n){e.call(this),this._options=n||{},t&&this.setData(t)},setData:function(e){for(var n in e)"function"==typeof this[n]&&this[n].constructor==t&&this[n](e[n])},collectDumpObject:function(t,e){n.$super.collectDumpObject.call(this,t),Object.assign(e,this._options)}});r.BaseModel=n}(),function(){function t(t){return t.replace(e,"&amp;").replace(n,"&lt;").replace(i,"&gt;").replace(a,"&quot;")}var e=/&/g,n=/</g,i=/>/g,a=/"/g;r.html={escape:t}}(),function(){function t(t,e){t=i(t),e?(e.parent=this,e.block=null):e={parent:this,block:null};var r=this._childRenderings,a=r.count++,s=r.marks[a]="{{_"+n()+"}}";return new t(e).render(function(t){r.results[a]=t,r.count==++r.readyCount&&r.onallready&&r.onallready()}),s}function e(t,e,n){if(t)if(t instanceof a?t=t.toObject():t instanceof s&&(t=t.toArray()),Array.isArray(t))for(var i=0,r=t.length;r>i;i++)i in t&&e.call(n,t[i],i);else for(var o in t)d.call(t,o)&&e.call(n,t[o],o)}var n=r.uid.next,i=r.Class.getOrError,a=r.ActiveDictionary,s=r.ActiveArray;r.template={defaults:{include:t,each:e}}}(),function(){function t(t,e,n){if(t.hasOwnProperty(l)&&t[l])return t[l];var i=t[l]=[];if(t.hasAttribute("rt-bind")){var r=!n||n.applyValues!==!1;a(c,t.getAttribute("rt-bind"),function(n,a,l,u){var c=new s(Function("return "+u+";").bind(e),{onchange:function(){o[a](t,this.value,l)}});i.push(c),r&&o[a](t,c.value,l)})}return i}function e(t){if(t.hasOwnProperty(l)){var e=t[l];if(e){for(var n=e.length;n;)e[--n].dispose();t[l]=null}}}function n(e,n,i){i||(i={});var r=i.removeAttr===!0,a={applyValues:i.applyValues!==!1},s=[];i.bindRootElement!==!1&&e.hasAttribute("rt-bind")&&(s.push.apply(s,t(e,n,a)),r&&e.removeAttribute("rt-bind"));for(var o=e.querySelectorAll("[rt-bind]"),l=0,u=o.length;u>l;l++)s.push.apply(s,t(o[l],n,a)),r&&e.removeAttribute("rt-bind");return s}var i=r.namespace.create,a=r.regex.forEach,s=r.DataCell,o={html:function(t,e){t.innerHTML=e},text:function(t,e,n){switch(n){case"first":var i=t.firstChild;i&&3==i.nodeType?i.nodeValue=e:t.insertBefore(document.createTextNode(e),i);break;case"last":var i=t.lastChild;i&&3==i.nodeType?i.nodeValue=e:t.appendChild(document.createTextNode(e));break;case"prev":var i=t.previousSibling;i&&3==i.nodeType?i.nodeValue=e:t.parentNode.insertBefore(document.createTextNode(e),t);break;case"next":var i=t.nextSibling;i&&3==i.nodeType?i.nodeValue=e:t.parentNode.insertBefore(document.createTextNode(e),i);break;default:if(1==t.childNodes.length&&3==t.firstChild.nodeType)t.firstChild.nodeValue=e;else{for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(document.createTextNode(e))}}},prop:function(t,e,n){n=n.split(".");var r=n.pop();i(n,t)[r]=e},attr:function(t,e,n){e=String(e),t.getAttribute(n)!==e&&t.setAttribute(n,e)},value:function(t,e){e=String(e),t.value!=e&&(t.value=e)},checked:function(t,e){e=!!e,t.checked!=e&&(t.checked=e)},css:function(t,e,n){e=String(e),n||(n="cssText"),t.style[n]!=e&&(t.style[n]=e)},show:function(t,e){t.style.display=e?"":"none"}},u="[$_a-zA-Z][$\\w]*",c=RegExp("("+u+")(?:\\(([^)]*)\\))?:\\s*(\\S[\\s\\S]*?)(?=\\s*(?:,\\s*"+u+"(?:\\([^)]*\\))?:\\s*\\S|$))","g");r.domBinding={helpers:o,bindElement:t,unbindElement:e,bind:n}}(),function(){function e(){}function n(t,n){if(t._receiveData!=e){if(t._beforeDataReceiving!=e)try{t._beforeDataReceiving()}catch(i){t._logError(i)}try{t._receiveData.length?t._receiveData(function(e){null!=e&&(t.dataReceivingError=e,t._logError(e)),a(t),n.call(t)}):t._receiveData()["catch"](function(e){t.dataReceivingError=e,t._logError(e)}).then(function(){a(t),n.call(t)})}catch(i){t.dataReceivingError=i,t._logError(i),a(t),n.call(t)}}else n.call(t)}function a(t){if(t._afterDataReceiving!=e)try{t._afterDataReceiving()}catch(n){t._logError(n)}}function o(t,e){for(var n in e){
var i=e[n];null!=i&&i!==!1&&t.push("__"+n+(i===!0?"":"_"+i))}return t}function l(t,e){for(var n in e)t.setAttribute(n,e[n])}function g(t,e,n){for(var i=t.children,r=!1,a=i.length;a;){var s=i[--a];s.blockName==e?(s.$(n),r=!0):g(s,e,n)&&(r=!0)}return r}function _(e,n){if(n.hasOwnProperty(c)&&n[c]&&n[u]==e){var i=e.elements[n[c]];i.splice(i.indexOf(n),1),n[u]=null,n[c]=t,n.parentNode&&n.parentNode.removeChild(n)}}var m=r.object.getUID,b=r.namespace.exec,y=r.value.getStamp,w=r.value.stringify,C=r.Class.classes,x=r.Class.getOrError,O=r.Disposable,j=r.html.escape,E=r.domBinding.bind,P=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr","circle","ellipse","line","path","polygone","polyline","rect","stop","use"]),k=/^(.+?):(.+)$/,S=/([^,]*),([^,]*),(.*)/,D=O.extend({_params:null,_id:t,app:null,model:null,name:t,tagName:"div",blockName:t,mods:null,attrs:null,_parent:null,get parent(){return this._parent},set parent(t){t?t.registerChild(this):this._parent&&this._parent.unregisterChild(this)},children:null,block:null,elements:null,dataReceivingError:null,_currentlyRendering:!1,_childRenderings:null,template:function(){return""},onlyClient:!1,isClientInited:!1,constructor:function(e){if(O.call(this),e||(e={}),this._params=e,this.mods=Object.create(this.mods),this.attrs=Object.create(this.attrs),this.children=[],this.elements={},!this.blockName){for(var i=this.constructor;i.$super.constructor!=D;)i=i.$super.constructor;i.prototype.blockName=i.__class}var r;if(h){if(e.block)throw new TypeError('Parameter "block" can\'t be used on the server side');r=null,null===e.block&&delete e.block}else e.block!==t&&(r=e.block,delete e.block);if(null===r)this._id=m(this,h?"s":"c"),this._parseParams();else{var a,s=!1;if(r){if(r instanceof p&&(r=r[0]),r.hasOwnProperty(u)&&r[u])throw new TypeError("Element is already used as "+(r.hasOwnProperty(c)&&r[c]?"an element":"a block")+" of view");r.hasAttribute("rt-d")&&(a=r.getAttribute("rt-d").match(S),a[2]&&(s=!0),a[3]&&Object.assign(e,Function("return {"+a[3]+"};")()))}if(this._id=s?a[2]:m(this,"c"),this._parseParams(),r||(r=document.createElement(this.tagName)),this.block=p(r),r[u]=this,s){var f=this;this.block.find("[rt-p="+this._id+"]").each(function(){new(C[this.getAttribute("rt-d").match(S)[1]])({parent:f,block:this})})}else l(r,this.attrs),r.className=(o([this.blockName],this.mods).join(" ")+" "+r.className).trim(),this._currentlyRendering=!0,n(this,function(){this._renderInner(function(t){this._currentlyRendering=!0,r.innerHTML=t;for(var e=r.querySelectorAll("[rt-p]"),n={},i=e.length;i;)n[e[--i].getAttribute("rt-d").match(S)[2]]=e[i];!function a(t){for(var e=t.children,i=e.length;i;){var r=e[--i],s=n[r._id];r.block=p(s),s[u]=r,a(r)}}(this)})})}},_parseParams:function(){var e=this._params;e.name&&(this.name=e.name),e.tagName&&(this.tagName=e.tagName,delete e.tagName),e.blockName&&(this.blockName=e.blockName),e.mods&&(Object.assign(this.mods,e.mods),delete e.mods),e.attrs&&(Object.assign(this.attrs,e.attrs),delete e.attrs),e.parent&&(this.parent=e.parent,delete e.parent),e.app&&(this.app=e.app,delete e.app,this.model=this.app.model);var n=e.model;if(n)"string"==typeof n?this.model=b(n,this._parent||this):(this.model=n,delete e.model);else{var i=this._parent;i&&i.model&&(this.model=i.model)}e.onlyClient!==t&&(this.onlyClient=e.onlyClient)},render:function(t){if(this._currentlyRendering)throw new TypeError("Cannot run the rendering when it is in process");return h&&this.onlyClient?void t(this._renderOpenTag(!0)+(P.has(this.tagName)?"":"</"+this.tagName+">")):(this._currentlyRendering=!0,void n(this,function(){P.has(this.tagName)?(this._currentlyRendering=!1,t(this._renderOpenTag(!1))):this._renderInner(function(e){this._currentlyRendering=!1,t(this._renderOpenTag(!1)+e+"</"+this.tagName+">")})}))},_renderOpenTag:function(t){var e;if(t)e="";else{var n=this.attrs;e=['class="'+(o([this.blockName],this.mods).join(" ")+" "+(n["class"]||"")).trim()+'"'];for(var r in n)"class"!=r&&e.push(r+'="'+n[r]+'"')}return"<"+this.tagName+" "+e.join(" ")+' rt-d="'+[this.constructor.__class,t?"":this._id,i(this._params)?"":j(w(this._params).slice(1,-1))]+'"'+(this._parent?' rt-p="'+this._parent._id+'"':"")+">"},_renderInner:function(t){var e,n=this._childRenderings={count:0,readyCount:0,marks:[],results:[],onallready:null};try{e=this.template.call(this)}catch(i){return this._childRenderings=null,this._logError(i),void t.call(this,"")}var r=this;n.onallready=function(){r._childRenderings=null;for(var i=n.marks,a=n.results,s=i.length;s;)e=e.replace(i[--s],function(){return a[s]});t.call(r,e)},n.count==n.readyCount&&n.onallready()},_receiveData:e,_beforeDataReceiving:e,_afterDataReceiving:e,initClient:function(){if(this.isClientInited)throw new TypeError("Client is already initialized");this.isClientInited=!0;for(var t=this.children.slice(0),n=0,i=t.length;i>n;n++)t[n].initClient();try{for(var r=this._dataCells||(this._dataCells=new Map),a=E(this.block[0],this,{applyValues:!1,removeAttr:!0}),n=a.length;n;)r.set(a[--n],a[n]);this._initClient!=e&&this._initClient(),this._bindEvents!=e&&this._bindEvents()}catch(s){this._logError(s)}},_initClient:e,_bindEvents:e,registerChild:function(t){if(t._parent){if(t._parent==this)return this;throw new TypeError("View is already used as a child of view")}t._parent=this;var e=this.children,n=t.name;return e.push(t),n&&(d.call(e,n)?e[n]:e[n]=[]).push(t),this},unregisterChild:function(t){if(t._parent!==this)return this;t._parent=null;var e=this.children,n=t.name;if(e.splice(e.indexOf(t),1),n){var i=e[n];i.splice(i.indexOf(t),1)}return this},$:function(t){var e;d.call(this.elements,t)?e=this.elements[t]:(e=p("."+this.blockName+"_"+t,this.block),g(this,this.blockName,t)&&(e=e.filter(function(){return!this.hasOwnProperty(u)||!this[u]})),this.elements[t]=e);var n=arguments.length;if(n>1){var i=1;do{var r=arguments[i],a="string"==typeof r;if(a||r instanceof HTMLElement){if(a){var s=document.createElement("div");s.innerHTML=r,r=1==s.childNodes.length&&1==s.firstChild.nodeType?s.firstChild:s}else if(r.hasOwnProperty(u)&&r[u]){if(!r.hasOwnProperty(c)||!r[c])throw new TypeError("Element is already used as a block of view");if(r[u]!=this||r[c]!=t)throw new TypeError("Element is already used as an element of view");continue}r.className=(this.blockName+"_"+t+" "+r.className).trim()}else{var h=r;r=document.createElement(h.tagName||"div"),h.attrs&&l(r,h.attrs);var f=[this.blockName+"_"+t];h.mods&&o(f,h.mods),r.className=(f.join(" ")+" "+r.className).trim(),h.html&&(r.innerHTML=h.html)}r[u]=this,r[c]=t,e.push(r)}while(++i<n)}return e},$rm:function(){for(var t=arguments.length;t;){var e=arguments[--t];if("string"==typeof e){if(!d.call(this.elements,e))continue;e=this.elements[e]}if(e instanceof p){var n=this;e.each(function(){_(n,this)})}else _(this,e)}return this},broadcast:function(t,e){var n,i;if(k.test(t)?(n=RegExp.$1,i=RegExp.$2):(n=t,i="*"),"*"==n)t=this.children;else{if(!d.call(this.children,n))return[];t=this.children[n]}"*"==i?t=t.slice(0):(i=x(i),t=t.filter(function(t){return t instanceof i}));var r=v.call(arguments,2);return t.map(function(t){return t[e].apply(t,r)})},_listen:function(t,e,n,i,r){var a,o;if(t instanceof D)if(k.test(e)){if(a=RegExp.$1,o=RegExp.$2,"*"!=o){o=x(o);var l=n,u=function(t){return t.target instanceof o?l.call(this,t):void 0};u[s]=l,n=u}}else{a=e;var c=this,l=n,u=function(t){return t.target==c?l.call(this,t):void 0};u[s]=l,n=u}else a=e;D.$super._listen.call(this,t,a,n,i,(o?"*"===o?"":m(o):"0")+y(r))},_stopListening:function(t,e,n,i,r){var a,s;t instanceof D&&k.test(e)?(a=RegExp.$1,s=RegExp.$2,"*"!=s&&(s=x(s))):a=e,D.$super._stopListening.call(this,t,a,n,i,(s?"*"===s?"":m(s):"0")+y(r))},dispose:function(){var t;f&&(t=this.block[0],t.parentNode&&t.parentNode.removeChild(t));for(var e=this.children,n=e.length;n;)e[--n].dispose();if(this._parent){var i=this._parent.children;if(i.splice(i.indexOf(this),1),this.name){var r=i[this.name];r.splice(r.indexOf(this),1)}}f&&(t[u]=null),D.$super.dispose.call(this)}});r.BaseView=D}(),function(){var t=r.dump.serialize,e=r.dump.deserialize,n=r.ActiveProperty,i=r.Disposable,a=i.extend("Rift.ViewState",{properties:null,constructor:function(t){i.call(this),this.properties=Object.keys(t);for(var e in t){var r=("function"==typeof t[e]?t[e]:new n(t[e])).bind(this);Object.defineProperty(r,"constructor",{configurable:!0,writable:!0,value:n}),this[e]=r}},serializeData:function(){for(var e=this.properties,n={},i=e.length;i;){var r=this[e[--i]]("dataCell",0);if(!r.computable){var a=r.value;(a===Object(a)?r.changed:r.initialValue!==a)&&(n[e[i]]=t({v:a}))}}return n},updateFromSerializedData:function(t){var n={};for(var i in t)n[i]=e(t[i]).v;return this.update(n),this},update:function(t){for(var e=this.properties,n=e.length;n;){var i=e[--n];this[i](d.call(t,i)?t[i]:this[i]("dataCell",0).initialValue)}return this}});r.ViewState=a}(),function(){function e(t){if(""!=t){if("NaN"==t)return 0/0;var e=Number(t);if(e==e)return e}return t}function n(t){t=t.split("/");for(var e=t.length;e;)t[--e]=encodeURIComponent(decodeURIComponent(t[e]));return t.join("/")}function i(t){return"/"!=t[0]&&(t="/"+t),"/"!=t[t.length-1]&&(t+="/"),t}function a(t,n){for(var i=t.routes,r=0,a=i.length;a>r;r++){var s=i[r],o=n.match(s.rePath);if(o)return{route:s,state:s.properties.reduce(function(t,n,i){return t[n.name]=1==n.type?!!o[i+1]:e(decodeURIComponent(o[i+1])),t},{})}}return null}function s(t,e){for(var n=t.app.viewState,i=t.routes,r=null,a=0,s=i.length;s>a;a++){for(var l=i[a],u=l.requiredProperties,c=u.length;c--;){var h=n[u[c]]();if(null==h||h===!1||""===h)break}if(-1==c){if(u.length){r=l;break}r&&l!==e||(r=l)}}return r&&{route:r,path:o(t,r)}}function o(e,n){for(var r=e.app.viewState,a=n.pathMap,s=[],o=0,l=a.length;l>o;o++){for(var u=a[o],c=u.requiredProperties,h=c.length;h--;){var f=r[c[h]]();if(null==f||f===!1||""===f)break}-1==h&&s.push(u.pathPart!==t?u.pathPart:r[u.prop]())}return i(s.join(""))}function l(t,e,n,i,r){if(t.currentRoute=e,t.currentPath=n,f)if(r)history[1==r?"replaceState":"pushState"]({"_rt-state":{routeIndex:t.routes.indexOf(e),path:n,viewStateData:i}},null,n);else{var a=history.state||{};a["_rt-state"]={routeIndex:t.routes.indexOf(e),path:n,viewStateData:i},history.replaceState(a,null,n)}e.callback&&e.callback.call(t.app,n)}var u=r.regex.escape,c=r.process.nextTick,p=r.Disposable,d=/^(?:\w+:)?\/\//,v=/[\/\\]+/g,g=/\{([^}]+)\}/g,_=/\((?:\?(\S+)\s+)?([^)]+)\)/g,m=p.extend({app:null,viewBlock:null,routes:null,currentRoute:null,currentPath:t,started:!1,_isViewStateChangeHandlingRequired:!1,constructor:function(t,e){p.call(this),this.app=t,this.routes=[],e&&this.addRoutes(e)},addRoutes:function(t){return t.forEach(function(t){"string"==typeof t&&(t={path:t}),this.addRoute(t.path,t.callback)},this),this},addRoute:function(e,i){if(this.started)throw new TypeError("Router is already started");e=e.split(_);for(var r=[],a=[],s=[],o=[],l=0,c=e.length;c>l;)if(l%3){r.push("(");var h=[];e[l]&&(h.push(e[l]),a.push({type:1,name:e[l]}));for(var f=e[l+1].split(g),p=0,d=f.length;d>p;p++)if(p%2){var v=f[p];h.push(v),r.push("([^\\/]+)"),a.push({type:2,name:v}),o.push({requiredProperties:h,pathPart:t,prop:v})}else if(f[p]){var m=n(f[p]);r.push(u(m).split("\\*").join(".*?")),o.push({requiredProperties:h,pathPart:m.split("*").join(""),prop:t})}r.push(")?"),l+=2}else{if(e[l])for(var f=e[l].split(g),p=0,d=f.length;d>p;p++)if(p%2){var v=f[p];r.push("([^\\/]+)"),a.push({type:0,name:v}),s.push(v),o.push({requiredProperties:[v],pathPart:t,prop:v})}else if(f[p]){var m=n(f[p]);r.push(u(m).split("\\*").join(".*?")),o.push({requiredProperties:[],pathPart:m.split("*").join(""),prop:t})}l++}return this.routes.push({rePath:RegExp("^\\/?"+r.join("")+"\\/?$"),properties:a,requiredProperties:s,pathMap:o,callback:i}),this},start:function(){if(this.started)return this;if(this.started=!0,f&&(this.viewBlock=this.app.view.block[0]),this._bindEvents(),h){var t=s(this,"/"==this.currentPath?null:this.currentRoute);t&&l(this,t.route,t.path,this.app.viewState.serializeData())}return this},_bindEvents:function(){f&&this.listen(window,"popstate",this._onWindowPopState).listen(this.viewBlock,"click",this._onViewBlockClick);for(var t=this.app.viewState,e=this._onViewStatePropertyChange,n=t.properties,i=n.length;i;)this.listen(t[n[--i]],"change",e)},_onWindowPopState:function(){var e=history.state&&history.state["_rt-state"];if(e){var n=this.currentRoute=this.routes[e.routeIndex],i=this.currentPath=e.path;this.app.viewState.updateFromSerializedData(e.viewStateData),n.callback&&n.callback.call(this.app,i)}else{this.app.viewState.update({});var r=s(this);r?l(this,r.route,r.path,{},1):(this.currentRoute=null,this.currentPath=t)}},_onViewBlockClick:function(t){for(var e=this.viewBlock,n=t.target;"A"!=n.tagName;){if(n==e)return;n=n.parentNode}var i=n.getAttribute("href");!d.test(i)&&this.route(i,!0)&&t.preventDefault()},_onViewStatePropertyChange:function(){this._isViewStateChangeHandlingRequired||(this._isViewStateChangeHandlingRequired=!0,c(this.registerCallback(this._onViewStateChange)))},_onViewStateChange:function(){if(this._isViewStateChangeHandlingRequired){this._isViewStateChangeHandlingRequired=!1;var t=s(this,this.currentRoute);if(t){var e=t.path;if(e===this.currentPath){if(f){var n=history.state||{};n["_rt-state"]||(n["_rt-state"]={routeIndex:this.routes.indexOf(this.currentRoute),path:e}),n["_rt-state"].viewStateData=this.app.viewState.serializeData(),history.replaceState(n,null,e)}}else l(this,t.route,e,this.app.viewState.serializeData(),2)}}},route:function(t,e){if(t=n(t.replace(v,"/")),"/"!=t[0]){var i=location.pathname;t=i+("/"==i[i.length-1]?"":"/")+t}if("/"!=t[t.length-1]&&(t+="/"),t===this.currentPath)return!0;var r=a(this,t);return r?(this.app.viewState.update(r.state),l(this,r.route,t,this.app.viewState.serializeData(),e?2:1),!0):!1}});r.Router=m}(),function(){function e(e,n){for(var i=Object.assign({},e),r=n.length;r;)for(var a=n[--r].properties,s=a.length;s;){var o=a[--s].name;d.call(i,o)||(i[o]=t)}return i}var n=r.dump.deserialize,i=r.ViewState,a=r.Router,s=r.Class.extend({model:null,view:null,viewState:null,router:null,_init:function(t,r,s,o,l,u,c){this.model="function"==typeof t?new t:n(t);var h=this.router=new a(this,u);this.viewState=new i(e(o,h.routes)),h.route(c),f&&this.viewState.updateFromSerializedData(l);var p=this.view=new r({app:this,block:s});h.start(),f&&p.initClient()},dispose:function(){this.router.dispose(),this.view.dispose(),this.viewState.dispose(),this.model.dispose()}});r.BaseApp=s}()}();