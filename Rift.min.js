!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("superagent")):"function"==typeof define&&define.amd?define(["superagent"],e):"object"==typeof exports?exports.Rift=e(require("superagent")):t.Rift=e(t.superagent)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var n=i(1);e.nextTick=n.nextTick,e.EventEmitter=n.EventEmitter,e.ActiveMap=n.ActiveMap,e.map=n.map,e.ActiveList=n.ActiveList,e.list=n.list,e.Cell=n.Cell,e.cellx=e.cell=n,e.env=i(2),e.uid=i(3),e.object=i(4),e.regex=i(5);var r=i(6);e.registerClass=r.register,e.Class=r,e.dump=i(7),e.bindCells=i(8),e.Disposable=i(9),e.proxy=i(10),e.BaseModel=i(12),e.domBinding=i(13);var s=i(14);e.viewClasses=s.viewClasses,e.registerViewClass=s.registerViewClass,e.BaseView=s,e.templateRuntime=i(15),i(16),i(17),e.ViewState=i(18),e.Router=i(19),e.BaseApp=i(20)},function(t,e,i){!function(e){"use strict";function i(t,e){function n(t){return s(n,r,e,this,t,h.call(arguments,1),arguments.length)}e||(e={});var r=t;return n.constructor=i,n}function n(t){return-1!=t.toString().indexOf("[native code]")}function r(t,e){function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t}var s,a=Object.prototype.hasOwnProperty,o=Object.prototype.toString,l=Array.prototype.push,h=Array.prototype.slice,c=Array.prototype.splice,u=Function("return this;")();t.exports=i;var f="__cellx_uid__",p="__cellx_inner__",d="__cellx_cells__";u.Symbol&&"symbol"==typeof Symbol.iterator&&(f=Symbol(f),p=Symbol(p),d=Symbol(d)),i.KEY_UID=f,i.KEY_INNER=p,i.KEY_CELLS=d;var v,_=0;v=u.console?console.error?function(t){console.error(t===Object(t)&&t.stack||t)}:function(t){console.log("!!! "+(t===Object(t)&&t.stack||t))}:function(){},i.logError=v;var g=Object.create||function(t){function e(){}return e.prototype=t,new e},m=Object.assign||function(t,e){for(var i in e)a.call(e,i)&&(t[i]=e[i]);return t},y=Object.is||function(t,e){return t===e||t!=t&&e!=e},b=Array.isArray||function(t){return"[object Array]"==o.call(t)};!function(){var t,e=Object.create;t=e&&n(e)?function(){return e(null)}:function(){var e=document.createElement("iframe"),i=document.body||document.documentElement;e.style.display="none",i.appendChild(e),e.src="javascript:";var n=e.contentWindow.Object.prototype;return i.removeChild(e),e=null,delete n.constructor,delete n.isPrototypeOf,delete n.hasOwnProperty,delete n.propertyIsEnumerable,delete n.valueOf,delete n.toString,delete n.toLocaleString,t=function(){},t.prototype=n,new t},i.Dictionary=t}(),function(){var t=u.Map;if(!t){var r=i.Dictionary,s={value:e};t=function(t){if(this._entries=new r,this._objectStamps={},this._first=null,this._last=null,this.size=0,t)for(var e=0,i=t.length;i>e;e++)this.set(t[e][0],t[e][1])},m(t.prototype,{has:function(t){return!!this._entries[this._getValueStamp(t)]},get:function(t){return(this._entries[this._getValueStamp(t)]||s).value},set:function(t,e){var i=this._entries,n=this._getValueStamp(t);if(i[n])i[n].value=e;else{var r=i[n]={key:t,keyStamp:n,value:e,prev:this._last,next:null};this.size++?this._last.next=r:this._first=r,this._last=r}return this},"delete":function(t){var e=this._getValueStamp(t),i=this._entries[e];if(!i)return!1;if(--this.size){var n=i.prev,r=i.next;n?n.next=r:this._first=r,r?r.prev=n:this._last=n}else this._first=null,this._last=null;return delete this._entries[e],delete this._objectStamps[e],!0},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return this._getObjectStamp(t)},_getObjectStamp:function(){function t(t){var e,i=this._objectStamps;for(e in i)if(i[e]==t)return e;return e=String(++_),i[e]=t,e}return Object.defineProperty&&n(Object.defineProperty)&&Object.isExtensible&&n(Object.isExtensible)?function(e){if(!a.call(e,f)){if(!Object.isExtensible(e))return t.call(this,e);Object.defineProperty(e,f,{value:String(++_)})}return e[f]}:t}(),forEach:function(t,e){null==e&&(e=u);for(var i=this._first;i;){t.call(e,i.value,i.key,this);do i=i.next;while(i&&!this._entries[i.keyStamp])}},toString:function(){return"[object Map]"}});for(var o=[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]],l=0,h=o.length;h>l;l++)t.prototype[o[l][0]]=function(t){return function(){var i,n=this._entries,r=!1,s=this;return{next:function(){if(!r){if(i){do i=i.next;while(i&&!n[i.keyStamp])}else i=s._first;if(i)return{value:t(i),done:!1};r=!0}return{value:e,done:!0}}}}}(o[l][1])}i.Map=t}(),function(){var t;if(u.process&&"[object process]"==process.toString()&&process.nextTick)t=process.nextTick;else if(u.setImmediate)t=function(t){setImmediate(t)};else if(u.Promise&&n(Promise)){var e=Promise.resolve();t=function(t){e.then(function(){t()})}}else if(u.postMessage&&!u.ActiveXObject){var r;u.addEventListener("message",function(){if(r){var t=r;r=null;for(var e=0,n=t.length;n>e;e++)try{t[e]()}catch(s){i.logError(s)}}},!1),t=function(t){r?r.push(t):(r=[t],u.postMessage("__tic__","*"))}}else t=function(t){setTimeout(t,1)};i.nextTick=t}(),function(){function t(){this.parent=null,this._events=new n}var n=i.Dictionary;m(t.prototype,{on:function(t,e,i){if("object"==typeof t){i=e;var n=t;for(t in n)this._on(t,n[t],i)}else this._on(t,e,i);return this},off:function(t,e,i){if(t)if("object"==typeof t){i=e;var r=t;for(t in r)this._off(t,r[t],i)}else this._off(t,e,i);else this._events&&(this._events=new n);return this},_on:function(t,e,i){var r=(this._events||(this._events=new n))[t];r||(r=this._events[t]=[]),r.push({listener:e,context:i||this})},_off:function(t,e,i){var n=this._events&&this._events[t];if(n){i||(i=this);for(var r=n.length;r;)if(n[--r].context==i){var s=n[r].listener;if(s==e||s.hasOwnProperty(p)&&s[p]==e){n.splice(r,1);break}}n.length||delete this._events[t]}},once:function(t,e,i){function n(){return this._off(t,n,i),e.apply(this,arguments)}return n[p]=e,this._on(t,n,i),this},emit:function(t){return"string"==typeof t?t={target:this,type:t}:t.target===e&&(t.target=this),this._handleEvent(t),t},_handleEvent:function(t){var e=this._events&&this._events[t.type];if(e){e=e.slice();for(var i=0,n=e.length;n>i;i++)try{e[i].listener.call(e[i].context,t)===!1&&(t.isPropagationStopped=!0)}catch(r){this._logError(r)}}this.parent&&t.bubbles!==!1&&!t.isPropagationStopped&&this.parent._handleEvent(t)},_logError:function(t){i.logError(t)}}),i.EventEmitter=t}();var w;!function(){var t=i.EventEmitter;w={_onItemChange:function(t){this._handleEvent(t)},_registerValue:function(e){var i=this._valueCounts,n=i.get(e);n?i.set(e,n+1):(i.set(e,1),this.adoptsItemChanges&&e instanceof t&&e.on("change",this._onItemChange,this))},_unregisterValue:function(e){var i=this._valueCounts,n=i.get(e);n>1?i.set(e,n-1):(i["delete"](e),this.adoptsItemChanges&&e instanceof t&&e.off("change",this._onItemChange,this))},dispose:function(){if(this.adoptsItemChanges){var e=this._onItemChange;this._valueCounts.forEach(function(i){i instanceof t&&i.off("change",e,this)},this)}}}}(),function(){function t(e,i){if(this._entries=new s,this._valueCounts=new s,this.size=0,this.adoptsItemChanges=!i||i.adoptsItemChanges!==!1,e){var n=this._entries;if(e instanceof t)e._entries.forEach(function(t,e){n.set(e,t),this._registerValue(t)},this);else if(b(e))for(var r=0,a=e.length;a>r;r++){var o=e[r];n.set(o[0],o[1]),this._registerValue(o[1])}else for(var l in e)n.set(l,e[l]),this._registerValue(e[l]);this.size=n.size}}function n(e,i){return new t(e,"boolean"==typeof i?{adoptsItemChanges:i}:i)}var s=i.Map;r(t,i.EventEmitter),m(t.prototype,w),m(t.prototype,{has:function(t){return this._entries.has(t)},contains:function(t){return this._valueCounts.has(t)},get:function(t){return this._entries.get(t)},set:function(t,e){var i,n=this._entries,r=n.has(t);if(r){if(i=n.get(t),y(i,e))return this;this._unregisterValue(i)}return n.set(t,e),this._registerValue(e),r||this.size++,this.emit({type:"change",subtype:r?"update":"add",key:t,oldValue:i,value:e}),this},"delete":function(t){var i=this._entries;if(!i.has(t))return!1;var n=i.get(t);return i["delete"](t),this._unregisterValue(n),this.size--,this.emit({type:"change",subtype:"delete",key:t,oldValue:n,value:e}),!0},clear:function(){return this.size?(this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit({type:"change",subtype:"clear"}),this):this},forEach:function(t,e){null==e&&(e=u),this._entries.forEach(function(i,n){t.call(e,i,n,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges})}}),i.ActiveMap=t,i.map=n}(),function(){function t(t,e){return e>t?-1:t>e?1:0}function n(t,e){var i=t._items;if(t.sorted)for(var n=t.comparator,r=0,s=e.length;s>r;r++){for(var a=e[r],o=0,h=i.length;o!=h;){var c=o+h>>1;n(a,i[c])<0?h=c:o=c+1}i.splice(o,0,a),t._registerValue(a)}else{l.apply(i,e);for(var u=e.length;u;)t._registerValue(e[--u])}t.length=i.length}function s(e,i){i||(i={}),this._items=[],this._valueCounts=new o,this.length=0,this.adoptsItemChanges=i.adoptsItemChanges!==!1,this.comparator=null,this.sorted=!1,(i.sorted||i.comparator&&i.sorted!==!1)&&(this.comparator=i.comparator||t,this.sorted=!0),e&&n(this,e instanceof s?e._items:e)}function a(t,e){return new s(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var o=i.Map,h=Array.prototype;r(s,i.EventEmitter),m(s.prototype,w),m(s.prototype,{_validateIndex:function(t,i){if(t===e)return t;if(0>t){if(t+=this.length,0>t)throw new RangeError("Index out of range")}else if(t>=this.length+(i?1:0))throw new RangeError("Index out of range");return t},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._items.indexOf(t,this._validateIndex(e))},lastIndexOf:function(t,e){return this._items.lastIndexOf(t,this._validateIndex(e))},get:function(t){return this._items[this._validateIndex(t)]},getRange:function(t,i){t=this._validateIndex(t||0,!0);var n=this._items;if(i===e)return n.slice(t);if(t+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');return n.slice(t,t+i)},set:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=this._items;return y(i[t],e)?this:(this._unregisterValue(i[t]),i[t]=e,this._registerValue(e),this.emit("change"),this)},setRange:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=e.length;if(!i)return this;if(t+i>this.length)throw new RangeError('"index" and length of "items" do not denote a valid range');for(var n=this._items,r=!1,s=t+i;s>t;){var a=e[--s];y(n[s],a)||(this._unregisterValue(n[s]),n[s]=a,this._registerValue(a),r=!0)}return r&&this.emit("change"),this},add:function(t){return this.addRange([t]),this},addRange:function(t){return t.length?(n(this,t),this.emit("change"),this):this},insert:function(t,e){return this.insertRange(t,[e]),this},insertRange:function(t,e){if(this.sorted)throw new TypeError("Can't insert to sorted list");t=this._validateIndex(t,!0);var i=e.length;if(!i)return this;c.apply(this._items,[].concat(t,0,e));for(var n=i;n;)this._registerValue(e[--n]);return this.length+=i,this.emit("change"),this},remove:function(t,e){var i=this._items.indexOf(t,this._validateIndex(e));return-1==i?this:(this._items.splice(i,1),this._unregisterValue(t),this.length--,this.emit("change"),this)},removeAll:function(t,e){for(var i=this._items,n=this._validateIndex(e),r=!1;-1!=(n=i.indexOf(t,n));)i.splice(n,1),this._unregisterValue(t),r=!0;return r&&(this.length=i.length,this.emit("change")),this},removeAt:function(t){return this._unregisterValue(this._items.splice(this._validateIndex(t),1)[0]),this.length--,this.emit("change"),this},removeRange:function(t,i){t=this._validateIndex(t||0,!0);var n=this._items;if(i===e)i=n.length-t;else if(t+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');if(!i)return this;for(var r=t+i;r>t;)this._unregisterValue(n[--r]);return n.splice(t,i),this.length-=i,this.emit("change"),this},clear:function(){return this.length&&(this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit("change")),this},join:function(t){return this._items.join(t)},forEach:null,map:null,filter:null,every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice()},toString:function(){return this._items.join()}});for(var u=["forEach","map","filter","every","some","reduce","reduceRight"],f=u.length;f;)!function(t){s.prototype[t]=function(){return h[t].apply(this._items,arguments)}}(u[--f]);i.ActiveList=s,i.list=a}(),function(){function t(){if(!(c>u)){l=!0;do{var t=h[c];if(t){var e=t.shift();if(c){var i=c;e._recalc(),h[i].length||(h[i]=null,c&&c++)}else{var n=e._changeEvent;e._fixedValue=e._value,e._changeEvent=null,e._changed=!0,e._events.change&&e._handleEvent(n);for(var r=e._slaves,s=r.length;s;){var a=r[--s];a._fixed&&((h[1]||(h[1]=[])).push(a),u||(u=1),a._fixed=!1)}h[0].length||c++}}else c++}while(u>=c);u=-1,d++,l=!1}}function n(t,i){a.call(this),i||(i={}),this.owner=i.owner||null,this.computed="function"==typeof t&&(i.computed!==e?i.computed:t.constructor==Function),this._value=e,this._fixedValue=e,this.initialValue=e,this._formula=null,this._read=i.read||null,this._write=i.write||null,this._validate=i.validate||null,this._masters=null,this._slaves=[],this._level=0,this._active=!this.computed,this._changeEvent=null,this._isChangeCancellable=!0,this._lastErrorEvent=null,this._fixed=!0,this._version=0,this._changed=!1,this._circularityCounter=0,this.computed?this._formula=t:(this._validate&&this._validate.call(this.owner||this,t),this._value=this._fixedValue=this.initialValue=t,t instanceof a&&t.on("change",this._onValueChange,this)),i.onchange&&this.on("change",i.onchange),i.onerror&&this.on("error",i.onerror)}var s=i.nextTick,a=i.EventEmitter,o={original:null},l=!1,h=[[]],c=0,u=-1,f=null,d=1;r(n,a),m(n.prototype,{changed:function(){return l||t(),this._changed},on:function(e,i,n){return l||t(),!this.computed||this._events.change||this._slaves.length||this._activate(),a.prototype.on.call(this,e,i,n),this},off:function(e,i,n){return l||t(),a.prototype.off.call(this,e,i,n),!this.computed||this._events.change||this._slaves.length||this._deactivate(),this},_on:function(t,e,i){a.prototype._on.call(this,t,e,i||this.owner)},_off:function(t,e,i){a.prototype._off.call(this,t,e,i||this.owner)},subscribe:function(t){function e(e){return t.call(this,e.error||null,e)}return e[p]=t,this.on("change",e).on("error",e),this},unsubscribe:function(t){return this.off("change",t).off("error",t),this},_registerSlave:function(t){!this.computed||this._events.change||this._slaves.length||this._activate(),this._slaves.push(t)},_unregisterSlave:function(t){this._slaves.splice(this._slaves.indexOf(t),1),!this.computed||this._events.change||this._slaves.length||this._deactivate()},_activate:function(){if(this._version!=d){this._masters=null,this._level=0;var t=this._tryFormula();t===o?this._handleError(o.original):y(this._value,t)||(this._value=t,this._changed=!0),this._version=d}for(var e=this._masters||[],i=e.length;i;)e[--i]._registerSlave(this);this._active=!0},_deactivate:function(){for(var t=this._masters||[],e=t.length;e;)t[--e]._unregisterSlave(this);this._active=!1},_onValueChange:function(e){this._changeEvent?(e.prev=this._changeEvent,this._changeEvent=e,this._value===this._fixedValue&&(this._isChangeCancellable=!1)):(h[0].push(this),c=0,-1==u&&(u=0),e.prev=null,this._changeEvent=e,this._isChangeCancellable=!1,l||s(t))},read:function(){if(f&&(f._masters?-1==f._masters.indexOf(this)&&(f._masters.push(this),f._level<=this._level&&(f._level=this._level+1)):(f._masters=[this],f._level=this._level+1)),l||t(),this.computed&&!this._active&&this._version!=d){this._masters=null,this._level=0;var e=this._tryFormula();if(e===o)this._handleError(o.original);else{var i=this._value;y(i,e)||(this._value=e,this._changed=!0)}this._version=d}return this._read?this._read.call(this.owner||this,this._value):this._value},write:function(e){if(this.computed&&!this._write)throw new TypeError("Cannot write to read-only cell");var i=this._value;return y(i,e)?!1:(this._validate&&this._validate.call(this.owner||this,e),this.computed?this._write.call(this.owner||this,e):(this._value=e,i instanceof a&&i.off("change",this._onValueChange,this),e instanceof a&&e.on("change",this._onValueChange,this),this._changeEvent?y(e,this._fixedValue)&&this._isChangeCancellable?(1==h[0].length?(h[0].pop(),u||(u=-1)):h[0].splice(h[0].indexOf(this),1),this._changeEvent=null):this._changeEvent={target:this,type:"change",oldValue:i,value:e,prev:this._changeEvent}:(h[0].push(this),c=0,-1==u&&(u=0),this._changeEvent={target:this,type:"change",oldValue:i,value:e,prev:null},this._isChangeCancellable=!0,l||s(t))),!0)},_recalc:function(){if(this._version==d+1){if(10==++this._circularityCounter)return this._fixed=!0,this._version=d+1,void this._handleError(new RangeError("Circular dependency detected"))}else this._circularityCounter=1;var t=this._masters;this._masters=null;var e=this._level;this._level=0;for(var i=this._tryFormula(),n=this._masters||[],r=!1,s=t.length;s;){var l=t[--s];-1==n.indexOf(l)&&(l._unregisterSlave(this),r=!0)}if(r||t.length<n.length){for(var c=n.length;c;){var f=n[--c];-1==t.indexOf(f)&&f._registerSlave(this)}var p=this._level;if(p>e)return(h[p]||(h[p]=[])).push(this),void(p>u&&(u=p))}if(this._fixed=!0,this._version=d+1,i===o)this._handleError(o.original);else{var v=this._value;if(!y(v,i)||i instanceof a){this._value=i,this._changed=!0,this._events.change&&this.emit({type:"change",oldValue:v,value:i,prev:null});for(var _=this._slaves,g=_.length;g;){var m=_[--g];if(m._fixed){var b=m._level;(h[b]||(h[b]=[])).push(m),b>u&&(u=b),m._fixed=!1}}}}},_tryFormula:function(){var t=f;f=this;try{var e=this._formula.call(this.owner||this);return this._validate&&this._validate.call(this.owner||this,e),e}catch(i){return o.original=i,o}finally{f=t}},_handleError:function(t){this._logError(t),this._handleErrorEvent({type:"error",error:t})},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,this._handleEvent(t);for(var e=this._slaves,i=e.length;i&&!t.isPropagationStopped;)e[--i]._handleErrorEvent(t)}},dispose:function(){return l||t(),this._dispose(),this},_dispose:function(){if(this.off(),this._active)for(var t=this._slaves,e=t.length;e;)t[--e]._dispose()}}),i.Cell=n}(),function(){var t=i.Map,e=i.Cell,n=e.prototype;s=function(r,s,l,h,c,f,p){h&&h!=u||(h=r),a.call(h,d)||Object.defineProperty(h,d,{value:new t});var v=h[d].get(r);if(!v){if(null!=s&&"object"==typeof s)if("function"==typeof s.clone)s=s.clone();else if(b(s))s=s.slice();else if(s.constructor===Object)s=m({},s);else switch(o.call(s)){case"[object Date]":s=new Date(s);break;case"[object RegExp]":s=new RegExp(s)}l=g(l),l.owner=h,v=new e(s,l),h[d].set(r,v)}switch(p){case 0:return v.read();case 1:return v.write(c);default:return"bind"===c?(r=r.bind(h),r.constructor=i,r):"unwrap"===c?v:n[c].apply(v,f)}}}()}()},function(t,e){var i="undefined"==typeof window&&"undefined"==typeof navigator;e.isServer=i,e.isClient=!i},function(t,e){(function(t){function i(t){return(t||"")+ ++r}var n="__rt_uid__";t.Symbol&&"symbol"==typeof Symbol.iterator&&(n=Symbol(n)),e.KEY=n;var r=0;e.next=i}).call(e,function(){return this}())},function(t,e,i){function n(t,e){for(var i=Object.getOwnPropertyNames(e),n=i.length;n;)Object.defineProperty(t,i[--n],Object.getOwnPropertyDescriptor(e,i[n]));return t}var r,s=i(3),a=s.KEY,o=s.next;if("symbol"==typeof a)r=function(t,e){return t[a]||(t[a]=o(e))};else{var l=Object.prototype.hasOwnProperty;r=function(t,e){return l.call(t,a)||Object.defineProperty(t,a,{value:o(e)}),t[a]}}e.getUID=r;var h=Object.assign||function(t,e){for(var i=Object.keys(e),n=i.length;n;)t[i[--n]]=e[i[n]];return t};e.assign=h,e.mixin=n},function(t,e){function i(t){return t.replace(n,"\\$1")}var n=/([?+|$(){}[^.\-\]\/\\*])/g;e.escape=i},function(t,e,i){function n(t){if(!(t in c))throw new TypeError('Class "'+t+'" is not defined');return c[t]}function r(t,e){if(t in c)throw new TypeError('Class "'+t+'" is already registered');return Object.defineProperty(e,"$class",{value:t}),c[t]=e,e}function s(t,e){"object"==typeof t&&(e=t,t=void 0);var i,n=this==u?Object:this;h.call(e,"constructor")?(i=e.constructor,delete e.constructor):i=n==Object?function(){}:function(){return n.apply(this,arguments)};var a=Object.create(n.prototype);return i.prototype=a,Object.defineProperty(a,"constructor",{configurable:!0,writable:!0,value:i}),Object.keys(n).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(n,t))}),h.call(e,"static")&&(l(i,e["static"]),delete e["static"]),i.extend||(i.extend=s),l(a,e),t&&r(t,i),i}var a=i(1),o=i(4),l=o.mixin,h=Object.prototype.hasOwnProperty,c=Object.create(null);e.classes=c,e.get=n,e.register=r;var u=e;e.extend=s,a.EventEmitter.extend=s},function(t,e,i){function n(t,e){var i=u(t);if(e.hasOwnProperty(i))return i;var r,s=e[i]={};if(Array.isArray(t))s.t=0;else{if("[object Date]"==d.call(t))return s.t=1,s.s=t.toString(),i;if(t.constructor.hasOwnProperty("$class")&&(s.c=t.constructor.$class,t.collectDumpObject)){r={};var a={};t.collectDumpObject(r,a),Object.keys(a).length&&(s.o=a)}}r||(r=f({},t));var o=!0;for(var l in r){o=!1;var h=r[l];r[l]=h===Object(h)?n(h,e):void 0===h?{}:{v:h}}return o||(s.d=r),i}function r(t){var e={};return JSON.stringify({d:e,r:n(t,e)})}function s(t){"string"==typeof t&&(t=JSON.parse(t));var e,i,n=t.d;for(e in n)if(i=n[e],i.hasOwnProperty("t"))i.instance=i.t?new Date(i.s):[];else if(i.hasOwnProperty("c")){var r=p[i.c];i.instance=i.hasOwnProperty("o")?new r(void 0,i.o):new r}else i.instance={};for(e in n)if(i=n[e],i.hasOwnProperty("d")){var s=i.d;for(var a in s){var o=s[a];s[a]="object"==typeof o?o.hasOwnProperty("v")?o.v:void 0:n[o].instance}i.hasOwnProperty("c")&&i.instance.expandFromDumpObject?i.instance.expandFromDumpObject(s):f(i.instance,s)}return n[t.r].instance}var a=i(1),o=i(4),l=i(6),h=a.ActiveMap,c=a.ActiveList,u=o.getUID,f=o.assign,p=l.classes,d=Object.prototype.toString;h.prototype.collectDumpObject=function(t,e){var i=t.entries=[];this._entries.forEach(function(t,e){i.push([e,t])}),this.adoptsItemChanges&&(e.adoptsItemChanges=!0)},h.prototype.expandFromDumpObject=function(t){t.entries.forEach(function(t){this.set(t[0],t[1])},this)},c.prototype.collectDumpObject=function(t,e){t.items=this.toArray(),this.adoptsItemChanges&&(e.adoptsItemChanges=!0),this.sorted&&(e.sorted=!0)},c.prototype.expandFromDumpObject=function(t){this.addRange(t.items)},l.register("ActiveMap",h),l.register("ActiveList",c),e.serialize=r,e.deserialize=s},function(t,e,i){function n(t){return Object.keys(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e),n=i.value;"function"==typeof n&&n.constructor==r&&(t[e]=n.bind(t),t[e].constructor=r)}),t}var r=i(1);t.exports=n},function(t,e,i){var n=i(1),r=i(3),s=n.EventEmitter,a=r.next,o=s.extend({_disposables:null,disposed:!1,constructor:function(){s.call(this),this._disposables=Object.create(null)},listenTo:function(t,e,i,n){function r(){for(var t=o.length;t;)o[--t].stop();delete p._disposables[f]}var s,o;if(Array.isArray(t)||"function"==typeof $&&t instanceof $){o=[];for(var l=t.length;l;)o.push(this.listenTo(t[--l],e,i,n))}else if("object"==typeof e){n=i,s=e,o=[];for(e in s)o.push(this.listenTo(t,e,s[e],n))}else if(Array.isArray(i)){s=i,o=[];for(var h=0,c=s.length;c>h;h++)o.push(this.listenTo(t,e,s[h],n))}else{if("object"!=typeof i)return this._listenTo(t,e,i,n);s=i,o=[];for(var u in s)o.push(this.listenTo(t[u]("unwrap",0),e,s[u],n))}var f=a(),p=this,d=this._disposables[f]={stop:r,dispose:r};return d},_listenTo:function(t,e,i,n){function r(){o in l._disposables&&(t instanceof s?t.off(e,i,n):t.removeEventListener(e,i,!1),delete l._disposables[o])}n||(n=this);var o=a(),l=this;if(t instanceof s)t.on(e,i,n);else{if("function"!=typeof t.addEventListener)throw new TypeError("Unable to add a listener");t!=n&&(i=i.bind(n)),t.addEventListener(e,i,!1)}var h=this._disposables[o]={stop:r,dispose:r};return h},registerCallback:function(t){function e(){return n in r._disposables?(delete r._disposables[n],t.apply(r,arguments)):void 0}function i(){delete r._disposables[n]}var n=a(),r=this;return e.cancel=i,e.dispose=i,this._disposables[n]=e,e},setTimeout:function(t,e){function i(){n in r._disposables&&(i(s),delete r._disposables[n])}var n=a(),r=this,s=setTimeout(function(){delete r._disposables[n],t.call(r)},e),o=this._disposables[n]={clear:i,dispose:i};return o},dispose:function(){if(!this.disposed){var t=this._disposables;for(var e in t)t[e].dispose();this.disposed=!0}}});t.exports=o},function(t,e,i){function n(){return JSON.stringify(o)}function r(t){o=JSON.parse(t)}function s(){o={}}var a=i(11),o={};e.serializeCache=n,e.deserializeCache=r,e.clearCache=s,["get","head","del","patch","post","put"].forEach(function(t){e[t]=function(e,i){i||(i={});var n=[].slice.call(arguments),r=JSON.stringify(n);if(i.noCache!==!0&&o.hasOwnProperty(r)){var s=JSON.parse(o[r]);return s.ok?Promise.resolve(s):Promise.reject(s)}return new Promise(function(n,s){var l=a[t](e),h=i.headers;return h&&Object.keys(h).forEach(function(t){l.set(t,h[t])}),i.withCredentials&&l.withCredentials(),"get"==t?i.query&&l.query(i.query):i.data&&l.send("object"==typeof i.data?JSON.stringify(i.data):i.data),l.end(function(t,e){e=Object.keys(e).reduce(function(t,i){var n=e[i];return(n!==Object(n)||n.constructor==Object||n.constructor==Array)&&(t[i]=n),t},{}),t&&(e.error={name:t.name,message:t.message}),o[r]=JSON.stringify(e),e.ok?n(e):s(e)})})}})},function(e,i){e.exports=t},function(t,e,i){var n=i(1),r=i(8),s=i(9),a=s.extend({constructor:function(t){s.call(this),this._initAssets&&(this._initAssets(t||{}),r(this))},collectDumpObject:function(t){for(var e=Object.keys(this),i=0,r=e.length;r>i;i++){var s=Object.getOwnPropertyDescriptor(this,e[i]).value;if("function"==typeof s&&s.constructor==n){var a=s("unwrap",0);if(!a.computed){var o=a.read();(o===Object(o)?a.changed():a.initialValue!==o)&&(t[e[i]]=o)}}}},expandFromDumpObject:function(t){for(var e in t)this[e](t[e])}});t.exports=a},function(t,e,i){(function(t){function n(t,e,i){if(!t.hasOwnProperty(h)||!t[h]){var n=!i||i.applyValues!==!1,r=t.getAttribute("rt-bind"),s=t[h]=[];f.lastIndex=0;for(var a;a=f.exec(r);)!function(i,r,a){var o=new l(Function("var _ = this; return "+a+";").bind(e),{onchange:function(){c[i](t,this.read(),r)}});s.push(o),n&&c[i](t,o.read(),r)}(a[1],a[2],a[3]);t.removeAttribute("rt-bind"),t.setAttribute("rt-binding",r)}}function r(t){if(t.hasOwnProperty(h)){var e=t[h];if(e){for(var i=e.length;i;)e[--i].dispose();t[h]=null,t.setAttribute("rt-bind",t.getAttribute("rt-binding")),t.removeAttribute("rt-binding")}}}function s(t,e,i){i||(i={});var r=i.applyValues;i.bindRootElement!==!1&&t.hasAttribute("rt-bind")&&n(t,e,{applyValues:r});for(var s=t.querySelectorAll("[rt-bind]"),a=s.length;a;)n(s[--a],e,{applyValues:r});return t}function a(t,e){e&&e.bindRootElement===!1||!t.hasAttribute("rt-binding")||r(t);for(var i=t.querySelectorAll("[rt-binding]"),n=i.length;n;)r(i[--n]);return t}var o=i(1),l=o.Cell,h="__rt_dataCells__";t.Symbol&&"symbol"==typeof Symbol.iterator&&(h=Symbol(h)),e.KEY_DATA_CELLS=h;var c={prop:function(t,e,i){t[i]!==e&&(t[i]=e)},attr:function(t,e,i){null!=e&&e!==!1?(e=e===!0?i:e.toString(),t.getAttribute(i)!==e&&t.setAttribute(i,e)):t.hasAttribute(i)&&t.removeAttribute(i)},value:function(t,e){e=String(e),t.value!=e&&(t.value=e)},checked:function(t,e){e=!!e,t.checked!=e&&(t.checked=e)},disabled:function(t,e){t.disabled!=!!e&&(t.disabled=!!e)},"class":function(t,e,i){$(t).toggleClass(i,!!e)},mod:function(t,e,i){var n={};n[i]=!!e,$(t).mods(n)},show:function(t,e){e=e?"":"none",t.style.display!=e&&(t.style.display=e)},html:function(t,e){t.innerHTML=e},text:function(t,e,i){e=String(e);var n;switch(i){case"first":if(n=t.firstChild,!n||3!=n.nodeType)return void t.insertBefore(document.createTextNode(e),n);break;case"last":if(n=t.lastChild,!n||3!=n.nodeType)return void t.appendChild(document.createTextNode(e));break;case"prev":if(n=t.previousSibling,!n||3!=n.nodeType)return void t.parentNode.insertBefore(document.createTextNode(e),t);break;case"next":if(n=t.nextSibling,!n||3!=n.nodeType)return void t.parentNode.insertBefore(document.createTextNode(e),n);break;default:if(1!=t.childNodes.length||3!=t.firstChild.nodeType){for(;t.lastChild;)t.removeChild(t.lastChild);return void t.appendChild(document.createTextNode(e))}n=t.firstChild}n.nodeValue!=e&&(n.nodeValue=e)}};e.directiveHandlers=c;var u=Object.keys(c).join("|"),f=RegExp("\\s*("+u+")(?:\\(([^)]*)\\))?:\\s*(\\S[\\s\\S]*?)(?=\\s*(?:,\\s*(?:"+u+")(?:\\([^)]*\\))?:\\s*\\S|$))","g");e.bind=s,e.unbind=a}).call(e,function(){return this}())},function(t,e,i){(function(e){function n(){}function r(t){if(!(t in V))throw new TypeError('ViewClass "'+t+'" is not defined');return V[t]}function s(t,e){if(t in V)throw new TypeError('ViewClass "'+t+'" is already registered');return Object.defineProperty(e,"$viewClass",{value:t}),V[t]=e,e}function a(t){return t.replace(/[^$0-9a-zA-Z]([$0-9a-zA-Z])/g,function(t,e){return e.toUpperCase()})}function o(t,e){for(var i in e){var n=e[i];null!=n&&n!==!1&&t.push("_"+i+(n===!0?"":"_"+n))}return t}function l(t,e){for(var i in e)t.setAttribute(i,e[i])}function h(t,e,i){for(var n=t.children,r=!1,s=n.length;s;){var a=n[--s];a.blockName==e?(a.$(i),r=!0):h(a,e,i)&&(r=!0)}return r}function c(t,e){if(e.hasOwnProperty(P)&&e[P]&&e[k]==t){e.parentNode&&e.parentNode.removeChild(e),O(e);var i=t.elements[e[P]];i.splice(i.indexOf(e),1),e[k]=null,e[P]=void 0}}function u(t){if(t._afterDataReceiving!=n)try{t._afterDataReceiving()}catch(e){t._logError(e)}}function f(t,e){if(t._receiveData==n)e.call(t);else{if(t._beforeDataReceiving!=n)try{t._beforeDataReceiving()}catch(i){t._logError(i)}try{t._receiveData.length?t._receiveData(function(i){t.disposed||(null!=i&&(t.dataReceivingError=i,t._logError(i)),u(t),e.call(t))}):t._receiveData()["catch"](function(e){t.disposed||(t.dataReceivingError=e,t._logError(e))}).then(function(){t.disposed||(u(t),e.call(t))})}catch(i){t.dataReceivingError=i,t._logError(i),u(t),e.call(t)}}}function p(t,e){var i=j.call(e.querySelectorAll("[rt-id]"),function(t,e){return t[e.getAttribute("rt-id")]=e,t},{});!function n(t){for(var e=t.children,r=e.length;r;){var s=e[--r],a=i[s._id];a[k]=s,s.block=$(a),n(s)}t.isDOMReady=!0,t.emit({type:"domready",bubbles:!1})}(t)}var d=i(2),v=i(4),_=i(6),g=i(8),m=i(9),y=i(13),b=d.isServer,w=v.assign,C=_.extend,E=y.bind,O=y.unbind,x=Object.prototype.hasOwnProperty,S=Array.prototype.slice,j=Array.prototype.reduce,k="__rt_view__",P="__rt_viewElementName__";e.Symbol&&"symbol"==typeof Symbol.iterator&&(k=Symbol(k),P=Symbol(P));var R=w(Object.create(null),{area:1,base:1,basefont:1,br:1,col:1,command:1,embed:1,frame:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1,circle:1,ellipse:1,line:1,path:1,polygone:1,polyline:1,rect:1,stop:1,use:1}),V=Object.create(null),N=m.extend({"static":{KEY_VIEW:k,KEY_VIEW_ELEMENT_NAME:P,viewClasses:V,getViewClass:r,registerViewClass:s,extend:function(t,e){return s(t,C.call(this,void 0,e))}},tagName:"div",blockName:void 0,mods:null,attrs:null,_idCounter:0,_id:void 0,name:void 0,owner:null,app:null,model:null,_parent:null,get parent(){return this._parent},set parent(t){t?t.registerChild(this):this._parent&&this._parent.unregisterChild(this);

},children:null,block:null,elements:null,isDOMReady:!1,_receiveData:n,_beforeDataReceiving:n,_afterDataReceiving:n,dataReceivingError:null,_currentlyRendering:!1,_childRenderings:null,_beforeRendering:n,template:function(){return""},isClientInited:!1,_initClient:n,constructor:function(t){m.call(this),t||(t={});var e,i=t.parent;if(t.app?e=this.app=t.app:i&&i.app&&(e=this.app=i.app),t.model?this.model=t.model:i&&i.model?this.model=i.model:e&&(this.model=e.model),this._initAssets&&(this._initAssets(t),g(this)),t.tagName&&(this.tagName=t.tagName),t.blockName)this.blockName=t.blockName;else if(!this.blockName){for(var n=Object.getPrototypeOf(this);Object.getPrototypeOf(n).constructor!=N;)n=Object.getPrototypeOf(n);n.blockName=a(n.constructor.$viewClass)}this.mods=Object.create(this.mods),t.mods&&w(this.mods,t.mods),this.attrs=Object.create(this.attrs),t.attrs&&w(this.attrs,t.attrs),t.name&&(this.name=t.name),t.owner&&(this.owner=t.owner),i&&(this.parent=i),this._id=this._nextID(),this.children=[];var r=b?null:t.block;if(null!==r){if(r){if(r instanceof $&&(r=r[0]),r.hasOwnProperty(k)&&r[k])throw new TypeError("Element is already used as "+(r.hasOwnProperty(P)&&r[P]?"an element":"a block")+" of view")}else r=document.createElement(this.tagName);r[k]=this,this.block=$(r)}this.elements={},r&&(r.hasAttribute("rt-id")?this.render(function(){p(this,r)}):(l(r,this.attrs),r.className=(o([this.blockName],this.mods).join(" ")+" "+r.className).trim(),this._currentlyRendering=!0,f(this,function(){this._renderInner(function(t){this._currentlyRendering=!1,r.innerHTML=t,p(this,r)})})))},_nextID:function(){return this._parent?this._parent._nextID():String(++this._idCounter)},render:function(t){if(this._currentlyRendering)throw new TypeError("Can't run rendering when it is in process");if(this._beforeRendering!=n)try{this._beforeRendering()}catch(e){this._logError(e)}this._currentlyRendering=!0,f(this,function(){this.tagName in R?(this._currentlyRendering=!1,t.call(this,this._renderOpenTag())):this._renderInner(function(e){this._currentlyRendering=!1,t.call(this,this._renderOpenTag()+e+"</"+this.tagName+">")})})},_renderOpenTag:function(){var t=this.attrs,e=['class="'+(o([this.blockName],this.mods).join(" ")+" "+(t["class"]||"")).trim()+'"'];for(var i in t)"class"!=i&&e.push(i+'="'+t[i]+'"');return"<"+this.tagName+" "+e.join(" ")+' rt-id="'+this._id+'">'},_renderInner:function(t){var e,i=this._childRenderings={count:0,readyCount:0,childTraces:[],results:[],onallready:null};try{e=this.template.call(this.owner||this)}catch(n){return this._childRenderings=null,this._logError(n),void t.call(this,"")}var r=this;i.onallready=function(){r._childRenderings=null;for(var n=i.childTraces,s=i.results,a=n.length;a;)e=e.replace(n[--a],function(){return s[a]});t.call(r,e)},i.count==i.readyCount&&i.onallready()},initClient:function(t){function e(){if(!this.isClientInited){this.isClientInited=!0;for(var e=this.children.slice(),i=0,r=e.length;r>i;i++)e[i].initClient();try{this._initClient!=n&&this._initClient(),E(this.block[0],this.owner||this)}catch(s){this._logError(s)}}t&&t.call(this)}return this.isDOMReady?e.call(this):this.once("domready",e),this},registerChild:function(t){if(t._parent){if(t._parent==this)return this;throw new TypeError("View is already used as a child of view")}t._parent=this;var e=this.children,i=t.name;return e.push(t),i&&(x.call(e,i)?e[i]:e[i]=[]).push(t),this},unregisterChild:function(t){if(t._parent!==this)return this;t._parent=null;var e=this.children,i=t.name;if(e.splice(e.indexOf(t),1),i){var n=e[i];n.splice(n.indexOf(t),1)}return this},broadcast:function(t,e){var i,n;/^(.+?):(.+)$/.test(t)?(i=RegExp.$1,n=RegExp.$2):(i=t,n="*"),i=r(i);var s=[];!function o(t){for(var e=0,r=t.length;r>e;e++){var a=t[e];!("*"===i||a instanceof i)||"*"!=n&&a.name!==n||s.push(a),o(a.children)}}(this.children);var a=S.call(arguments,2);return s.map(function(t){return t.disposed||"function"!=typeof t[e]?void 0:t[e].apply(t,a)})},$:function(t){var e;if(x.call(this.elements,t))e=this.elements[t];else{e=this.block.find("."+this.blockName+"_"+t),h(this,this.blockName,t)&&(e=e.filter(function(){return!this.hasOwnProperty(k)||!this[k]}));var i=this;e.each(function(){this[k]=i,this[P]=t}),this.elements[t]=e}var n=arguments.length;if(n>1){var r=1;do{var s=arguments[r],a="string"==typeof s;if(a||s instanceof HTMLElement){if(a){var c=document.createElement("div");c.innerHTML=s,s=1==c.childNodes.length&&1==c.firstChild.nodeType?c.firstChild:c}else if(s.hasOwnProperty(k)&&s[k]){if(!s.hasOwnProperty(P)||!s[P])throw new TypeError("Element is already used as a block of view");if(s[k]!=this||s[P]!=t)throw new TypeError("Element is already used as an element of view");continue}s.className=(this.blockName+"_"+t+" "+s.className).trim()}else{var u=s;s=document.createElement(u.tagName||"div"),u.attrs&&l(s,u.attrs);var f=[this.blockName+"_"+t];u.mods&&o(f,u.mods),s.className=(f.join(" ")+" "+s.className).trim(),u.html&&(s.innerHTML=u.html)}s[k]=this,s[P]=t,e.push(s),E(s,this.owner||this)}while(++r<n)}return e},$rm:function(){for(var t=arguments.length;t;){var e=arguments[--t];if("string"==typeof e){if(!x.call(this.elements,e))continue;e=this.elements[e]}if(e instanceof $){var i=this;e.each(function(){c(i,this)})}else c(this,e)}return this},_listenTo:function(t,e,i,n){var s;if(t instanceof N){var a;if(/^(.+?):(.+)$/.test(e)){var o=RegExp.$1;s=RegExp.$2,"*"!=o&&(o=r(o),a=i,i=function(t){return t.target instanceof o?a.call(this,t):void 0})}else{s=e,a=i;var l=this;i=function(t){return t.target==l?a.call(this,t):void 0}}}else s=e;return m.prototype._listenTo.call(this,t,s,i,n)},dispose:function(){var t=this.block&&this.block[0];t&&(t.parentNode&&t.parentNode.removeChild(t),O(t));for(var e=this.children,i=e.length;i;)e[--i].dispose();this.parent=null,t&&(t[k]=null),m.prototype.dispose.call(this)}});t.exports=N}).call(e,function(){return this}())},function(t,e,i){function n(t,e){"string"==typeof t&&(t=u(t)),e?(e.parent=this,e.block=null):e={parent:this,block:null};var i=this._childRenderings,n=i.count++,r=i.childTraces[n]="{{"+c()+"}}";return new t(e).render(function(t){i.results[n]=t,i.count==++i.readyCount&&i.onallready&&i.onallready()}),r}function r(t,e,i){if(t)if(t instanceof l?t=t.toObject():t instanceof h&&(t=t.toArray()),Array.isArray(t))for(var n=0,r=t.length;r>n;n++)n in t&&e.call(i,t[n],n);else for(var s in t)f.call(t,s)&&e.call(i,t[s],s)}var s=i(1),a=i(3),o=i(14),l=s.ActiveMap,h=s.ActiveList,c=a.next,u=o.getViewClass,f=Object.prototype.hasOwnProperty;e.defaults={include:n,helpers:{},each:r}},function(t,e,i){var n=i(14),r=i(15),s=n.getViewClass,a=r.defaults.include;n.extend("ViewList",{tagName:"ul",model:null,itemViewClass:null,getItemParams:null,constructor:function(t){n.call(this,t),this.itemViewClass=s(t.itemViewClass),t.getItemParams&&(this.getItemParams=t.getItemParams)},template:function(){var t=this.model();if(!t)return"";var e=this.itemViewClass,i=this.getItemParams;return t.map(function(n,r){var s=i?i(n,r,t):{};return s.name="item",s.model=n,s.$index=r,'<li class="ViewList_item">'+a.call(this,e,s)+"</li>"},this).join("")},_initClient:function(){this.listenTo(this,"change",{model:this._onModelChange})},_onModelChange:function(){var t=this.model()||[],e=this.itemViewClass,i=this.getItemParams,n=this.children.item||(this.children.item=[]),r=this.block[0],s=n.map(function(t){return t.model}),a=Array.isArray(t)?t.slice():t.toArray();a.forEach(function(a,o){if(a!==s[o]){var l=s.indexOf(a,o+1);if(-1==l){var h=i?i(a,o,t):{};h.name="item",h.model=a,h.parent=this,h.$index=o,new e(h);var c=n.pop(),u=document.createElement("li");u.className="ViewList_item",u.appendChild(c.block[0]),o<n.length?r.insertBefore(u,n[o].block[0].parentNode):r.appendChild(u),n.splice(o,0,c),s.splice(o,0,c.model),c.initClient()}else r.insertBefore(n[l].block[0].parentNode,n[o].block[0].parentNode),n.splice(o,0,n.splice(l,1)[0]),s.splice(o,0,s.splice(l,1)[0])}},this),n.slice(a.length).forEach(function(t){var e=t.block[0].parentNode;e.parentNode.removeChild(e),t.dispose()})}})},function(t,e,i){var n=i(14),r=i(15),s=n.getViewClass,a=r.defaults.include;n.extend("ViewSwitch",{_states:null,_stateSource:null,initialState:void 0,_currentState:void 0,constructor:function(t){n.call(this,t),this._states=t.states,t.stateSource&&(this._stateSource=t.stateSource);var e;t.initialState&&(e=this.initialState=t.initialState);var i=e||(this._stateSource?this._stateSource():void 0);i&&this._states[i]||!this._states["default"]||(i="default"),i&&this._states[i]&&(this._currentState=i)},get currentState(){return this._currentState},set currentState(t){if(t&&this._states[t]||!this._states["default"]||(t="default"),this._currentState!==t)if(this._currentState&&this.children[0].dispose(),t&&this._states[t]){var e=this._states[t],i=Object.create(e.viewParams||null);i.parent=this;var n=new(s(e.viewClass))(i);n.block.appendTo(this.block),n.initClient(),this._currentState=t}else this._currentState=void 0},template:function(){var t=this._currentState;if(t&&this._states[t]){var e=this._states[t];return a.call(this,e.viewClass,e.viewParams||null)}return""},_initClient:function(){this._stateSource&&this.listenTo(this,"change",{_stateSource:this._onStateSourceChange})},_onStateSourceChange:function(){this.currentState=this._stateSource()}})},function(t,e,i){var n=i(1),r=i(7),s=i(9),a=r.serialize,o=r.deserialize,l=Object.prototype.hasOwnProperty,h=s.extend("Rift.ViewState",{propertyList:null,constructor:function(t){s.call(this),this.propertyList=Object.keys(t),this.propertyList.forEach(function(e){this[e]=("function"==typeof t[e]?t[e]:n(t[e])).bind(this),this[e].constructor=n},this)},serializeData:function(){for(var t=this.propertyList,e={},i=t.length;i;){var n=this[t[--i]]("unwrap",0);if(!n.computable){var r=n.read();(r===Object(r)?n.changed():n.initialValue!==r)&&(e[t[i]]=r)}}return a(e)},updateFromSerializedData:function(t){return this.update(o(t)),this},update:function(t){for(var e,i=this.propertyList,n=i.length;n;){e=i[--n];var r=this[e]("unwrap",0);r.computable||r.write(r.initialValue)}for(var s=i.length;s;)e=i[--s],l.call(t,e)&&this[e](t[e]);return this}});t.exports=h},function(t,e,i){function n(t){if(""!=t){if("NaN"==t)return 0/0;var e=Number(t);if(e==e)return e}return t}function r(t){t=t.split("/");for(var e=t.length;e;)t[--e]=encodeURIComponent(decodeURIComponent(t[e]));return t.join("/")}function s(t){return"/"!=t[0]&&(t="/"+t),"/"!=t[t.length-1]&&(t+="/"),t}function a(t,e){for(var i=e.pathMap,n=[],r=0,a=i.length;a>r;r++){for(var o=i[r],l=o.requiredProperties,h=l.length;h--;){var c=t[l[h]]();if(null==c||c===!1||""===c)break}-1==h&&n.push(void 0!==o.pathPart?o.pathPart:t[o.property]())}return s(n.join(""))}function o(t,e){for(var i=t.routes,r=0,s=i.length;s>r;r++){var a=i[r],o=e.match(a.rePath);if(o)return{route:a,state:a.properties.reduce(function(t,e,i){return t[e.name]=1==e.type?!!o[i+1]:o[i+1]&&n(decodeURIComponent(o[i+1])),t},{})}}return null}function l(t,e){for(var i=t.app.viewState,n=t.routes,r=null,s=0,o=n.length;o>s;s++){for(var l=n[s],h=l.requiredProperties,c=h.length;c--;){var u=i[h[c]]();if(null==u||u===!1||""===u)break}if(-1==c)if(r)if(r.requiredProperties.length){if(h.length&&l===e){r=l;break}}else if(h.length){if(r=l,l===e)break}else l===e&&(r=l);else r=l}return r&&{route:r,path:a(i,r)}}function h(t,e,i,n,r){if(t.currentRoute=e,t.currentRouteName(e.name),t.currentPath=i,m){t._isViewStateChangeHandlingRequired=!1;var s;r?(s={},s[w]={routeIndex:t.routes.indexOf(e),path:i,viewStateData:n},history[1==r?"replaceState":"pushState"](s,null,i)):(s=history.state||{},s[w]={routeIndex:t.routes.indexOf(e),path:i,viewStateData:n},history.replaceState(s,null,i))}e.callback&&e.callback.call(t.app,i)}function c(t,e){var i=l(t,e);if(i){var n=i.path;if(n!==t.currentPath)return h(t,i.route,n,t.app.viewState.serializeData(),2),!0}return!1}var u=i(1),f=i(2),p=i(5),d=i(7),v=i(9),_=u.nextTick,g=f.isServer,m=f.isClient,y=p.escape,b=d.serialize,w="__rt_routingState__",C=v.extend({"static":{KEY_ROUTING_STATE:w},app:null,viewBlock:null,routes:null,routeDict:null,started:!1,currentRoute:null,currentRouteName:u(""),currentPath:void 0,_isViewStateChangeHandlingRequired:!1,constructor:function(t,e){v.call(this),this.app=t,this.routes=[],this.routeDict=Object.create(null),this.currentRouteName=this.currentRouteName.bind(this),this.currentRouteName.constructor=u,e&&this.addRoutes(e)},addRoutes:function(t){return t.forEach(function(t){"string"==typeof t&&(t={path:t}),this.addRoute(t.path,t.name,t.callback)},this),this},addRoute:function(t,e,i){if(this.started)throw new TypeError("Can't add route to started router");t=t.split(/\((?:\?([^\s)]+)\s+)?([^)]+)\)/g);for(var n,s,a,o=/\{([^}]+)\}/g,l=[],h=[],c=[],u=[],f=0,p=t.length;p>f;)if(f%3){l.push("(");var d=[];t[f]&&(d.push(t[f]),h.push({type:1,name:t[f]})),n=t[f+1].split(o);for(var v=0,_=n.length;_>v;v++)v%2?(a=n[v],d.push(a),l.push("([^\\/]+)"),h.push({type:2,name:a}),u.push({requiredProperties:d,pathPart:void 0,property:a})):n[v]&&(s=r(n[v]),l.push(y(s).split("\\*").join(".*?")),u.push({requiredProperties:d,pathPart:s.split("*").join(""),property:void 0}));l.push(")?"),f+=2}else{if(t[f]){n=t[f].split(o);for(var g=0,m=n.length;m>g;g++)g%2?(a=n[g],l.push("([^\\/]+)"),h.push({type:0,name:a}),c.push(a),u.push({requiredProperties:[a],pathPart:void 0,property:a})):n[g]&&(s=r(n[g]),l.push(y(s).split("\\*").join(".*?")),u.push({requiredProperties:[],pathPart:s.split("*").join(""),property:void 0}))}f++}var b={name:e,rePath:RegExp("^\\/?"+l.join("")+"\\/?$"),properties:h,requiredProperties:c,pathMap:u,callback:i};if(this.routes.push(b),e){if(e in this.routeDict)throw new TypeError('Route "'+e+'" is already exist');this.routeDict[e]=b}return this},start:function(){if(this.started)return this;if(this.started=!0,m&&(this.viewBlock=this.app.view.block[0]),this._bindEvents(),g){var t=l(this,"/"==this.currentPath?null:this.currentRoute);t&&h(this,t.route,t.path,this.app.viewState.serializeData())}return this},_bindEvents:function(){if(m){this.listenTo(window,"popstate",this._onWindowPopState),this.listenTo(this.viewBlock,"click",this._onViewBlockClick);for(var t=this.app.viewState,e=this._onViewStatePropertyChange,i=t.propertyList,n=i.length;n;)this.listenTo(t[i[--n]]("unwrap",0),"change",e)}},_onWindowPopState:function(){var t=history.state&&history.state[w];if(t){var e=this.routes[t.routeIndex],i=t.path;this.currentRoute=e,this.currentRouteName(e.name),this.currentPath=i,this.app.viewState.updateFromSerializedData(t.viewStateData),e.callback&&e.callback.call(this.app,i)}else{this.app.viewState.update({});var n=l(this);n?h(this,n.route,n.path,b({}),0):(this.currentRoute=null,this.currentRouteName(""),this.currentPath=void 0)}},_onViewBlockClick:function(t){for(var e=this.viewBlock,i=t.target;"A"!=i.tagName;){if(i==e)return;if(i=i.parentNode,!i)return}var n=i.getAttribute("href");-1==n.indexOf("#")&&!/^(?:\w+:)?\/\//.test(n)&&this.route(n)&&t.preventDefault()},_onViewStatePropertyChange:function(){this._isViewStateChangeHandlingRequired||(this._isViewStateChangeHandlingRequired=!0,_(this.registerCallback(this._onViewStateChange)))},_onViewStateChange:function(){if(this._isViewStateChangeHandlingRequired){this._isViewStateChangeHandlingRequired=!1;var t=history.state||{};t[w]||(t[w]={routeIndex:this.routes.indexOf(this.currentRoute),path:this.currentPath}),t[w].viewStateData=this.app.viewState.serializeData(),history.replaceState(t,null,this.currentPath)}},route:function(t,e){if(t=r(t.replace(/[\/\\]+/g,"/")),"/"!=t[0]){var i=location.pathname;t=i+("/"==i[i.length-1]?"":"/")+t}if("/"!=t[t.length-1]&&(t+="/"),t===this.currentPath)return!0;var n=o(this,t);return n?(this.app.viewState.update(n.state),h(this,n.route,t,this.app.viewState.serializeData(),e!==!1?2:1),!0):!1},update:function(t){return c(this,t?this.routeDict[t]:this.currentRoute)}});t.exports=C},function(t,e,i){function n(t,e){for(var i=f({},t),n=e.length;n;)for(var r=e[--n].properties,s=r.length;s;){var a=r[--s].name;d.call(i,a)||(i[a]=void 0)}return i}var r=i(2),s=i(4),a=i(6),o=i(7),l=i(18),h=i(19),c=r.isServer,u=r.isClient,f=s.assign,p=o.deserialize,d=Object.prototype.hasOwnProperty,v=a.extend({model:null,view:null,viewState:null,router:null,_init:function(t){this.model=c?new t.modelClass:p(t.modelDataDump);var e=this.router=new h(this,t.routes),i=this.viewState=new l(n(t.viewStateFields,e.routes));e.route(t.path,!1);var r;if(u){var s=p(t.viewStateDataDump);for(var a in s)i[a](s[a]);r=new t.viewClass({app:this,block:t.viewBlock})}else r=new t.viewClass({app:this,block:null});this.view=r,e.start(),u&&r.initClient()},dispose:function(){this.router.dispose(),this.view.dispose(),this.viewState.dispose(),this.model.dispose()}});t.exports=v}])});